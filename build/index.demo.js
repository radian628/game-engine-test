import{a as qe,b as mt,c as Ei,d as fs,e as fe,f as Ti,g as pt,h as Ii,i as st,j as Ci,k as mr,l as ki,m as he,n as Si,p as Mt,r as Ft,s as Ee}from"./chunk-6PVIZZZS.js";import{a as hr,b as ke,c as $u}from"./chunk-RFBBAUMM.js";var Fr=hr(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.isAnyArray=void 0;var Pp=Object.prototype.toString;function Up(s){let e=Pp.call(s);return e.endsWith("Array]")&&!e.includes("Big")}En.isAnyArray=Up});var eu=hr((B1,Zc)=>{"use strict";var Np=Fr();function Vp(s,e={}){if(!Np.isAnyArray(s))throw new TypeError("input must be an array");if(s.length===0)throw new TypeError("input must not be empty");let{fromIndex:t=0,toIndex:r=s.length}=e;if(t<0||t>=s.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(r<=t||r>s.length||!Number.isInteger(r))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");let n=s[t];for(let o=t+1;o<r;o++)s[o]>n&&(n=s[o]);return n}Zc.exports=Vp});var ru=hr((v1,tu)=>{"use strict";var Jp=Fr();function Hp(s,e={}){if(!Jp.isAnyArray(s))throw new TypeError("input must be an array");if(s.length===0)throw new TypeError("input must not be empty");let{fromIndex:t=0,toIndex:r=s.length}=e;if(t<0||t>=s.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(r<=t||r>s.length||!Number.isInteger(r))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");let n=s[t];for(let o=t+1;o<r;o++)s[o]<n&&(n=s[o]);return n}tu.exports=Hp});var iu=hr((E1,ou)=>{"use strict";var nu=Fr(),jp=eu(),$p=ru();function su(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var Wp=su(jp),Kp=su($p);function Xp(s,e={}){if(nu.isAnyArray(s)){if(s.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");let t;if(e.output!==void 0){if(!nu.isAnyArray(e.output))throw new TypeError("output option must be an array if specified");t=e.output}else t=new Array(s.length);let r=Kp.default(s),n=Wp.default(s);if(r===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");let{min:o=e.autoMinMax?r:0,max:i=e.autoMinMax?n:1}=e;if(o>=i)throw new RangeError("min option must be smaller than max option");let a=(i-o)/(n-r);for(let c=0;c<s.length;c++)t[c]=(s[c]-r)*a+o;return t}ou.exports=Xp});var mu=hr(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});var Ae=Fr(),au=iu(),Tn=" ".repeat(2),lu=" ".repeat(4);function Qp(){return fu(this)}function fu(s,e={}){let{maxRows:t=15,maxColumns:r=10,maxNumSize:n=8,padMinus:o="auto"}=e;return`${s.constructor.name} {
${Tn}[
${lu}${qp(s,t,r,n,o)}
${Tn}]
${Tn}rows: ${s.rows}
${Tn}columns: ${s.columns}
}`}function qp(s,e,t,r,n){let{rows:o,columns:i}=s,a=Math.min(o,e),c=Math.min(i,t),u=[];if(n==="auto"){n=!1;e:for(let l=0;l<a;l++)for(let f=0;f<c;f++)if(s.get(l,f)<0){n=!0;break e}}for(let l=0;l<a;l++){let f=[];for(let h=0;h<c;h++)f.push(zp(s.get(l,h),r,n));u.push(`${f.join(" ")}`)}return c!==i&&(u[u.length-1]+=` ... ${i-t} more columns`),a!==o&&u.push(`... ${o-e} more rows`),u.join(`
${lu}`)}function zp(s,e,t){return(s>=0&&t?` ${cu(s,e-1)}`:cu(s,e)).padEnd(e)}function cu(s,e){let t=s.toString();if(t.length<=e)return t;let r=s.toFixed(e);if(r.length>e&&(r=s.toFixed(Math.max(0,e-(r.length-e)))),r.length<=e&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let n=s.toExponential(e);return n.length>e&&(n=s.toExponential(Math.max(0,e-(n.length-e)))),n.slice(0)}function Yp(s,e){s.prototype.add=function(r){return typeof r=="number"?this.addS(r):this.addM(r)},s.prototype.addS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+r);return this},s.prototype.addM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)+r.get(n,o));return this},s.add=function(r,n){return new e(r).add(n)},s.prototype.sub=function(r){return typeof r=="number"?this.subS(r):this.subM(r)},s.prototype.subS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-r);return this},s.prototype.subM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)-r.get(n,o));return this},s.sub=function(r,n){return new e(r).sub(n)},s.prototype.subtract=s.prototype.sub,s.prototype.subtractS=s.prototype.subS,s.prototype.subtractM=s.prototype.subM,s.subtract=s.sub,s.prototype.mul=function(r){return typeof r=="number"?this.mulS(r):this.mulM(r)},s.prototype.mulS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*r);return this},s.prototype.mulM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)*r.get(n,o));return this},s.mul=function(r,n){return new e(r).mul(n)},s.prototype.multiply=s.prototype.mul,s.prototype.multiplyS=s.prototype.mulS,s.prototype.multiplyM=s.prototype.mulM,s.multiply=s.mul,s.prototype.div=function(r){return typeof r=="number"?this.divS(r):this.divM(r)},s.prototype.divS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/r);return this},s.prototype.divM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)/r.get(n,o));return this},s.div=function(r,n){return new e(r).div(n)},s.prototype.divide=s.prototype.div,s.prototype.divideS=s.prototype.divS,s.prototype.divideM=s.prototype.divM,s.divide=s.div,s.prototype.mod=function(r){return typeof r=="number"?this.modS(r):this.modM(r)},s.prototype.modS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%r);return this},s.prototype.modM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)%r.get(n,o));return this},s.mod=function(r,n){return new e(r).mod(n)},s.prototype.modulus=s.prototype.mod,s.prototype.modulusS=s.prototype.modS,s.prototype.modulusM=s.prototype.modM,s.modulus=s.mod,s.prototype.and=function(r){return typeof r=="number"?this.andS(r):this.andM(r)},s.prototype.andS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&r);return this},s.prototype.andM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)&r.get(n,o));return this},s.and=function(r,n){return new e(r).and(n)},s.prototype.or=function(r){return typeof r=="number"?this.orS(r):this.orM(r)},s.prototype.orS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|r);return this},s.prototype.orM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)|r.get(n,o));return this},s.or=function(r,n){return new e(r).or(n)},s.prototype.xor=function(r){return typeof r=="number"?this.xorS(r):this.xorM(r)},s.prototype.xorS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^r);return this},s.prototype.xorM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)^r.get(n,o));return this},s.xor=function(r,n){return new e(r).xor(n)},s.prototype.leftShift=function(r){return typeof r=="number"?this.leftShiftS(r):this.leftShiftM(r)},s.prototype.leftShiftS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<r);return this},s.prototype.leftShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)<<r.get(n,o));return this},s.leftShift=function(r,n){return new e(r).leftShift(n)},s.prototype.signPropagatingRightShift=function(r){return typeof r=="number"?this.signPropagatingRightShiftS(r):this.signPropagatingRightShiftM(r)},s.prototype.signPropagatingRightShiftS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>r);return this},s.prototype.signPropagatingRightShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>r.get(n,o));return this},s.signPropagatingRightShift=function(r,n){return new e(r).signPropagatingRightShift(n)},s.prototype.rightShift=function(r){return typeof r=="number"?this.rightShiftS(r):this.rightShiftM(r)},s.prototype.rightShiftS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>r);return this},s.prototype.rightShiftM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)>>>r.get(n,o));return this},s.rightShift=function(r,n){return new e(r).rightShift(n)},s.prototype.zeroFillRightShift=s.prototype.rightShift,s.prototype.zeroFillRightShiftS=s.prototype.rightShiftS,s.prototype.zeroFillRightShiftM=s.prototype.rightShiftM,s.zeroFillRightShift=s.rightShift,s.prototype.not=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,~this.get(r,n));return this},s.not=function(r){return new e(r).not()},s.prototype.abs=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.abs(this.get(r,n)));return this},s.abs=function(r){return new e(r).abs()},s.prototype.acos=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.acos(this.get(r,n)));return this},s.acos=function(r){return new e(r).acos()},s.prototype.acosh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.acosh(this.get(r,n)));return this},s.acosh=function(r){return new e(r).acosh()},s.prototype.asin=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.asin(this.get(r,n)));return this},s.asin=function(r){return new e(r).asin()},s.prototype.asinh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.asinh(this.get(r,n)));return this},s.asinh=function(r){return new e(r).asinh()},s.prototype.atan=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.atan(this.get(r,n)));return this},s.atan=function(r){return new e(r).atan()},s.prototype.atanh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.atanh(this.get(r,n)));return this},s.atanh=function(r){return new e(r).atanh()},s.prototype.cbrt=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.cbrt(this.get(r,n)));return this},s.cbrt=function(r){return new e(r).cbrt()},s.prototype.ceil=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.ceil(this.get(r,n)));return this},s.ceil=function(r){return new e(r).ceil()},s.prototype.clz32=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.clz32(this.get(r,n)));return this},s.clz32=function(r){return new e(r).clz32()},s.prototype.cos=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.cos(this.get(r,n)));return this},s.cos=function(r){return new e(r).cos()},s.prototype.cosh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.cosh(this.get(r,n)));return this},s.cosh=function(r){return new e(r).cosh()},s.prototype.exp=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.exp(this.get(r,n)));return this},s.exp=function(r){return new e(r).exp()},s.prototype.expm1=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.expm1(this.get(r,n)));return this},s.expm1=function(r){return new e(r).expm1()},s.prototype.floor=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.floor(this.get(r,n)));return this},s.floor=function(r){return new e(r).floor()},s.prototype.fround=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.fround(this.get(r,n)));return this},s.fround=function(r){return new e(r).fround()},s.prototype.log=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log(this.get(r,n)));return this},s.log=function(r){return new e(r).log()},s.prototype.log1p=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log1p(this.get(r,n)));return this},s.log1p=function(r){return new e(r).log1p()},s.prototype.log10=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log10(this.get(r,n)));return this},s.log10=function(r){return new e(r).log10()},s.prototype.log2=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log2(this.get(r,n)));return this},s.log2=function(r){return new e(r).log2()},s.prototype.round=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.round(this.get(r,n)));return this},s.round=function(r){return new e(r).round()},s.prototype.sign=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sign(this.get(r,n)));return this},s.sign=function(r){return new e(r).sign()},s.prototype.sin=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sin(this.get(r,n)));return this},s.sin=function(r){return new e(r).sin()},s.prototype.sinh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sinh(this.get(r,n)));return this},s.sinh=function(r){return new e(r).sinh()},s.prototype.sqrt=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sqrt(this.get(r,n)));return this},s.sqrt=function(r){return new e(r).sqrt()},s.prototype.tan=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.tan(this.get(r,n)));return this},s.tan=function(r){return new e(r).tan()},s.prototype.tanh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.tanh(this.get(r,n)));return this},s.tanh=function(r){return new e(r).tanh()},s.prototype.trunc=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.trunc(this.get(r,n)));return this},s.trunc=function(r){return new e(r).trunc()},s.pow=function(r,n){return new e(r).pow(n)},s.prototype.pow=function(r){return typeof r=="number"?this.powS(r):this.powM(r)},s.prototype.powS=function(r){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)**r);return this},s.prototype.powM=function(r){if(r=e.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,this.get(n,o)**r.get(n,o));return this}}function Fe(s,e,t){let r=t?s.rows:s.rows-1;if(e<0||e>r)throw new RangeError("Row index out of range")}function De(s,e,t){let r=t?s.columns:s.columns-1;if(e<0||e>r)throw new RangeError("Column index out of range")}function Zt(s,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==s.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function er(s,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==s.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function qo(s,e){if(!Ae.isAnyArray(e))throw new TypeError("row indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=s.rows)throw new RangeError("row indices are out of range")}function zo(s,e){if(!Ae.isAnyArray(e))throw new TypeError("column indices must be an array");for(let t=0;t<e.length;t++)if(e[t]<0||e[t]>=s.columns)throw new RangeError("column indices are out of range")}function Vo(s,e,t,r,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(In("startRow",e),In("endRow",t),In("startColumn",r),In("endColumn",n),e>t||r>n||e<0||e>=s.rows||t<0||t>=s.rows||r<0||r>=s.columns||n<0||n>=s.columns)throw new RangeError("Submatrix indices are out of range")}function Gn(s,e=0){let t=[];for(let r=0;r<s;r++)t.push(e);return t}function In(s,e){if(typeof e!="number")throw new TypeError(`${s} must be a number`)}function Yt(s){if(s.isEmpty())throw new Error("Empty matrix has no elements to index")}function Zp(s){let e=Gn(s.rows);for(let t=0;t<s.rows;++t)for(let r=0;r<s.columns;++r)e[t]+=s.get(t,r);return e}function ed(s){let e=Gn(s.columns);for(let t=0;t<s.rows;++t)for(let r=0;r<s.columns;++r)e[r]+=s.get(t,r);return e}function td(s){let e=0;for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)e+=s.get(t,r);return e}function rd(s){let e=Gn(s.rows,1);for(let t=0;t<s.rows;++t)for(let r=0;r<s.columns;++r)e[t]*=s.get(t,r);return e}function nd(s){let e=Gn(s.columns,1);for(let t=0;t<s.rows;++t)for(let r=0;r<s.columns;++r)e[r]*=s.get(t,r);return e}function sd(s){let e=1;for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)e*=s.get(t,r);return e}function od(s,e,t){let r=s.rows,n=s.columns,o=[];for(let i=0;i<r;i++){let a=0,c=0,u=0;for(let l=0;l<n;l++)u=s.get(i,l)-t[i],a+=u,c+=u*u;e?o.push((c-a*a/n)/(n-1)):o.push((c-a*a/n)/n)}return o}function id(s,e,t){let r=s.rows,n=s.columns,o=[];for(let i=0;i<n;i++){let a=0,c=0,u=0;for(let l=0;l<r;l++)u=s.get(l,i)-t[i],a+=u,c+=u*u;e?o.push((c-a*a/r)/(r-1)):o.push((c-a*a/r)/r)}return o}function ad(s,e,t){let r=s.rows,n=s.columns,o=r*n,i=0,a=0,c=0;for(let u=0;u<r;u++)for(let l=0;l<n;l++)c=s.get(u,l)-t,i+=c,a+=c*c;return e?(a-i*i/o)/(o-1):(a-i*i/o)/o}function cd(s,e){for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)s.set(t,r,s.get(t,r)-e[t])}function ud(s,e){for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)s.set(t,r,s.get(t,r)-e[r])}function ld(s,e){for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)s.set(t,r,s.get(t,r)-e)}function fd(s){let e=[];for(let t=0;t<s.rows;t++){let r=0;for(let n=0;n<s.columns;n++)r+=s.get(t,n)**2/(s.columns-1);e.push(Math.sqrt(r))}return e}function hd(s,e){for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)s.set(t,r,s.get(t,r)/e[t])}function md(s){let e=[];for(let t=0;t<s.columns;t++){let r=0;for(let n=0;n<s.rows;n++)r+=s.get(n,t)**2/(s.rows-1);e.push(Math.sqrt(r))}return e}function pd(s,e){for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)s.set(t,r,s.get(t,r)/e[r])}function dd(s){let e=s.size-1,t=0;for(let r=0;r<s.columns;r++)for(let n=0;n<s.rows;n++)t+=s.get(n,r)**2/e;return Math.sqrt(t)}function gd(s,e){for(let t=0;t<s.rows;t++)for(let r=0;r<s.columns;r++)s.set(t,r,s.get(t,r)/e)}var Z=class s{static from1DArray(e,t,r){if(e*t!==r.length)throw new RangeError("data length does not match given dimensions");let o=new F(e,t);for(let i=0;i<e;i++)for(let a=0;a<t;a++)o.set(i,a,r[i*t+a]);return o}static rowVector(e){let t=new F(1,e.length);for(let r=0;r<e.length;r++)t.set(0,r,e[r]);return t}static columnVector(e){let t=new F(e.length,1);for(let r=0;r<e.length;r++)t.set(r,0,e[r]);return t}static zeros(e,t){return new F(e,t)}static ones(e,t){return new F(e,t).fill(1)}static rand(e,t,r={}){if(typeof r!="object")throw new TypeError("options must be an object");let{random:n=Math.random}=r,o=new F(e,t);for(let i=0;i<e;i++)for(let a=0;a<t;a++)o.set(i,a,n());return o}static randInt(e,t,r={}){if(typeof r!="object")throw new TypeError("options must be an object");let{min:n=0,max:o=1e3,random:i=Math.random}=r;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(n>=o)throw new RangeError("min must be smaller than max");let a=o-n,c=new F(e,t);for(let u=0;u<e;u++)for(let l=0;l<t;l++){let f=n+Math.round(i()*a);c.set(u,l,f)}return c}static eye(e,t,r){t===void 0&&(t=e),r===void 0&&(r=1);let n=Math.min(e,t),o=this.zeros(e,t);for(let i=0;i<n;i++)o.set(i,i,r);return o}static diag(e,t,r){let n=e.length;t===void 0&&(t=n),r===void 0&&(r=t);let o=Math.min(n,t,r),i=this.zeros(t,r);for(let a=0;a<o;a++)i.set(a,a,e[a]);return i}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let r=e.rows,n=e.columns,o=new F(r,n);for(let i=0;i<r;i++)for(let a=0;a<n;a++)o.set(i,a,Math.min(e.get(i,a),t.get(i,a)));return o}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);let r=e.rows,n=e.columns,o=new this(r,n);for(let i=0;i<r;i++)for(let a=0;a<n;a++)o.set(i,a,Math.max(e.get(i,a),t.get(i,a)));return o}static checkMatrix(e){return s.isMatrix(e)?e:new F(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.call(this,t,r);return this}to1DArray(){let e=[];for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}to2DArray(){let e=[];for(let t=0;t<this.rows;t++){e.push([]);for(let r=0;r<this.columns;r++)e[t].push(this.get(t,r))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,t=0,r=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(t=0,o=!1;t<this.columns&&o===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>r?(o=!0,r=t):(n=!1,o=!0);e++}return n}isReducedEchelonForm(){let e=0,t=0,r=-1,n=!0,o=!1;for(;e<this.rows&&n;){for(t=0,o=!1;t<this.columns&&o===!1;)this.get(e,t)===0?t++:this.get(e,t)===1&&t>r?(o=!0,r=t):(n=!1,o=!0);for(let i=t+1;i<this.rows;i++)this.get(e,i)!==0&&(n=!1);e++}return n}echelonForm(){let e=this.clone(),t=0,r=0;for(;t<e.rows&&r<e.columns;){let n=t;for(let o=t;o<e.rows;o++)e.get(o,r)>e.get(n,r)&&(n=o);if(e.get(n,r)===0)r++;else{e.swapRows(t,n);let o=e.get(t,r);for(let i=r;i<e.columns;i++)e.set(t,i,e.get(t,i)/o);for(let i=t+1;i<e.rows;i++){let a=e.get(i,r)/e.get(t,r);e.set(i,r,0);for(let c=r+1;c<e.columns;c++)e.set(i,c,e.get(i,c)-e.get(t,c)*a)}t++,r++}}return e}reducedEchelonForm(){let e=this.echelonForm(),t=e.columns,r=e.rows,n=r-1;for(;n>=0;)if(e.maxRow(n)===0)n--;else{let o=0,i=!1;for(;o<r&&i===!1;)e.get(n,o)===1?i=!0:o++;for(let a=0;a<n;a++){let c=e.get(a,o);for(let u=o;u<t;u++){let l=e.get(a,u)-c*e.get(n,u);e.set(a,u,l)}}n--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");let{rows:t=1,columns:r=1}=e;if(!Number.isInteger(t)||t<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let n=new F(this.rows*t,this.columns*r);for(let o=0;o<t;o++)for(let i=0;i<r;i++)n.setSubMatrix(this,this.rows*o,this.columns*i);return n}fill(e){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,e);return this}neg(){return this.mulS(-1)}getRow(e){Fe(this,e);let t=[];for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}getRowVector(e){return F.rowVector(this.getRow(e))}setRow(e,t){Fe(this,e),t=Zt(this,t);for(let r=0;r<this.columns;r++)this.set(e,r,t[r]);return this}swapRows(e,t){Fe(this,e),Fe(this,t);for(let r=0;r<this.columns;r++){let n=this.get(e,r);this.set(e,r,this.get(t,r)),this.set(t,r,n)}return this}getColumn(e){De(this,e);let t=[];for(let r=0;r<this.rows;r++)t.push(this.get(r,e));return t}getColumnVector(e){return F.columnVector(this.getColumn(e))}setColumn(e,t){De(this,e),t=er(this,t);for(let r=0;r<this.rows;r++)this.set(r,e,t[r]);return this}swapColumns(e,t){De(this,e),De(this,t);for(let r=0;r<this.rows;r++){let n=this.get(r,e);this.set(r,e,this.get(r,t)),this.set(r,t,n)}return this}addRowVector(e){e=Zt(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)+e[r]);return this}subRowVector(e){e=Zt(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)-e[r]);return this}mulRowVector(e){e=Zt(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e[r]);return this}divRowVector(e){e=Zt(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)/e[r]);return this}addColumnVector(e){e=er(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)+e[t]);return this}subColumnVector(e){e=er(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)-e[t]);return this}mulColumnVector(e){e=er(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e[t]);return this}divColumnVector(e){e=er(this,e);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)/e[t]);return this}mulRow(e,t){Fe(this,e);for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this}mulColumn(e,t){De(this,e);for(let r=0;r<this.rows;r++)this.set(r,e,this.get(r,e)*t);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{let t=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t[r]&&(t[r]=this.get(r,n));return t}case"column":{let t=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t[n]&&(t[n]=this.get(r,n));return t}case void 0:{let t=this.get(0,0);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>t&&(t=this.get(r,n));return t}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){Yt(this);let e=this.get(0,0),t=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n),t[0]=r,t[1]=n);return t}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{let t=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t[r]&&(t[r]=this.get(r,n));return t}case"column":{let t=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t[n]&&(t[n]=this.get(r,n));return t}case void 0:{let t=this.get(0,0);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<t&&(t=this.get(r,n));return t}default:throw new Error(`invalid option: ${e}`)}}minIndex(){Yt(this);let e=this.get(0,0),t=[0,0];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n),t[0]=r,t[1]=n);return t}maxRow(e){if(Fe(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxRowIndex(e){Fe(this,e),Yt(this);let t=this.get(e,0),r=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n),r[1]=n);return r}minRow(e){if(Fe(this,e),this.isEmpty())return NaN;let t=this.get(e,0);for(let r=1;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minRowIndex(e){Fe(this,e),Yt(this);let t=this.get(e,0),r=[e,0];for(let n=1;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n),r[1]=n);return r}maxColumn(e){if(De(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)>t&&(t=this.get(r,e));return t}maxColumnIndex(e){De(this,e),Yt(this);let t=this.get(0,e),r=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)>t&&(t=this.get(n,e),r[0]=n);return r}minColumn(e){if(De(this,e),this.isEmpty())return NaN;let t=this.get(0,e);for(let r=1;r<this.rows;r++)this.get(r,e)<t&&(t=this.get(r,e));return t}minColumnIndex(e){De(this,e),Yt(this);let t=this.get(0,e),r=[0,e];for(let n=1;n<this.rows;n++)this.get(n,e)<t&&(t=this.get(n,e),r[0]=n);return r}diag(){let e=Math.min(this.rows,this.columns),t=[];for(let r=0;r<e;r++)t.push(this.get(r,r));return t}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r),this.set(t,r,e);return this}dot(e){s.isMatrix(e)&&(e=e.to1DArray());let t=this.to1DArray();if(t.length!==e.length)throw new RangeError("vectors do not have the same size");let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[n];return r}mmul(e){e=F.checkMatrix(e);let t=this.rows,r=this.columns,n=e.columns,o=new F(t,n),i=new Float64Array(r);for(let a=0;a<n;a++){for(let c=0;c<r;c++)i[c]=e.get(c,a);for(let c=0;c<t;c++){let u=0;for(let l=0;l<r;l++)u+=this.get(c,l)*i[l];o.set(c,a,u)}}return o}mpow(e){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(e)||e<0)throw new RangeError("Exponent must be a non-negative integer");let t=F.eye(this.rows),r=this;for(let n=e;n>=1;n/=2)(n&1)!==0&&(t=t.mmul(r)),r=r.mmul(r);return t}strassen2x2(e){e=F.checkMatrix(e);let t=new F(2,2),r=this.get(0,0),n=e.get(0,0),o=this.get(0,1),i=e.get(0,1),a=this.get(1,0),c=e.get(1,0),u=this.get(1,1),l=e.get(1,1),f=(r+u)*(n+l),h=(a+u)*n,y=r*(i-l),g=u*(c-n),_=(r+o)*l,T=(a-r)*(n+i),d=(o-u)*(c+l),C=f+g-_+d,E=y+_,I=h+g,G=f-h+y+T;return t.set(0,0,C),t.set(0,1,E),t.set(1,0,I),t.set(1,1,G),t}strassen3x3(e){e=F.checkMatrix(e);let t=new F(3,3),r=this.get(0,0),n=this.get(0,1),o=this.get(0,2),i=this.get(1,0),a=this.get(1,1),c=this.get(1,2),u=this.get(2,0),l=this.get(2,1),f=this.get(2,2),h=e.get(0,0),y=e.get(0,1),g=e.get(0,2),_=e.get(1,0),T=e.get(1,1),d=e.get(1,2),C=e.get(2,0),E=e.get(2,1),I=e.get(2,2),G=(r+n+o-i-a-l-f)*T,U=(r-i)*(-y+T),L=a*(-h+y+_-T-d-C+I),O=(-r+i+a)*(h-y+T),N=(i+a)*(-h+y),x=r*h,S=(-r+u+l)*(h-g+d),R=(-r+u)*(g-d),M=(u+l)*(-h+g),J=(r+n+o-a-c-u-l)*d,$=l*(-h+g+_-T-d-C+E),Q=(-o+l+f)*(T+C-E),z=(o-f)*(T-E),ie=o*C,_e=(l+f)*(-C+E),ee=(-o+a+c)*(d+C-I),Ne=(o-c)*(d-I),Qe=(a+c)*(-C+I),j=n*_,ce=c*E,Be=i*g,ve=u*y,se=f*I,Lu=x+ie+j,Ou=G+O+N+x+Q+ie+_e,Pu=x+S+M+J+ie+ee+Qe,Uu=U+L+O+x+ie+ee+Ne,Nu=U+O+N+x+ce,Vu=ie+ee+Ne+Qe+Be,Ju=x+S+R+$+Q+z+ie,Hu=Q+z+ie+_e+ve,ju=x+S+R+M+se;return t.set(0,0,Lu),t.set(0,1,Ou),t.set(0,2,Pu),t.set(1,0,Uu),t.set(1,1,Nu),t.set(1,2,Vu),t.set(2,0,Ju),t.set(2,1,Hu),t.set(2,2,ju),t}mmulStrassen(e){e=F.checkMatrix(e);let t=this.clone(),r=t.rows,n=t.columns,o=e.rows,i=e.columns;n!==o&&console.warn(`Multiplying ${r} x ${n} and ${o} x ${i} matrix: dimensions do not match.`);function a(f,h,y){let g=f.rows,_=f.columns;if(g===h&&_===y)return f;{let T=s.zeros(h,y);return T=T.setSubMatrix(f,0,0),T}}let c=Math.max(r,o),u=Math.max(n,i);t=a(t,c,u),e=a(e,c,u);function l(f,h,y,g){if(y<=512||g<=512)return f.mmul(h);y%2===1&&g%2===1?(f=a(f,y+1,g+1),h=a(h,y+1,g+1)):y%2===1?(f=a(f,y+1,g),h=a(h,y+1,g)):g%2===1&&(f=a(f,y,g+1),h=a(h,y,g+1));let _=parseInt(f.rows/2,10),T=parseInt(f.columns/2,10),d=f.subMatrix(0,_-1,0,T-1),C=h.subMatrix(0,_-1,0,T-1),E=f.subMatrix(0,_-1,T,f.columns-1),I=h.subMatrix(0,_-1,T,h.columns-1),G=f.subMatrix(_,f.rows-1,0,T-1),U=h.subMatrix(_,h.rows-1,0,T-1),L=f.subMatrix(_,f.rows-1,T,f.columns-1),O=h.subMatrix(_,h.rows-1,T,h.columns-1),N=l(s.add(d,L),s.add(C,O),_,T),x=l(s.add(G,L),C,_,T),S=l(d,s.sub(I,O),_,T),R=l(L,s.sub(U,C),_,T),M=l(s.add(d,E),O,_,T),J=l(s.sub(G,d),s.add(C,I),_,T),$=l(s.sub(E,L),s.add(U,O),_,T),Q=s.add(N,R);Q.sub(M),Q.add($);let z=s.add(S,M),ie=s.add(x,R),_e=s.sub(N,x);_e.add(S),_e.add(J);let ee=s.zeros(2*Q.rows,2*Q.columns);return ee=ee.setSubMatrix(Q,0,0),ee=ee.setSubMatrix(z,Q.rows,0),ee=ee.setSubMatrix(ie,0,Q.columns),ee=ee.setSubMatrix(_e,Q.rows,Q.columns),ee.subMatrix(0,y-1,0,g-1)}return l(t,e,c,u)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");let{min:t=0,max:r=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(t>=r)throw new RangeError("min must be smaller than max");let n=new F(this.rows,this.columns);for(let o=0;o<this.rows;o++){let i=this.getRow(o);i.length>0&&au(i,{min:t,max:r,output:i}),n.setRow(o,i)}return n}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");let{min:t=0,max:r=1}=e;if(!Number.isFinite(t))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(t>=r)throw new RangeError("min must be smaller than max");let n=new F(this.rows,this.columns);for(let o=0;o<this.columns;o++){let i=this.getColumn(o);i.length&&au(i,{min:t,max:r,output:i}),n.setColumn(o,i)}return n}flipRows(){let e=Math.ceil(this.columns/2);for(let t=0;t<this.rows;t++)for(let r=0;r<e;r++){let n=this.get(t,r),o=this.get(t,this.columns-1-r);this.set(t,r,o),this.set(t,this.columns-1-r,n)}return this}flipColumns(){let e=Math.ceil(this.rows/2);for(let t=0;t<this.columns;t++)for(let r=0;r<e;r++){let n=this.get(r,t),o=this.get(this.rows-1-r,t);this.set(r,t,o),this.set(this.rows-1-r,t,n)}return this}kroneckerProduct(e){e=F.checkMatrix(e);let t=this.rows,r=this.columns,n=e.rows,o=e.columns,i=new F(t*n,r*o);for(let a=0;a<t;a++)for(let c=0;c<r;c++)for(let u=0;u<n;u++)for(let l=0;l<o;l++)i.set(n*a+u,o*c+l,this.get(a,c)*e.get(u,l));return i}kroneckerSum(e){if(e=F.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let t=this.rows,r=e.rows,n=this.kroneckerProduct(F.eye(r,r)),o=F.eye(t,t).kroneckerProduct(e);return n.add(o)}transpose(){let e=new F(this.columns,this.rows);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e.set(r,t,this.get(t,r));return e}sortRows(e=uu){for(let t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(e));return this}sortColumns(e=uu){for(let t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(e));return this}subMatrix(e,t,r,n){Vo(this,e,t,r,n);let o=new F(t-e+1,n-r+1);for(let i=e;i<=t;i++)for(let a=r;a<=n;a++)o.set(i-e,a-r,this.get(i,a));return o}subMatrixRow(e,t,r){if(t===void 0&&(t=0),r===void 0&&(r=this.columns-1),t>r||t<0||t>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let n=new F(e.length,r-t+1);for(let o=0;o<e.length;o++)for(let i=t;i<=r;i++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);n.set(o,i-t,this.get(e[o],i))}return n}subMatrixColumn(e,t,r){if(t===void 0&&(t=0),r===void 0&&(r=this.rows-1),t>r||t<0||t>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let n=new F(r-t+1,e.length);for(let o=0;o<e.length;o++)for(let i=t;i<=r;i++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);n.set(i-t,o,this.get(i,e[o]))}return n}setSubMatrix(e,t,r){if(e=F.checkMatrix(e),e.isEmpty())return this;let n=t+e.rows-1,o=r+e.columns-1;Vo(this,t,n,r,o);for(let i=0;i<e.rows;i++)for(let a=0;a<e.columns;a++)this.set(t+i,r+a,e.get(i,a));return this}selection(e,t){qo(this,e),zo(this,t);let r=new F(e.length,t.length);for(let n=0;n<e.length;n++){let o=e[n];for(let i=0;i<t.length;i++){let a=t[i];r.set(n,i,this.get(o,a))}}return r}trace(){let e=Math.min(this.rows,this.columns),t=0;for(let r=0;r<e;r++)t+=this.get(r,r);return t}clone(){return this.constructor.copy(this,new F(this.rows,this.columns))}static copy(e,t){for(let[r,n,o]of e.entries())t.set(r,n,o);return t}sum(e){switch(e){case"row":return Zp(this);case"column":return ed(this);case void 0:return td(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return rd(this);case"column":return nd(this);case void 0:return sd(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){let t=this.sum(e);switch(e){case"row":{for(let r=0;r<this.rows;r++)t[r]/=this.columns;return t}case"column":{for(let r=0;r<this.columns;r++)t[r]/=this.rows;return t}case void 0:return t/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");let{unbiased:r=!0,mean:n=this.mean(e)}=t;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Ae.isAnyArray(n))throw new TypeError("mean must be an array");return od(this,r,n)}case"column":{if(!Ae.isAnyArray(n))throw new TypeError("mean must be an array");return id(this,r,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return ad(this,r,n)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,t){typeof e=="object"&&(t=e,e=void 0);let r=this.variance(e,t);if(e===void 0)return Math.sqrt(r);for(let n=0;n<r.length;n++)r[n]=Math.sqrt(r[n]);return r}center(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");let{center:r=this.mean(e)}=t;switch(e){case"row":{if(!Ae.isAnyArray(r))throw new TypeError("center must be an array");return cd(this,r),this}case"column":{if(!Ae.isAnyArray(r))throw new TypeError("center must be an array");return ud(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return ld(this,r),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,t={}){if(typeof e=="object"&&(t=e,e=void 0),typeof t!="object")throw new TypeError("options must be an object");let r=t.scale;switch(e){case"row":{if(r===void 0)r=fd(this);else if(!Ae.isAnyArray(r))throw new TypeError("scale must be an array");return hd(this,r),this}case"column":{if(r===void 0)r=md(this);else if(!Ae.isAnyArray(r))throw new TypeError("scale must be an array");return pd(this,r),this}case void 0:{if(r===void 0)r=dd(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return gd(this,r),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return fu(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)yield[e,t,this.get(e,t)]}*values(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)yield this.get(e,t)}};Z.prototype.klass="Matrix";typeof Symbol<"u"&&(Z.prototype[Symbol.for("nodejs.util.inspect.custom")]=Qp);function uu(s,e){return s-e}function yd(s){return s.every(e=>typeof e=="number")}Z.random=Z.rand;Z.randomInt=Z.randInt;Z.diagonal=Z.diag;Z.prototype.diagonal=Z.prototype.diag;Z.identity=Z.eye;Z.prototype.negate=Z.prototype.neg;Z.prototype.tensorProduct=Z.prototype.kroneckerProduct;var F=class s extends Z{data;#e(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let r=0;r<e;r++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t}constructor(e,t){if(super(),s.isMatrix(e))this.#e(e.rows,e.columns),s.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#e(e,t);else if(Ae.isAnyArray(e)){let r=e;if(e=r.length,t=e?r[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(r[n].length!==t)throw new RangeError("Inconsistent array dimensions");if(!yd(r[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[n]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}removeRow(e){return Fe(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),Fe(this,e,!0),t=Float64Array.from(Zt(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){De(this,e);for(let t=0;t<this.rows;t++){let r=new Float64Array(this.columns-1);for(let n=0;n<e;n++)r[n]=this.data[t][n];for(let n=e+1;n<this.columns;n++)r[n-1]=this.data[t][n];this.data[t]=r}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),De(this,e,!0),t=er(this,t);for(let r=0;r<this.rows;r++){let n=new Float64Array(this.columns+1),o=0;for(;o<e;o++)n[o]=this.data[r][o];for(n[o++]=t[r];o<this.columns+1;o++)n[o]=this.data[r][o-1];this.data[r]=n}return this.columns+=1,this}};Yp(Z,F);var Et=class s extends Z{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return F.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}constructor(e){if(super(),F.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");this.#e=F.copy(e,new F(e.rows,e.rows))}else if(Number.isInteger(e)&&e>=0)this.#e=new F(e,e);else if(this.#e=new F(e),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){let e=new s(this.diagonalSize);for(let[t,r,n]of this.upperRightEntries())e.set(t,r,n);return e}toMatrix(){return new F(this)}get(e,t){return this.#e.get(e,t)}set(e,t,r){return this.#e.set(e,t,r),this.#e.set(t,e,r),this}removeCross(e){return this.#e.removeRow(e),this.#e.removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);let r=t.slice();return r.splice(e,1),this.#e.addRow(e,r),this.#e.addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");let t=[];for(let[r,n]of e.entries())n||t.push(r);t.reverse();for(let r of t)this.removeCross(r);return this}toCompact(){let{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let r=0,n=0,o=0;o<t.length;o++)t[o]=this.get(n,r),++r>=e&&(r=++n);return t}static fromCompact(e){let t=e.length,r=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);let n=new s(r);for(let o=0,i=0,a=0;a<t;a++)n.set(o,i,e[a]),++o>=r&&(o=++i);return n}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){let r=this.get(e,t);yield[e,t,r],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};Et.prototype.klassType="SymmetricMatrix";var Sn=class s extends Et{static isDistanceMatrix(e){return Et.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,t,r){return e===t&&(r=0),super.set(e,t,r)}addCross(e,t){return t===void 0&&(t=e,e=this.diagonalSize),t=t.slice(),t[e]=0,super.addCross(e,t)}toSymmetricMatrix(){return new Et(this)}clone(){let e=new s(this.diagonalSize);for(let[t,r,n]of this.upperRightEntries())t!==r&&e.set(t,r,n);return e}toCompact(){let{diagonalSize:e}=this,t=(e-1)*e/2,r=new Array(t);for(let n=1,o=0,i=0;i<r.length;i++)r[i]=this.get(o,n),++n>=e&&(n=++o+1);return r}static fromCompact(e){let t=e.length;if(t===0)return new this(0);let r=(Math.sqrt(8*t+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);let n=new this(r);for(let o=1,i=0,a=0;a<t;a++)n.set(o,i,e[a]),++o>=r&&(o=++i+1);return n}};Sn.prototype.klassSubType="DistanceMatrix";var Oe=class extends Z{constructor(e,t,r){super(),this.matrix=e,this.rows=t,this.columns=r}},Jo=class extends Oe{constructor(e,t){De(e,t),super(e,e.rows,1),this.column=t}set(e,t,r){return this.matrix.set(e,this.column,r),this}get(e){return this.matrix.get(e,this.column)}},Ho=class extends Oe{constructor(e,t){zo(e,t),super(e,e.rows,t.length),this.columnIndices=t}set(e,t,r){return this.matrix.set(e,this.columnIndices[t],r),this}get(e,t){return this.matrix.get(e,this.columnIndices[t])}},jo=class extends Oe{constructor(e){super(e,e.rows,e.columns)}set(e,t,r){return this.matrix.set(e,this.columns-t-1,r),this}get(e,t){return this.matrix.get(e,this.columns-t-1)}},$o=class extends Oe{constructor(e){super(e,e.rows,e.columns)}set(e,t,r){return this.matrix.set(this.rows-e-1,t,r),this}get(e,t){return this.matrix.get(this.rows-e-1,t)}},Wo=class extends Oe{constructor(e,t){Fe(e,t),super(e,1,e.columns),this.row=t}set(e,t,r){return this.matrix.set(this.row,t,r),this}get(e,t){return this.matrix.get(this.row,t)}},Ko=class extends Oe{constructor(e,t){qo(e,t),super(e,t.length,e.columns),this.rowIndices=t}set(e,t,r){return this.matrix.set(this.rowIndices[e],t,r),this}get(e,t){return this.matrix.get(this.rowIndices[e],t)}},tr=class extends Oe{constructor(e,t,r){qo(e,t),zo(e,r),super(e,t.length,r.length),this.rowIndices=t,this.columnIndices=r}set(e,t,r){return this.matrix.set(this.rowIndices[e],this.columnIndices[t],r),this}get(e,t){return this.matrix.get(this.rowIndices[e],this.columnIndices[t])}},Xo=class extends Oe{constructor(e,t,r,n,o){Vo(e,t,r,n,o),super(e,r-t+1,o-n+1),this.startRow=t,this.startColumn=n}set(e,t,r){return this.matrix.set(this.startRow+e,this.startColumn+t,r),this}get(e,t){return this.matrix.get(this.startRow+e,this.startColumn+t)}},Qo=class extends Oe{constructor(e){super(e,e.columns,e.rows)}set(e,t,r){return this.matrix.set(t,e,r),this}get(e,t){return this.matrix.get(t,e)}},Mn=class extends Z{constructor(e,t={}){let{rows:r=1}=t;if(e.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=e.length/r,this.data=e}set(e,t,r){let n=this._calculateIndex(e,t);return this.data[n]=r,this}get(e,t){let r=this._calculateIndex(e,t);return this.data[r]}_calculateIndex(e,t){return e*this.columns+t}},ge=class extends Z{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}};function xd(s,e){if(Ae.isAnyArray(s))return s[0]&&Ae.isAnyArray(s[0])?new ge(s):new Mn(s,e);throw new Error("the argument is not an array")}var rr=class{constructor(e){e=ge.checkMatrix(e);let t=e.clone(),r=t.rows,n=t.columns,o=new Float64Array(r),i=1,a,c,u,l,f,h,y,g,_;for(a=0;a<r;a++)o[a]=a;for(g=new Float64Array(r),c=0;c<n;c++){for(a=0;a<r;a++)g[a]=t.get(a,c);for(a=0;a<r;a++){for(_=Math.min(a,c),f=0,u=0;u<_;u++)f+=t.get(a,u)*g[u];g[a]-=f,t.set(a,c,g[a])}for(l=c,a=c+1;a<r;a++)Math.abs(g[a])>Math.abs(g[l])&&(l=a);if(l!==c){for(u=0;u<n;u++)h=t.get(l,u),t.set(l,u,t.get(c,u)),t.set(c,u,h);y=o[l],o[l]=o[c],o[c]=y,i=-i}if(c<r&&t.get(c,c)!==0)for(a=c+1;a<r;a++)t.set(a,c,t.get(a,c)/t.get(c,c))}this.LU=t,this.pivotVector=o,this.pivotSign=i}isSingular(){let e=this.LU,t=e.columns;for(let r=0;r<t;r++)if(e.get(r,r)===0)return!0;return!1}solve(e){e=F.checkMatrix(e);let t=this.LU;if(t.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=e.columns,o=e.subMatrixRow(this.pivotVector,0,n-1),i=t.columns,a,c,u;for(u=0;u<i;u++)for(a=u+1;a<i;a++)for(c=0;c<n;c++)o.set(a,c,o.get(a,c)-o.get(u,c)*t.get(a,u));for(u=i-1;u>=0;u--){for(c=0;c<n;c++)o.set(u,c,o.get(u,c)/t.get(u,u));for(a=0;a<u;a++)for(c=0;c<n;c++)o.set(a,c,o.get(a,c)-o.get(u,c)*t.get(a,u))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let t=this.pivotSign,r=e.columns;for(let n=0;n<r;n++)t*=e.get(n,n);return t}get lowerTriangularMatrix(){let e=this.LU,t=e.rows,r=e.columns,n=new F(t,r);for(let o=0;o<t;o++)for(let i=0;i<r;i++)o>i?n.set(o,i,e.get(o,i)):o===i?n.set(o,i,1):n.set(o,i,0);return n}get upperTriangularMatrix(){let e=this.LU,t=e.rows,r=e.columns,n=new F(t,r);for(let o=0;o<t;o++)for(let i=0;i<r;i++)o<=i?n.set(o,i,e.get(o,i)):n.set(o,i,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function et(s,e){let t=0;return Math.abs(s)>Math.abs(e)?(t=e/s,Math.abs(s)*Math.sqrt(1+t*t)):e!==0?(t=s/e,Math.abs(e)*Math.sqrt(1+t*t)):0}var Dr=class{constructor(e){e=ge.checkMatrix(e);let t=e.clone(),r=e.rows,n=e.columns,o=new Float64Array(n),i,a,c,u;for(c=0;c<n;c++){let l=0;for(i=c;i<r;i++)l=et(l,t.get(i,c));if(l!==0){for(t.get(c,c)<0&&(l=-l),i=c;i<r;i++)t.set(i,c,t.get(i,c)/l);for(t.set(c,c,t.get(c,c)+1),a=c+1;a<n;a++){for(u=0,i=c;i<r;i++)u+=t.get(i,c)*t.get(i,a);for(u=-u/t.get(c,c),i=c;i<r;i++)t.set(i,a,t.get(i,a)+u*t.get(i,c))}}o[c]=-l}this.QR=t,this.Rdiag=o}solve(e){e=F.checkMatrix(e);let t=this.QR,r=t.rows;if(e.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=e.columns,o=e.clone(),i=t.columns,a,c,u,l;for(u=0;u<i;u++)for(c=0;c<n;c++){for(l=0,a=u;a<r;a++)l+=t.get(a,u)*o.get(a,c);for(l=-l/t.get(u,u),a=u;a<r;a++)o.set(a,c,o.get(a,c)+l*t.get(a,u))}for(u=i-1;u>=0;u--){for(c=0;c<n;c++)o.set(u,c,o.get(u,c)/this.Rdiag[u]);for(a=0;a<u;a++)for(c=0;c<n;c++)o.set(a,c,o.get(a,c)-o.get(u,c)*t.get(a,u))}return o.subMatrix(0,i-1,0,n-1)}isFullRank(){let e=this.QR.columns;for(let t=0;t<e;t++)if(this.Rdiag[t]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,t=e.columns,r=new F(t,t),n,o;for(n=0;n<t;n++)for(o=0;o<t;o++)n<o?r.set(n,o,e.get(n,o)):n===o?r.set(n,o,this.Rdiag[n]):r.set(n,o,0);return r}get orthogonalMatrix(){let e=this.QR,t=e.rows,r=e.columns,n=new F(t,r),o,i,a,c;for(a=r-1;a>=0;a--){for(o=0;o<t;o++)n.set(o,a,0);for(n.set(a,a,1),i=a;i<r;i++)if(e.get(a,a)!==0){for(c=0,o=a;o<t;o++)c+=e.get(o,a)*n.get(o,i);for(c=-c/e.get(a,a),o=a;o<t;o++)n.set(o,i,n.get(o,i)+c*e.get(o,a))}}return n}},ut=class{constructor(e,t={}){if(e=ge.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let r=e.rows,n=e.columns,{computeLeftSingularVectors:o=!0,computeRightSingularVectors:i=!0,autoTranspose:a=!1}=t,c=!!o,u=!!i,l=!1,f;if(r<n)if(!a)f=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=e.transpose(),r=f.rows,n=f.columns,l=!0;let x=c;c=u,u=x}else f=e.clone();let h=Math.min(r,n),y=Math.min(r+1,n),g=new Float64Array(y),_=new F(r,h),T=new F(n,n),d=new Float64Array(n),C=new Float64Array(r),E=new Float64Array(y);for(let x=0;x<y;x++)E[x]=x;let I=Math.min(r-1,n),G=Math.max(0,Math.min(n-2,r)),U=Math.max(I,G);for(let x=0;x<U;x++){if(x<I){g[x]=0;for(let S=x;S<r;S++)g[x]=et(g[x],f.get(S,x));if(g[x]!==0){f.get(x,x)<0&&(g[x]=-g[x]);for(let S=x;S<r;S++)f.set(S,x,f.get(S,x)/g[x]);f.set(x,x,f.get(x,x)+1)}g[x]=-g[x]}for(let S=x+1;S<n;S++){if(x<I&&g[x]!==0){let R=0;for(let M=x;M<r;M++)R+=f.get(M,x)*f.get(M,S);R=-R/f.get(x,x);for(let M=x;M<r;M++)f.set(M,S,f.get(M,S)+R*f.get(M,x))}d[S]=f.get(x,S)}if(c&&x<I)for(let S=x;S<r;S++)_.set(S,x,f.get(S,x));if(x<G){d[x]=0;for(let S=x+1;S<n;S++)d[x]=et(d[x],d[S]);if(d[x]!==0){d[x+1]<0&&(d[x]=0-d[x]);for(let S=x+1;S<n;S++)d[S]/=d[x];d[x+1]+=1}if(d[x]=-d[x],x+1<r&&d[x]!==0){for(let S=x+1;S<r;S++)C[S]=0;for(let S=x+1;S<r;S++)for(let R=x+1;R<n;R++)C[S]+=d[R]*f.get(S,R);for(let S=x+1;S<n;S++){let R=-d[S]/d[x+1];for(let M=x+1;M<r;M++)f.set(M,S,f.get(M,S)+R*C[M])}}if(u)for(let S=x+1;S<n;S++)T.set(S,x,d[S])}}let L=Math.min(n,r+1);if(I<n&&(g[I]=f.get(I,I)),r<L&&(g[L-1]=0),G+1<L&&(d[G]=f.get(G,L-1)),d[L-1]=0,c){for(let x=I;x<h;x++){for(let S=0;S<r;S++)_.set(S,x,0);_.set(x,x,1)}for(let x=I-1;x>=0;x--)if(g[x]!==0){for(let S=x+1;S<h;S++){let R=0;for(let M=x;M<r;M++)R+=_.get(M,x)*_.get(M,S);R=-R/_.get(x,x);for(let M=x;M<r;M++)_.set(M,S,_.get(M,S)+R*_.get(M,x))}for(let S=x;S<r;S++)_.set(S,x,-_.get(S,x));_.set(x,x,1+_.get(x,x));for(let S=0;S<x-1;S++)_.set(S,x,0)}else{for(let S=0;S<r;S++)_.set(S,x,0);_.set(x,x,1)}}if(u)for(let x=n-1;x>=0;x--){if(x<G&&d[x]!==0)for(let S=x+1;S<n;S++){let R=0;for(let M=x+1;M<n;M++)R+=T.get(M,x)*T.get(M,S);R=-R/T.get(x+1,x);for(let M=x+1;M<n;M++)T.set(M,S,T.get(M,S)+R*T.get(M,x))}for(let S=0;S<n;S++)T.set(S,x,0);T.set(x,x,1)}let O=L-1,N=Number.EPSILON;for(;L>0;){let x,S;for(x=L-2;x>=-1&&x!==-1;x--){let R=Number.MIN_VALUE+N*Math.abs(g[x]+Math.abs(g[x+1]));if(Math.abs(d[x])<=R||Number.isNaN(d[x])){d[x]=0;break}}if(x===L-2)S=4;else{let R;for(R=L-1;R>=x&&R!==x;R--){let M=(R!==L?Math.abs(d[R]):0)+(R!==x+1?Math.abs(d[R-1]):0);if(Math.abs(g[R])<=N*M){g[R]=0;break}}R===x?S=3:R===L-1?S=1:(S=2,x=R)}switch(x++,S){case 1:{let R=d[L-2];d[L-2]=0;for(let M=L-2;M>=x;M--){let J=et(g[M],R),$=g[M]/J,Q=R/J;if(g[M]=J,M!==x&&(R=-Q*d[M-1],d[M-1]=$*d[M-1]),u)for(let z=0;z<n;z++)J=$*T.get(z,M)+Q*T.get(z,L-1),T.set(z,L-1,-Q*T.get(z,M)+$*T.get(z,L-1)),T.set(z,M,J)}break}case 2:{let R=d[x-1];d[x-1]=0;for(let M=x;M<L;M++){let J=et(g[M],R),$=g[M]/J,Q=R/J;if(g[M]=J,R=-Q*d[M],d[M]=$*d[M],c)for(let z=0;z<r;z++)J=$*_.get(z,M)+Q*_.get(z,x-1),_.set(z,x-1,-Q*_.get(z,M)+$*_.get(z,x-1)),_.set(z,M,J)}break}case 3:{let R=Math.max(Math.abs(g[L-1]),Math.abs(g[L-2]),Math.abs(d[L-2]),Math.abs(g[x]),Math.abs(d[x])),M=g[L-1]/R,J=g[L-2]/R,$=d[L-2]/R,Q=g[x]/R,z=d[x]/R,ie=((J+M)*(J-M)+$*$)/2,_e=M*$*(M*$),ee=0;(ie!==0||_e!==0)&&(ie<0?ee=0-Math.sqrt(ie*ie+_e):ee=Math.sqrt(ie*ie+_e),ee=_e/(ie+ee));let Ne=(Q+M)*(Q-M)+ee,Qe=Q*z;for(let j=x;j<L-1;j++){let ce=et(Ne,Qe);ce===0&&(ce=Number.MIN_VALUE);let Be=Ne/ce,ve=Qe/ce;if(j!==x&&(d[j-1]=ce),Ne=Be*g[j]+ve*d[j],d[j]=Be*d[j]-ve*g[j],Qe=ve*g[j+1],g[j+1]=Be*g[j+1],u)for(let se=0;se<n;se++)ce=Be*T.get(se,j)+ve*T.get(se,j+1),T.set(se,j+1,-ve*T.get(se,j)+Be*T.get(se,j+1)),T.set(se,j,ce);if(ce=et(Ne,Qe),ce===0&&(ce=Number.MIN_VALUE),Be=Ne/ce,ve=Qe/ce,g[j]=ce,Ne=Be*d[j]+ve*g[j+1],g[j+1]=-ve*d[j]+Be*g[j+1],Qe=ve*d[j+1],d[j+1]=Be*d[j+1],c&&j<r-1)for(let se=0;se<r;se++)ce=Be*_.get(se,j)+ve*_.get(se,j+1),_.set(se,j+1,-ve*_.get(se,j)+Be*_.get(se,j+1)),_.set(se,j,ce)}d[L-2]=Ne;break}case 4:{if(g[x]<=0&&(g[x]=g[x]<0?-g[x]:0,u))for(let R=0;R<=O;R++)T.set(R,x,-T.get(R,x));for(;x<O&&!(g[x]>=g[x+1]);){let R=g[x];if(g[x]=g[x+1],g[x+1]=R,u&&x<n-1)for(let M=0;M<n;M++)R=T.get(M,x+1),T.set(M,x+1,T.get(M,x)),T.set(M,x,R);if(c&&x<r-1)for(let M=0;M<r;M++)R=_.get(M,x+1),_.set(M,x+1,_.get(M,x)),_.set(M,x,R);x++}L--;break}}}if(l){let x=T;T=_,_=x}this.m=r,this.n=n,this.s=g,this.U=_,this.V=T}solve(e){let t=e,r=this.threshold,n=this.s.length,o=F.zeros(n,n);for(let h=0;h<n;h++)Math.abs(this.s[h])<=r?o.set(h,h,0):o.set(h,h,1/this.s[h]);let i=this.U,a=this.rightSingularVectors,c=a.mmul(o),u=a.rows,l=i.rows,f=F.zeros(u,l);for(let h=0;h<u;h++)for(let y=0;y<l;y++){let g=0;for(let _=0;_<n;_++)g+=c.get(h,_)*i.get(y,_);f.set(h,y,g)}return f.mmul(t)}solveForDiagonal(e){return this.solve(F.diag(e))}inverse(){let e=this.V,t=this.threshold,r=e.rows,n=e.columns,o=new F(r,this.s.length);for(let l=0;l<r;l++)for(let f=0;f<n;f++)Math.abs(this.s[f])>t&&o.set(l,f,e.get(l,f)/this.s[f]);let i=this.U,a=i.rows,c=i.columns,u=new F(r,a);for(let l=0;l<r;l++)for(let f=0;f<a;f++){let h=0;for(let y=0;y<c;y++)h+=o.get(l,y)*i.get(f,y);u.set(l,f,h)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,r=this.s;for(let n=0,o=r.length;n<o;n++)r[n]>e&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return F.diag(this.s)}};function bd(s,e=!1){return s=ge.checkMatrix(s),e?new ut(s).inverse():hu(s,F.eye(s.rows))}function hu(s,e,t=!1){return s=ge.checkMatrix(s),e=ge.checkMatrix(e),t?new ut(s).solve(e):s.isSquare()?new rr(s).solve(e):new Dr(s).solve(e)}function kn(s){if(s=F.checkMatrix(s),s.isSquare()){if(s.columns===0)return 1;let e,t,r,n;if(s.columns===2)return e=s.get(0,0),t=s.get(0,1),r=s.get(1,0),n=s.get(1,1),e*n-t*r;if(s.columns===3){let o,i,a;return o=new tr(s,[1,2],[1,2]),i=new tr(s,[1,2],[0,2]),a=new tr(s,[1,2],[0,1]),e=s.get(0,0),t=s.get(0,1),r=s.get(0,2),e*kn(o)-t*kn(i)+r*kn(a)}else return new rr(s).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Ad(s,e){let t=[];for(let r=0;r<s;r++)r!==e&&t.push(r);return t}function wd(s,e,t,r=1e-9,n=1e-9){if(s>n)return new Array(e.rows+1).fill(0);{let o=e.addRow(t,[0]);for(let i=0;i<o.rows;i++)Math.abs(o.get(i,0))<r&&o.set(i,0,0);return o.to1DArray()}}function _d(s,e={}){let{thresholdValue:t=1e-9,thresholdError:r=1e-9}=e;s=F.checkMatrix(s);let n=s.rows,o=new F(n,n);for(let i=0;i<n;i++){let a=F.columnVector(s.getRow(i)),c=s.subMatrixRow(Ad(n,i)).transpose(),l=new ut(c).solve(a),f=F.sub(a,c.mmul(l)).abs().max();o.setRow(i,wd(f,l,i,t,r))}return o}function Bd(s,e=Number.EPSILON){if(s=F.checkMatrix(s),s.isEmpty())return s.transpose();let t=new ut(s,{autoTranspose:!0}),r=t.leftSingularVectors,n=t.rightSingularVectors,o=t.diagonal;for(let i=0;i<o.length;i++)Math.abs(o[i])>e?o[i]=1/o[i]:o[i]=0;return n.mmul(F.diag(o).mmul(r.transpose()))}function vd(s,e=s,t={}){s=new F(s);let r=!1;if(typeof e=="object"&&!F.isMatrix(e)&&!Ae.isAnyArray(e)?(t=e,e=s,r=!0):e=new F(e),s.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");let{center:n=!0}=t;n&&(s=s.center("column"),r||(e=e.center("column")));let o=s.transpose().mmul(e);for(let i=0;i<o.rows;i++)for(let a=0;a<o.columns;a++)o.set(i,a,o.get(i,a)*(1/(s.rows-1)));return o}function Ed(s,e=s,t={}){s=new F(s);let r=!1;if(typeof e=="object"&&!F.isMatrix(e)&&!Ae.isAnyArray(e)?(t=e,e=s,r=!0):e=new F(e),s.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");let{center:n=!0,scale:o=!0}=t;n&&(s.center("column"),r||e.center("column")),o&&(s.scale("column"),r||e.scale("column"));let i=s.standardDeviation("column",{unbiased:!0}),a=r?i:e.standardDeviation("column",{unbiased:!0}),c=s.transpose().mmul(e);for(let u=0;u<c.rows;u++)for(let l=0;l<c.columns;l++)c.set(u,l,c.get(u,l)*(1/(i[u]*a[l]))*(1/(s.rows-1)));return c}var Fn=class{constructor(e,t={}){let{assumeSymmetric:r=!1}=t;if(e=ge.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let n=e.columns,o=new F(n,n),i=new Float64Array(n),a=new Float64Array(n),c=e,u,l,f=!1;if(r?f=!0:f=e.isSymmetric(),f){for(u=0;u<n;u++)for(l=0;l<n;l++)o.set(u,l,c.get(u,l));Td(n,a,i,o),Id(n,a,i,o)}else{let h=new F(n,n),y=new Float64Array(n);for(l=0;l<n;l++)for(u=0;u<n;u++)h.set(u,l,c.get(u,l));Cd(n,h,y,o),kd(n,a,i,o,h)}this.n=n,this.e=a,this.d=i,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,t=this.e,r=this.d,n=new F(e,e),o,i;for(o=0;o<e;o++){for(i=0;i<e;i++)n.set(o,i,0);n.set(o,o,r[o]),t[o]>0?n.set(o,o+1,t[o]):t[o]<0&&n.set(o,o-1,t[o])}return n}};function Td(s,e,t,r){let n,o,i,a,c,u,l,f;for(c=0;c<s;c++)t[c]=r.get(s-1,c);for(a=s-1;a>0;a--){for(f=0,i=0,u=0;u<a;u++)f=f+Math.abs(t[u]);if(f===0)for(e[a]=t[a-1],c=0;c<a;c++)t[c]=r.get(a-1,c),r.set(a,c,0),r.set(c,a,0);else{for(u=0;u<a;u++)t[u]/=f,i+=t[u]*t[u];for(n=t[a-1],o=Math.sqrt(i),n>0&&(o=-o),e[a]=f*o,i=i-n*o,t[a-1]=n-o,c=0;c<a;c++)e[c]=0;for(c=0;c<a;c++){for(n=t[c],r.set(c,a,n),o=e[c]+r.get(c,c)*n,u=c+1;u<=a-1;u++)o+=r.get(u,c)*t[u],e[u]+=r.get(u,c)*n;e[c]=o}for(n=0,c=0;c<a;c++)e[c]/=i,n+=e[c]*t[c];for(l=n/(i+i),c=0;c<a;c++)e[c]-=l*t[c];for(c=0;c<a;c++){for(n=t[c],o=e[c],u=c;u<=a-1;u++)r.set(u,c,r.get(u,c)-(n*e[u]+o*t[u]));t[c]=r.get(a-1,c),r.set(a,c,0)}}t[a]=i}for(a=0;a<s-1;a++){if(r.set(s-1,a,r.get(a,a)),r.set(a,a,1),i=t[a+1],i!==0){for(u=0;u<=a;u++)t[u]=r.get(u,a+1)/i;for(c=0;c<=a;c++){for(o=0,u=0;u<=a;u++)o+=r.get(u,a+1)*r.get(u,c);for(u=0;u<=a;u++)r.set(u,c,r.get(u,c)-o*t[u])}}for(u=0;u<=a;u++)r.set(u,a+1,0)}for(c=0;c<s;c++)t[c]=r.get(s-1,c),r.set(s-1,c,0);r.set(s-1,s-1,1),e[0]=0}function Id(s,e,t,r){let n,o,i,a,c,u,l,f,h,y,g,_,T,d,C,E;for(i=1;i<s;i++)e[i-1]=e[i];e[s-1]=0;let I=0,G=0,U=Number.EPSILON;for(u=0;u<s;u++){for(G=Math.max(G,Math.abs(t[u])+Math.abs(e[u])),l=u;l<s&&!(Math.abs(e[l])<=U*G);)l++;if(l>u)do{for(n=t[u],f=(t[u+1]-n)/(2*e[u]),h=et(f,1),f<0&&(h=-h),t[u]=e[u]/(f+h),t[u+1]=e[u]*(f+h),y=t[u+1],o=n-t[u],i=u+2;i<s;i++)t[i]-=o;for(I=I+o,f=t[l],g=1,_=g,T=g,d=e[u+1],C=0,E=0,i=l-1;i>=u;i--)for(T=_,_=g,E=C,n=g*e[i],o=g*f,h=et(f,e[i]),e[i+1]=C*h,C=e[i]/h,g=f/h,f=g*t[i]-C*n,t[i+1]=o+C*(g*n+C*t[i]),c=0;c<s;c++)o=r.get(c,i+1),r.set(c,i+1,C*r.get(c,i)+g*o),r.set(c,i,g*r.get(c,i)-C*o);f=-C*E*T*d*e[u]/y,e[u]=C*f,t[u]=g*f}while(Math.abs(e[u])>U*G);t[u]=t[u]+I,e[u]=0}for(i=0;i<s-1;i++){for(c=i,f=t[i],a=i+1;a<s;a++)t[a]<f&&(c=a,f=t[a]);if(c!==i)for(t[c]=t[i],t[i]=f,a=0;a<s;a++)f=r.get(a,i),r.set(a,i,r.get(a,c)),r.set(a,c,f)}}function Cd(s,e,t,r){let n=0,o=s-1,i,a,c,u,l,f,h;for(f=n+1;f<=o-1;f++){for(h=0,u=f;u<=o;u++)h=h+Math.abs(e.get(u,f-1));if(h!==0){for(c=0,u=o;u>=f;u--)t[u]=e.get(u,f-1)/h,c+=t[u]*t[u];for(a=Math.sqrt(c),t[f]>0&&(a=-a),c=c-t[f]*a,t[f]=t[f]-a,l=f;l<s;l++){for(i=0,u=o;u>=f;u--)i+=t[u]*e.get(u,l);for(i=i/c,u=f;u<=o;u++)e.set(u,l,e.get(u,l)-i*t[u])}for(u=0;u<=o;u++){for(i=0,l=o;l>=f;l--)i+=t[l]*e.get(u,l);for(i=i/c,l=f;l<=o;l++)e.set(u,l,e.get(u,l)-i*t[l])}t[f]=h*t[f],e.set(f,f-1,h*a)}}for(u=0;u<s;u++)for(l=0;l<s;l++)r.set(u,l,u===l?1:0);for(f=o-1;f>=n+1;f--)if(e.get(f,f-1)!==0){for(u=f+1;u<=o;u++)t[u]=e.get(u,f-1);for(l=f;l<=o;l++){for(a=0,u=f;u<=o;u++)a+=t[u]*r.get(u,l);for(a=a/t[f]/e.get(f,f-1),u=f;u<=o;u++)r.set(u,l,r.get(u,l)+a*t[u])}}}function kd(s,e,t,r,n){let o=s-1,i=0,a=s-1,c=Number.EPSILON,u=0,l=0,f=0,h=0,y=0,g=0,_=0,T=0,d,C,E,I,G,U,L,O,N,x,S,R,M,J,$;for(d=0;d<s;d++)for((d<i||d>a)&&(t[d]=n.get(d,d),e[d]=0),C=Math.max(d-1,0);C<s;C++)l=l+Math.abs(n.get(d,C));for(;o>=i;){for(I=o;I>i&&(g=Math.abs(n.get(I-1,I-1))+Math.abs(n.get(I,I)),g===0&&(g=l),!(Math.abs(n.get(I,I-1))<c*g));)I--;if(I===o)n.set(o,o,n.get(o,o)+u),t[o]=n.get(o,o),e[o]=0,o--,T=0;else if(I===o-1){if(L=n.get(o,o-1)*n.get(o-1,o),f=(n.get(o-1,o-1)-n.get(o,o))/2,h=f*f+L,_=Math.sqrt(Math.abs(h)),n.set(o,o,n.get(o,o)+u),n.set(o-1,o-1,n.get(o-1,o-1)+u),O=n.get(o,o),h>=0){for(_=f>=0?f+_:f-_,t[o-1]=O+_,t[o]=t[o-1],_!==0&&(t[o]=O-L/_),e[o-1]=0,e[o]=0,O=n.get(o,o-1),g=Math.abs(O)+Math.abs(_),f=O/g,h=_/g,y=Math.sqrt(f*f+h*h),f=f/y,h=h/y,C=o-1;C<s;C++)_=n.get(o-1,C),n.set(o-1,C,h*_+f*n.get(o,C)),n.set(o,C,h*n.get(o,C)-f*_);for(d=0;d<=o;d++)_=n.get(d,o-1),n.set(d,o-1,h*_+f*n.get(d,o)),n.set(d,o,h*n.get(d,o)-f*_);for(d=i;d<=a;d++)_=r.get(d,o-1),r.set(d,o-1,h*_+f*r.get(d,o)),r.set(d,o,h*r.get(d,o)-f*_)}else t[o-1]=O+f,t[o]=O+f,e[o-1]=_,e[o]=-_;o=o-2,T=0}else{if(O=n.get(o,o),N=0,L=0,I<o&&(N=n.get(o-1,o-1),L=n.get(o,o-1)*n.get(o-1,o)),T===10){for(u+=O,d=i;d<=o;d++)n.set(d,d,n.get(d,d)-O);g=Math.abs(n.get(o,o-1))+Math.abs(n.get(o-1,o-2)),O=N=.75*g,L=-.4375*g*g}if(T===30&&(g=(N-O)/2,g=g*g+L,g>0)){for(g=Math.sqrt(g),N<O&&(g=-g),g=O-L/((N-O)/2+g),d=i;d<=o;d++)n.set(d,d,n.get(d,d)-g);u+=g,O=N=L=.964}for(T=T+1,G=o-2;G>=I&&(_=n.get(G,G),y=O-_,g=N-_,f=(y*g-L)/n.get(G+1,G)+n.get(G,G+1),h=n.get(G+1,G+1)-_-y-g,y=n.get(G+2,G+1),g=Math.abs(f)+Math.abs(h)+Math.abs(y),f=f/g,h=h/g,y=y/g,!(G===I||Math.abs(n.get(G,G-1))*(Math.abs(h)+Math.abs(y))<c*(Math.abs(f)*(Math.abs(n.get(G-1,G-1))+Math.abs(_)+Math.abs(n.get(G+1,G+1))))));)G--;for(d=G+2;d<=o;d++)n.set(d,d-2,0),d>G+2&&n.set(d,d-3,0);for(E=G;E<=o-1&&(J=E!==o-1,E!==G&&(f=n.get(E,E-1),h=n.get(E+1,E-1),y=J?n.get(E+2,E-1):0,O=Math.abs(f)+Math.abs(h)+Math.abs(y),O!==0&&(f=f/O,h=h/O,y=y/O)),O!==0);E++)if(g=Math.sqrt(f*f+h*h+y*y),f<0&&(g=-g),g!==0){for(E!==G?n.set(E,E-1,-g*O):I!==G&&n.set(E,E-1,-n.get(E,E-1)),f=f+g,O=f/g,N=h/g,_=y/g,h=h/f,y=y/f,C=E;C<s;C++)f=n.get(E,C)+h*n.get(E+1,C),J&&(f=f+y*n.get(E+2,C),n.set(E+2,C,n.get(E+2,C)-f*_)),n.set(E,C,n.get(E,C)-f*O),n.set(E+1,C,n.get(E+1,C)-f*N);for(d=0;d<=Math.min(o,E+3);d++)f=O*n.get(d,E)+N*n.get(d,E+1),J&&(f=f+_*n.get(d,E+2),n.set(d,E+2,n.get(d,E+2)-f*y)),n.set(d,E,n.get(d,E)-f),n.set(d,E+1,n.get(d,E+1)-f*h);for(d=i;d<=a;d++)f=O*r.get(d,E)+N*r.get(d,E+1),J&&(f=f+_*r.get(d,E+2),r.set(d,E+2,r.get(d,E+2)-f*y)),r.set(d,E,r.get(d,E)-f),r.set(d,E+1,r.get(d,E+1)-f*h)}}}if(l!==0){for(o=s-1;o>=0;o--)if(f=t[o],h=e[o],h===0)for(I=o,n.set(o,o,1),d=o-1;d>=0;d--){for(L=n.get(d,d)-f,y=0,C=I;C<=o;C++)y=y+n.get(d,C)*n.get(C,o);if(e[d]<0)_=L,g=y;else if(I=d,e[d]===0?n.set(d,o,L!==0?-y/L:-y/(c*l)):(O=n.get(d,d+1),N=n.get(d+1,d),h=(t[d]-f)*(t[d]-f)+e[d]*e[d],U=(O*g-_*y)/h,n.set(d,o,U),n.set(d+1,o,Math.abs(O)>Math.abs(_)?(-y-L*U)/O:(-g-N*U)/_)),U=Math.abs(n.get(d,o)),c*U*U>1)for(C=d;C<=o;C++)n.set(C,o,n.get(C,o)/U)}else if(h<0)for(I=o-1,Math.abs(n.get(o,o-1))>Math.abs(n.get(o-1,o))?(n.set(o-1,o-1,h/n.get(o,o-1)),n.set(o-1,o,-(n.get(o,o)-f)/n.get(o,o-1))):($=Cn(0,-n.get(o-1,o),n.get(o-1,o-1)-f,h),n.set(o-1,o-1,$[0]),n.set(o-1,o,$[1])),n.set(o,o-1,0),n.set(o,o,1),d=o-2;d>=0;d--){for(x=0,S=0,C=I;C<=o;C++)x=x+n.get(d,C)*n.get(C,o-1),S=S+n.get(d,C)*n.get(C,o);if(L=n.get(d,d)-f,e[d]<0)_=L,y=x,g=S;else if(I=d,e[d]===0?($=Cn(-x,-S,L,h),n.set(d,o-1,$[0]),n.set(d,o,$[1])):(O=n.get(d,d+1),N=n.get(d+1,d),R=(t[d]-f)*(t[d]-f)+e[d]*e[d]-h*h,M=(t[d]-f)*2*h,R===0&&M===0&&(R=c*l*(Math.abs(L)+Math.abs(h)+Math.abs(O)+Math.abs(N)+Math.abs(_))),$=Cn(O*y-_*x+h*S,O*g-_*S-h*x,R,M),n.set(d,o-1,$[0]),n.set(d,o,$[1]),Math.abs(O)>Math.abs(_)+Math.abs(h)?(n.set(d+1,o-1,(-x-L*n.get(d,o-1)+h*n.get(d,o))/O),n.set(d+1,o,(-S-L*n.get(d,o)-h*n.get(d,o-1))/O)):($=Cn(-y-N*n.get(d,o-1),-g-N*n.get(d,o),_,h),n.set(d+1,o-1,$[0]),n.set(d+1,o,$[1]))),U=Math.max(Math.abs(n.get(d,o-1)),Math.abs(n.get(d,o))),c*U*U>1)for(C=d;C<=o;C++)n.set(C,o-1,n.get(C,o-1)/U),n.set(C,o,n.get(C,o)/U)}for(d=0;d<s;d++)if(d<i||d>a)for(C=d;C<s;C++)r.set(d,C,n.get(d,C));for(C=s-1;C>=i;C--)for(d=i;d<=a;d++){for(_=0,E=i;E<=Math.min(C,a);E++)_=_+r.get(d,E)*n.get(E,C);r.set(d,C,_)}}}function Cn(s,e,t,r){let n,o;return Math.abs(t)>Math.abs(r)?(n=r/t,o=t+n*r,[(s+n*e)/o,(e-n*s)/o]):(n=t/r,o=r+n*t,[(n*s+e)/o,(n*e-s)/o])}var Dn=class{constructor(e){if(e=ge.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let t=e,r=t.rows,n=new F(r,r),o=!0,i,a,c;for(a=0;a<r;a++){let u=0;for(c=0;c<a;c++){let l=0;for(i=0;i<c;i++)l+=n.get(c,i)*n.get(a,i);l=(t.get(a,c)-l)/n.get(c,c),n.set(a,c,l),u=u+l*l}for(u=t.get(a,a)-u,o&&=u>0,n.set(a,a,Math.sqrt(Math.max(u,0))),c=a+1;c<r;c++)n.set(a,c,0)}this.L=n,this.positiveDefinite=o}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=ge.checkMatrix(e);let t=this.L,r=t.rows;if(e.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let n=e.columns,o=e.clone(),i,a,c;for(c=0;c<r;c++)for(a=0;a<n;a++){for(i=0;i<c;i++)o.set(c,a,o.get(c,a)-o.get(i,a)*t.get(c,i));o.set(c,a,o.get(c,a)/t.get(c,c))}for(c=r-1;c>=0;c--)for(a=0;a<n;a++){for(i=c+1;i<r;i++)o.set(c,a,o.get(c,a)-o.get(i,a)*t.get(i,c));o.set(c,a,o.get(c,a)/t.get(c,c))}return o}get lowerTriangularMatrix(){return this.L}},Rn=class{constructor(e,t={}){e=ge.checkMatrix(e);let{Y:r}=t,{scaleScores:n=!1,maxIterations:o=1e3,terminationCriteria:i=1e-10}=t,a;if(r){if(Ae.isAnyArray(r)&&typeof r[0]=="number"?r=F.columnVector(r):r=ge.checkMatrix(r),r.rows!==e.rows)throw new Error("Y should have the same number of rows as X");a=r.getColumnVector(0)}else a=e.getColumnVector(0);let c=1,u,l,f,h;for(let y=0;y<o&&c>i;y++)f=e.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),f=f.div(f.norm()),u=e.mmul(f).div(f.transpose().mmul(f).get(0,0)),y>0&&(c=u.clone().sub(h).pow(2).sum()),h=u.clone(),r?(l=r.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),l=l.div(l.norm()),a=r.mmul(l).div(l.transpose().mmul(l).get(0,0))):a=u;if(r){let y=e.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));y=y.div(y.norm());let g=e.clone().sub(u.clone().mmul(y.transpose())),_=a.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),T=r.clone().sub(u.clone().mulS(_.get(0,0)).mmul(l.transpose()));this.t=u,this.p=y.transpose(),this.w=f.transpose(),this.q=l,this.u=a,this.s=u.transpose().mmul(u),this.xResidual=g,this.yResidual=T,this.betas=_}else this.w=f.transpose(),this.s=u.transpose().mmul(u).sqrt(),n?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=e.sub(u.mmul(f.transpose()))}};H.AbstractMatrix=Z;H.CHO=Dn;H.CholeskyDecomposition=Dn;H.DistanceMatrix=Sn;H.EVD=Fn;H.EigenvalueDecomposition=Fn;H.LU=rr;H.LuDecomposition=rr;H.Matrix=F;H.MatrixColumnSelectionView=Ho;H.MatrixColumnView=Jo;H.MatrixFlipColumnView=jo;H.MatrixFlipRowView=$o;H.MatrixRowSelectionView=Ko;H.MatrixRowView=Wo;H.MatrixSelectionView=tr;H.MatrixSubView=Xo;H.MatrixTransposeView=Qo;H.NIPALS=Rn;H.Nipals=Rn;H.QR=Dr;H.QrDecomposition=Dr;H.SVD=ut;H.SingularValueDecomposition=ut;H.SymmetricMatrix=Et;H.WrapperMatrix1D=Mn;H.WrapperMatrix2D=ge;H.correlation=Ed;H.covariance=vd;H.default=F;H.determinant=kn;H.inverse=bd;H.linearDependencies=_d;H.pseudoInverse=Bd;H.solve=hu;H.wrap=xd});var Jr={create(){},onDestroy(){},async init(){let s=document.createElement("canvas");return s.style=`
top: 0;
left: 0;
position: absolute;
width: 100vw;
height: 100vh;    
`,s.width=1024,s.height=1024,document.body.appendChild(s),{canvas:s}},brand:"mainCanvas",dependencies:[],globalDependencies:[]},Rt=Symbol("GBuffer Pass"),hs=Symbol("GBuffer Submit"),Hr=Symbol("Lighting Pass");function Wu(s,e,t,r){let n=1/Math.tan(s/2),o=1/(t-r);return[n/e,0,0,0,0,n,0,0,0,0,r*o,-1,0,0,t*r*o,0]}function Ku(s,e){let t=s.createTexture({dimension:"2d",format:"rgba8unorm",label:"albedo",size:e,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),r=s.createTexture({dimension:"2d",format:"rgba16float",label:"normal",size:e,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),n=s.createTexture({dimension:"2d",format:"rgba32float",label:"position",size:e,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING}),o=s.createTexture({size:e,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});return{albedo:t,normal:r,position:n,depth:o}}function Xu(s,e){let t=(o,i,a)=>s.createTexture({size:e.map(c=>Math.ceil(c*o)),format:i,mipLevelCount:a,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING}),r=t(1,"rgba8unorm",2),n=t(1,"rgba8unorm",1);return{color:r,color2:n,depth:t(1,"rg8unorm",1),depth2:t(1,"rg8unorm",1),nearField:t(1,"rgba8unorm",1),nearField2:t(1,"rgba8unorm",1),farField:t(1,"rgba8unorm",1),farField2:t(1,"rgba8unorm",1)}}function ze(s,e,t,r){let n=s.createBuffer({label:r,usage:t,size:e.byteLength});return s.queue.writeBuffer(n,0,e),n}function Mi(s,e,t){let r=t&&e[0]===t.dimensions[0]&&e[1]===t.dimensions[1]?t:void 0;return r||{gbuffer:Ku(s,e),dimensions:e,lighting:Xu(s,e)}}function Qu(s){return ze(s,new Float32Array([1,-1,-1,1,-1,-1,1,-1,1,1,-1,1]),GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,"fullscreen quad for blit")}var q={create(){},onDestroy(){},async init(s){let e=(await s(Jr)).canvas,t=e.getContext("webgpu"),n=await(await navigator.gpu.requestAdapter()).requestDevice({requiredFeatures:["float32-filterable"],requiredLimits:{}}),o=navigator.gpu.getPreferredCanvasFormat();t.configure({device:n,format:o});let i=new Set;function a(){e.width=window.innerWidth*window.devicePixelRatio,e.height=window.innerHeight*window.devicePixelRatio;for(let u of i)u();c.textures=Mi(n,[e.width,e.height])}window.addEventListener("resize",a);let c={fullscreenQuad:Qu(n),textures:Mi(n,[e.width,e.height]),canvas:e,ctx:t,device:n,projectionMatrix:he([0,0,0]),fov:1,aspect:1,near:.1,far:100,viewMatrix:he([0,0,0]),canvasFormat:o,onResize(u){let l=u();return i.add(u),[l,()=>{i.delete(u)}]},gBufferRenderPass:void 0,time:0};return a(),c},renderUpdate({state:s,scheduleTask:e}){let{device:t,textures:r,fullscreenQuad:n}=s;s.projectionMatrix=Wu(1,window.innerWidth/window.innerHeight,.1,200);let o=t.createCommandEncoder(),i=o.beginRenderPass({colorAttachments:[{view:r.gbuffer.position.createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"},{view:r.gbuffer.normal.createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"},{view:r.gbuffer.albedo.createView(),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:r.gbuffer.depth,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});s.gBufferRenderPass=i,e(()=>(i.end(),t.queue.submit([o.finish()]),Promise.resolve()),[hs],[Rt])},brand:"deferredWebgpuRenderer",dependencies:[],globalDependencies:[Jr]};async function pr(s,e,t,r){return r._parse(s,e,t,r)}function de(s,e){if(!s)throw new Error(e||"loader assertion failed.")}var Ve={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},qu=Ve.self||Ve.window||Ve.global||{},zu=Ve.window||Ve.self||Ve.global||{},Yu=Ve.global||Ve.self||Ve.window||{},Zu=Ve.document||{};var Ye=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var Fi=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),el=Fi&&parseFloat(Fi[1])||0;var jr=globalThis,tl=globalThis.document||{},$r=globalThis.process||{},rl=globalThis.console,fg=globalThis.navigator||{};function Di(s){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let e=typeof navigator<"u"&&navigator.userAgent,t=s||e;return!!(t&&t.indexOf("Electron")>=0)}function dt(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Di()}var ms="4.1.0";function sl(s){try{let e=window[s],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}var Wr=class{constructor(e,t,r="sessionStorage"){this.storage=sl(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){let t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function Ri(s){let e;return s<10?e=`${s.toFixed(2)}ms`:s<100?e=`${s.toFixed(1)}ms`:s<1e3?e=`${s.toFixed(0)}ms`:e=`${(s/1e3).toFixed(2)}s`,e}function Gi(s,e=8){let t=Math.max(e-s.length,0);return`${" ".repeat(t)}${s}`}var Kr;(function(s){s[s.BLACK=30]="BLACK",s[s.RED=31]="RED",s[s.GREEN=32]="GREEN",s[s.YELLOW=33]="YELLOW",s[s.BLUE=34]="BLUE",s[s.MAGENTA=35]="MAGENTA",s[s.CYAN=36]="CYAN",s[s.WHITE=37]="WHITE",s[s.BRIGHT_BLACK=90]="BRIGHT_BLACK",s[s.BRIGHT_RED=91]="BRIGHT_RED",s[s.BRIGHT_GREEN=92]="BRIGHT_GREEN",s[s.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",s[s.BRIGHT_BLUE=94]="BRIGHT_BLUE",s[s.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",s[s.BRIGHT_CYAN=96]="BRIGHT_CYAN",s[s.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Kr||(Kr={}));var ol=10;function Li(s){return typeof s!="string"?s:(s=s.toUpperCase(),Kr[s]||Kr.WHITE)}function Oi(s,e,t){return!dt&&typeof s=="string"&&(e&&(s=`\x1B[${Li(e)}m${s}\x1B[39m`),t&&(s=`\x1B[${Li(t)+ol}m${s}\x1B[49m`)),s}function Pi(s,e=["constructor"]){let t=Object.getPrototypeOf(s),r=Object.getOwnPropertyNames(t),n=s;for(let o of r){let i=n[o];typeof i=="function"&&(e.find(a=>o===a)||(n[o]=i.bind(s)))}}function dr(s,e){if(!s)throw new Error(e||"Assertion failed")}function gt(){let s;if(dt()&&jr.performance)s=jr?.performance?.now?.();else if("hrtime"in $r){let e=$r?.hrtime?.();s=e[0]*1e3+e[1]/1e6}else s=Date.now();return s}var Gt={debug:dt()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},il={enabled:!0,level:0};function Lt(){}var Ui={},Ni={once:!0},Je=class{constructor({id:e}={id:""}){this.VERSION=ms,this._startTs=gt(),this._deltaTs=gt(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Wr(`__probe-${this.id}__`,il),this.timeStamp(`${this.id} started`),Pi(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((gt()-this._startTs).toPrecision(10))}getDelta(){return Number((gt()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Gt.warn,arguments,Ni)}error(e){return this._getLogFunction(0,e,Gt.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Gt.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Gt.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Gt.debug||Gt.info,arguments,Ni)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Lt,r&&[r],{tag:cl(t)}):Lt}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Lt)}group(e,t,r={collapsed:!1}){let n=Vi({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Lt)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Ji(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=Vi({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,dr(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=gt();let i=o.tag||o.message;if(o.once&&i)if(!Ui[i])Ui[i]=gt();else return Lt;return t=al(this.id,o.message,o),r.bind(console,t,...o.args)}return Lt}};Je.VERSION=ms;function Ji(s){if(!s)return 0;let e;switch(typeof s){case"number":e=s;break;case"object":e=s.logLevel||s.priority||0;break;default:return 0}return dr(Number.isFinite(e)&&e>=0),e}function Vi(s){let{logLevel:e,message:t}=s;s.logLevel=Ji(e);let r=s.args?Array.from(s.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),s.message=e;break;case"object":Object.assign(s,e);break;default:}typeof s.message=="function"&&(s.message=s.message());let n=typeof s.message;return dr(n==="string"||n==="object"),Object.assign(s,{args:r},s.opts)}function al(s,e,t){if(typeof e=="string"){let r=t.time?Gi(Ri(t.total)):"";e=t.time?`${s}: ${r}  ${e}`:`${s}: ${e}`,e=Oi(e,t.color,t.background)}return e}function cl(s){for(let e in s)for(let t in s[e])return t||"untitled";return"empty"}globalThis.probe={};var Lg=new Je({id:"@probe.gl/log"});var ps="4.3.3",ul=ps[0]>="0"&&ps[0]<="9"?`v${ps}`:"";function ll(){let s=new Je({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=s,globalThis.loaders.version=ul,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=s,s}var ds=ll();function gs(s,e){return Hi(s||{},e)}function Hi(s,e,t=0){if(t>3)return e;let r={...s};for(let[n,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?r[n]=Hi(r[n]||{},e[n],t+1):r[n]=e[n];return r}function ys(s){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,s)}function xs(s){return globalThis.loaders?.modules?.[s]||null}var ji="latest";function fl(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}var gr=fl();function ue(s,e){if(!s)throw new Error(e||"loaders.gl assertion failed.")}var He={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Wg=He.self||He.window||He.global||{},Kg=He.window||He.self||He.global||{},Xg=He.global||He.self||He.window||{},Qg=He.document||{};var ae=typeof process!="object"||String(process)!=="[object process]"||process.browser,yr=typeof importScripts=="function",Wi=typeof window<"u"&&typeof window.orientation<"u",$i=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),qg=$i&&parseFloat($i[1])||0;var xr=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ue(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ue(this.isRunning),this.isRunning=!1,this._reject(e)}};var Ot=class{terminate(){}};var bs=new Map;function Ki(s){ue(s.source&&!s.url||!s.source&&s.url);let e=bs.get(s.source||s.url);return e||(s.url&&(e=hl(s.url),bs.set(s.url,e)),s.source&&(e=Xi(s.source),bs.set(s.source,e))),ue(e),e}function hl(s){if(!s.startsWith("http"))return s;let e=ml(s);return Xi(e)}function Xi(s){let e=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(e)}function ml(s){return`try {
  importScripts('${s}');
} catch (error) {
  console.error(error);
  throw error;
}`}function As(s,e=!0,t){let r=t||new Set;if(s){if(Qi(s))r.add(s);else if(Qi(s.buffer))r.add(s.buffer);else if(!ArrayBuffer.isView(s)){if(e&&typeof s=="object")for(let n in s)As(s[n],e,r)}}return t===void 0?Array.from(r):[]}function Qi(s){return s?s instanceof ArrayBuffer||typeof MessagePort<"u"&&s instanceof MessagePort||typeof ImageBitmap<"u"&&s instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas:!1}var ws=()=>{},ot=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&ae||typeof Ot<"u"&&!ae}constructor(e){let{name:t,source:r,url:n}=e;ue(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=ws,this.onError=o=>console.log(o),this.worker=ae?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ws,this.onError=ws,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||As(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Ki({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){let r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ot(r,{eval:!1})}else if(this.source)e=new Ot(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}};var br=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return ot.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(n,o,i)=>n.done(i),r=(n,o)=>n.error(o)){let n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let r=new xr(t.name,e);e.onMessage=n=>t.onMessage(r,n.type,n.payload),e.onError=n=>t.onError(r,n),t.onStart(r);try{await r.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!ae||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ot({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Wi?this.maxMobileConcurrency:this.maxConcurrency}};var pl={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},yt=class s{props;workerPools=new Map;static _workerFarm;static isSupported(){return ot.isSupported()}static getWorkerFarm(e={}){return s._workerFarm=s._workerFarm||new s({}),s._workerFarm.setProps(e),s._workerFarm}constructor(e){this.props={...pl},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:r,url:n}=e,o=this.workerPools.get(t);return o||(o=new br({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function _s(s,e={}){let t=e[s.id]||{},r=ae?`${s.id}-worker.js`:`${s.id}-worker-node.js`,n=t.workerUrl;if(!n&&s.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(ae?n=`modules/${s.module}/dist/${r}`:n=`modules/${s.module}/src/workers/${s.id}-worker-node.ts`),!n){let o=s.version;o==="latest"&&(o=ji);let i=o?`@${o}`:"";n=`https://unpkg.com/@loaders.gl/${s.module}${i}/dist/${r}`}return ue(n),n}function Bs(s,e=gr){ue(s,"no worker provided");let t=s.version;return!(!e||!t)}var vs={};async function je(s,e=null,t={},r=null){return e&&(s=qi(s,e,t,r)),vs[s]=vs[s]||dl(s),await vs[s]}function qi(s,e,t={},r=null){if(!t.useLocalLibraries&&s.startsWith("http"))return s;r=r||s;let n=t.modules||{};return n[r]?n[r]:ae?t.CDN?(ue(t.CDN.startsWith("http")),`${t.CDN}/${e}@${gr}/dist/libs/${r}`):yr?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function dl(s){if(s.endsWith("wasm"))return await yl(s);if(!ae)try{let{requireFromFile:t}=globalThis.loaders||{};return await t?.(s)}catch(t){return console.error(t),null}if(yr)return importScripts(s);let e=await xl(s);return gl(e,s)}function gl(s,e){if(!ae){let{requireFromString:r}=globalThis.loaders||{};return r?.(s,e)}if(yr)return eval.call(globalThis,s),null;let t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(s))}catch{t.text=s}return document.body.appendChild(t),null}async function yl(s){let{readFileAsArrayBuffer:e}=globalThis.loaders||{};return ae||!e||s.startsWith("http")?await(await fetch(s)).arrayBuffer():await e(s)}async function xl(s){let{readFileAsText:e}=globalThis.loaders||{};return ae||!e||s.startsWith("http")?await(await fetch(s)).text():await e(s)}function Es(s,e){return!yt.isSupported()||!ae&&!e?._nodeWorkers?!1:s.worker&&e?.worker}async function Ts(s,e,t,r,n){let o=s.id,i=_s(s,t),c=yt.getWorkerFarm(t).getWorkerPool({name:o,url:i});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));let u=await c.startJob("process-on-worker",bl.bind(null,n));return u.postMessage("process",{input:e,options:t,context:r}),await(await u.result).result}async function bl(s,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":let{id:n,input:o,options:i}=r;try{let a=await s(o,i);e.postMessage("done",{id:n,result:a})}catch(a){let c=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:n,error:c})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Yi(s,e=5){return typeof s=="string"?s.slice(0,e):ArrayBuffer.isView(s)?zi(s.buffer,s.byteOffset,e):s instanceof ArrayBuffer?zi(s,0,e):""}function zi(s,e,t){if(s.byteLength<=e+t)return"";let r=new DataView(s),n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}function Is(s){try{return JSON.parse(s)}catch{throw new Error(`Failed to parse JSON from data starting with "${Yi(s)}"`)}}function Cs(s,e,t){if(t=t||s.byteLength,s.byteLength<t||e.byteLength<t)return!1;let r=new Uint8Array(s),n=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function ks(...s){return Zi(s)}function Zi(s){let e=s.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,i)=>o+i.byteLength,0),r=new Uint8Array(t),n=0;for(let o of e)r.set(o,n),n+=o.byteLength;return r.buffer}function Ar(s,e,t){let r=t!==void 0?new Uint8Array(s).subarray(e,e+t):new Uint8Array(s).subarray(e);return new Uint8Array(r).buffer}function it(s,e){return de(s>=0),de(e>0),s+(e-1)&~(e-1)}function Ss(s,e,t){let r;if(s instanceof ArrayBuffer)r=new Uint8Array(s);else{let n=s.byteOffset,o=s.byteLength;r=new Uint8Array(s.buffer||s.arrayBuffer,n,o)}return e.set(r,t),t+it(r.byteLength,4)}async function Ms(s){let e=[];for await(let t of s)e.push(t);return ks(...e)}var Al="",ea={};function Fs(s){for(let e in ea)if(s.startsWith(e)){let t=ea[e];s=s.replace(e,t)}return!s.startsWith("http://")&&!s.startsWith("https://")&&(s=`${Al}${s}`),s}function ta(s){return s&&typeof s=="object"&&s.isBuffer}function Xr(s){if(ta(s))return s;if(s instanceof ArrayBuffer)return s;if(ArrayBuffer.isView(s))return s.byteOffset===0&&s.byteLength===s.buffer.byteLength?s.buffer:s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);if(typeof s=="string"){let e=s;return new TextEncoder().encode(e).buffer}if(s&&typeof s=="object"&&s._toArrayBuffer)return s._toArrayBuffer();throw new Error("toArrayBuffer")}var xt={};ke(xt,{dirname:()=>_l,filename:()=>wl,join:()=>Bl,resolve:()=>vl});function ra(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let s=window.location?.pathname;return s?.slice(0,s.lastIndexOf("/")+1)||""}function wl(s){let e=s?s.lastIndexOf("/"):-1;return e>=0?s.substr(e+1):""}function _l(s){let e=s?s.lastIndexOf("/"):-1;return e>=0?s.substr(0,e):""}function Bl(...s){return s=s.map((t,r)=>(r&&(t=t.replace(new RegExp("^/"),"")),r!==s.length-1&&(t=t.replace(new RegExp("/$"),"")),t)),s.join("/")}function vl(...s){let e=[];for(let o=0;o<s.length;o++)e[o]=s[o];let t="",r=!1,n;for(let o=e.length-1;o>=-1&&!r;o--){let i;o>=0?i=e[o]:(n===void 0&&(n=ra()),i=n),i.length!==0&&(t=`${i}/${t}`,r=i.charCodeAt(0)===wr)}return t=El(t,!r),r?`/${t}`:t.length>0?t:"."}var wr=47,Ds=46;function El(s,e){let t="",r=-1,n=0,o,i=!1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===wr)break;o=wr}if(o===wr){if(!(r===a-1||n===1))if(r!==a-1&&n===2){if(t.length<2||!i||t.charCodeAt(t.length-1)!==Ds||t.charCodeAt(t.length-2)!==Ds){if(t.length>2){let c=t.length-1,u=c;for(;u>=0&&t.charCodeAt(u)!==wr;--u);if(u!==c){t=u===-1?"":t.slice(0,u),r=a,n=0,i=!1;continue}}else if(t.length===2||t.length===1){t="",r=a,n=0,i=!1;continue}}e&&(t.length>0?t+="/..":t="..",i=!0)}else{let c=s.slice(r+1,a);t.length>0?t+=`/${c}`:t=c,i=!1}r=a,n=0}else o===Ds&&n!==-1?++n:n=-1}return t}var Tl=s=>typeof s=="boolean",_r=s=>typeof s=="function",bt=s=>s!==null&&typeof s=="object",Rs=s=>bt(s)&&s.constructor==={}.constructor;var na=s=>!!s&&typeof s[Symbol.iterator]=="function",sa=s=>s&&typeof s[Symbol.asyncIterator]=="function";var Se=s=>typeof Response<"u"&&s instanceof Response||s&&s.arrayBuffer&&s.text&&s.json;var $e=s=>typeof Blob<"u"&&s instanceof Blob,oa=s=>s&&typeof s=="object"&&s.isBuffer;var Il=s=>typeof ReadableStream<"u"&&s instanceof ReadableStream||bt(s)&&_r(s.tee)&&_r(s.cancel)&&_r(s.getReader);var Cl=s=>bt(s)&&_r(s.read)&&_r(s.pipe)&&Tl(s.readable),Qr=s=>Il(s)||Cl(s);var qr=class extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response};var kl=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Sl=/^([-\w.]+\/[-\w.+]+)/;function Gs(s,e){return s.toLowerCase()===e.toLowerCase()}function ia(s){let e=Sl.exec(s);return e?e[1]:s}function Ls(s){let e=kl.exec(s);return e?e[1]:""}var aa=/\?.*/;function ca(s){let e=s.match(aa);return e&&e[0]}function Pt(s){return s.replace(aa,"")}function ua(s){if(s.length<50)return s;let e=s.slice(s.length-15);return`${s.substr(0,32)}...${e}`}function At(s){return Se(s)?s.url:$e(s)?s.name||"":typeof s=="string"?s:""}function Br(s){if(Se(s)){let e=s,t=e.headers.get("content-type")||"",r=Pt(e.url);return ia(t)||Ls(r)}return $e(s)?s.type||"":typeof s=="string"?Ls(s):""}function la(s){return Se(s)?s.headers["content-length"]||-1:$e(s)?s.size:typeof s=="string"?s.length:s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.byteLength:-1}async function zr(s){if(Se(s))return s;let e={},t=la(s);t>=0&&(e["content-length"]=String(t));let r=At(s),n=Br(s);n&&(e["content-type"]=n);let o=await Fl(s);o&&(e["x-first-bytes"]=o),typeof s=="string"&&(s=new TextEncoder().encode(s));let i=new Response(s,{headers:e});return Object.defineProperty(i,"url",{value:r}),i}async function fa(s){if(!s.ok)throw await Ml(s)}async function Ml(s){let e=ua(s.url),t=`Failed to fetch resource (${s.status}) ${s.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;let r={reason:s.statusText,url:s.url,response:s};try{let n=s.headers.get("Content-Type");r.reason=!s.bodyUsed&&n?.includes("application/json")?await s.json():await s.text()}catch{}return new qr(t,r)}async function Fl(s){if(typeof s=="string")return`data:,${s.slice(0,5)}`;if(s instanceof Blob){let t=s.slice(0,5);return await new Promise(r=>{let n=new FileReader;n.onload=o=>r(o?.target?.result),n.readAsDataURL(t)})}if(s instanceof ArrayBuffer){let t=s.slice(0,5);return`data:base64,${Dl(t)}`}return null}function Dl(s){let e="",t=new Uint8Array(s);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function Rl(s){return!Gl(s)&&!Ll(s)}function Gl(s){return s.startsWith("http:")||s.startsWith("https:")}function Ll(s){return s.startsWith("data:")}async function Os(s,e){if(typeof s=="string"){let t=Fs(s);return Rl(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await zr(s)}var Ps=new Je({id:"loaders.gl"}),Yr=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},Zr=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};var Us={fetch:null,mimeType:void 0,nothrow:!1,log:new Zr,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ye,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},ha={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ns(){globalThis.loaders=globalThis.loaders||{};let{loaders:s}=globalThis;return s._state||(s._state={}),s._state}function Vs(){let s=Ns();return s.globalOptions=s.globalOptions||{...Us},s.globalOptions}function da(s,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],Ol(s,t),Ul(e,s,r)}function Ol(s,e){ma(s,null,Us,ha,e);for(let t of e){let r=s&&s[t.id]||{},n=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};ma(r,t.id,n,o,e)}}function ma(s,e,t,r,n){let o=e||"Top level",i=e?`${e}.`:"";for(let a in s){let c=!e&&bt(s[a]),u=a==="baseUri"&&!e,l=a==="workerUrl"&&e;if(!(a in t)&&!u&&!l){if(a in r)Ps.warn(`${o} loader option '${i}${a}' no longer supported, use '${r[a]}'`)();else if(!c){let f=Pl(a,n);Ps.warn(`${o} loader option '${i}${a}' not recognized. ${f}`)()}}}}function Pl(s,e){let t=s.toLowerCase(),r="";for(let n of e)for(let o in n.options){if(s===o)return`Did you mean '${n.id}.${o}'?`;let i=o.toLowerCase();(t.startsWith(i)||i.startsWith(t))&&(r=r||`Did you mean '${n.id}.${o}'?`)}return r}function Ul(s,e,t){let n={...s.options||{}};return Nl(n,t),n.log===null&&(n.log=new Yr),pa(n,Vs()),pa(n,e),n}function pa(s,e){for(let t in e)if(t in e){let r=e[t];Rs(r)&&Rs(s[t])?s[t]={...s[t],...e[t]}:s[t]=e[t]}}function Nl(s,e){e&&!("baseUri"in s)&&(s.baseUri=e)}function Js(s){return s?(Array.isArray(s)&&(s=s[0]),Array.isArray(s?.extensions)):!1}function Hs(s){de(s,"null loader"),de(Js(s),"invalid loader");let e;return Array.isArray(s)&&(e=s[1],s=s[0],s={...s,options:{...s.options,...e}}),(s?.parseTextSync||s?.parseText)&&(s.text=!0),s.text||(s.binary=!0),s}var Vl=()=>{let s=Ns();return s.loaderRegistry=s.loaderRegistry||[],s.loaderRegistry};function ga(){return Vl()}var Jl=/\.([^.]+)$/;async function ba(s,e=[],t,r){if(!Aa(s))return null;let n=ya(s,e,{...t,nothrow:!0},r);if(n)return n;if($e(s)&&(s=await s.slice(0,10).arrayBuffer(),n=ya(s,e,t,r)),!n&&!t?.nothrow)throw new Error(wa(s));return n}function ya(s,e=[],t,r){if(!Aa(s))return null;if(e&&!Array.isArray(e))return Hs(e);let n=[];e&&(n=n.concat(e)),t?.ignoreRegisteredLoaders||n.push(...ga()),jl(n);let o=Hl(s,n,t,r);if(!o&&!t?.nothrow)throw new Error(wa(s));return o}function Hl(s,e,t,r){let n=At(s),o=Br(s),i=Pt(n)||r?.url,a=null,c="";return t?.mimeType&&(a=js(e,t?.mimeType),c=`match forced by supplied MIME type ${t?.mimeType}`),a=a||$l(e,i),c=c||(a?`matched url ${i}`:""),a=a||js(e,o),c=c||(a?`matched MIME type ${o}`:""),a=a||Kl(e,s),c=c||(a?`matched initial data ${_a(s)}`:""),t?.fallbackMimeType&&(a=a||js(e,t?.fallbackMimeType),c=c||(a?`matched fallback MIME type ${o}`:"")),c&&ds.log(1,`selectLoader selected ${a?.name}: ${c}.`),a}function Aa(s){return!(s instanceof Response&&s.status===204)}function wa(s){let e=At(s),t=Br(s),r="No valid loader found (";r+=e?`${xt.filename(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;let n=s?_a(s):"";return r+=n?` first bytes: "${n}"`:"first bytes: not available",r+=")",r}function jl(s){for(let e of s)Hs(e)}function $l(s,e){let t=e&&Jl.exec(e),r=t&&t[1];return r?Wl(s,r):null}function Wl(s,e){e=e.toLowerCase();for(let t of s)for(let r of t.extensions)if(r.toLowerCase()===e)return t;return null}function js(s,e){for(let t of s)if(t.mimeTypes?.some(r=>Gs(e,r))||Gs(e,`application/x.${t.id}`))return t;return null}function Kl(s,e){if(!e)return null;for(let t of s)if(typeof e=="string"){if(Xl(e,t))return t}else if(ArrayBuffer.isView(e)){if(xa(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&xa(e,0,t))return t;return null}function Xl(s,e){return e.testText?e.testText(s):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>s.startsWith(r))}function xa(s,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>Ql(s,e,t,n))}function Ql(s,e,t,r){if(r instanceof ArrayBuffer)return Cs(r,s,r.byteLength);switch(typeof r){case"function":return r(s);case"string":let n=$s(s,e,r.length);return r===n;default:return!1}}function _a(s,e=5){return typeof s=="string"?s.slice(0,e):ArrayBuffer.isView(s)?$s(s.buffer,s.byteOffset,e):s instanceof ArrayBuffer?$s(s,0,e):""}function $s(s,e,t){if(s.byteLength<e+t)return"";let r=new DataView(s),n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}function*Ba(s,e){let t=e?.chunkSize||262144,r=0,n=new TextEncoder;for(;r<s.length;){let o=Math.min(s.length-r,t),i=s.slice(r,r+o);r+=o,yield n.encode(i)}}function*va(s,e={}){let{chunkSize:t=262144}=e,r=0;for(;r<s.byteLength;){let n=Math.min(s.byteLength-r,t),o=new ArrayBuffer(n),i=new Uint8Array(s,r,n);new Uint8Array(o).set(i),r+=n,yield o}}async function*Ea(s,e){let t=e?.chunkSize||1048576,r=0;for(;r<s.size;){let n=r+t,o=await s.slice(r,n).arrayBuffer();r=n,yield o}}function Ws(s,e){return Ye?ql(s,e):zl(s,e)}async function*ql(s,e){let t=s.getReader(),r;try{for(;;){let n=r||t.read();e?._streamReadAhead&&(r=t.read());let{done:o,value:i}=await n;if(o)return;yield Xr(i)}}catch{t.releaseLock()}}async function*zl(s,e){for await(let t of s)yield Xr(t)}function Ta(s,e){if(typeof s=="string")return Ba(s,e);if(s instanceof ArrayBuffer)return va(s,e);if($e(s))return Ea(s,e);if(Qr(s))return Ws(s,e);if(Se(s))return Ws(s.body,e);throw new Error("makeIterator")}var Ia="Cannot convert supplied data type";function Yl(s,e,t){if(e.text&&typeof s=="string")return s;if(oa(s)&&(s=s.buffer),s instanceof ArrayBuffer){let r=s;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(s)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(s);let r=s.buffer,n=s.byteLength||s.length;return(s.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(s.byteOffset,s.byteOffset+n)),r}throw new Error(Ia)}async function Ca(s,e,t){let r=s instanceof ArrayBuffer||ArrayBuffer.isView(s);if(typeof s=="string"||r)return Yl(s,e,t);if($e(s)&&(s=await zr(s)),Se(s)){let n=s;return await fa(n),e.binary?await n.arrayBuffer():await n.text()}if(Qr(s)&&(s=Ta(s,t)),na(s)||sa(s))return Ms(s);throw new Error(Ia)}function ka(s,e){let t=Vs(),r=s||t;return typeof r.fetch=="function"?r.fetch:bt(r.fetch)?n=>Os(n,r.fetch):e?.fetch?e?.fetch:Os}function Sa(s,e,t){if(t)return t;let r={fetch:ka(e,s),...s};if(r.url){let n=Pt(r.url);r.baseUrl=n,r.queryString=ca(r.url),r.filename=xt.filename(n),r.baseUrl=xt.dirname(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function Ma(s,e){if(s&&!Array.isArray(s))return s;let t;if(s&&(t=Array.isArray(s)?s:[s]),e&&e.loaders){let r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function Ut(s,e,t,r){e&&!Array.isArray(e)&&!Js(e)&&(r=void 0,t=e,e=void 0),s=await s,t=t||{};let n=At(s),i=Ma(e,r),a=await ba(s,i,t);return a?(t=da(t,a,i,n),r=Sa({url:n,_parse:Ut,loaders:i},t,r||null),await Zl(a,s,t,r)):null}async function Zl(s,e,t,r){if(Bs(s),t=gs(s.options,t),Se(e)){let o=e,{ok:i,redirected:a,status:c,statusText:u,type:l,url:f}=o,h=Object.fromEntries(o.headers.entries());r.response={headers:h,ok:i,redirected:a,status:c,statusText:u,type:l,url:f}}e=await Ca(e,s,t);let n=s;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,t,r);if(Es(s,t))return await Ts(s,e,t,r,Ut);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,r);if(n.parse)return await n.parse(e,t,r);throw ue(!n.parseSync),new Error(`${s.id} loader - no parser found and worker is disabled`)}function Fa(s){switch(s.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Ks(s){let e=1/0,t=1/0,r=1/0,n=-1/0,o=-1/0,i=-1/0,a=s.POSITION?s.POSITION.value:[],c=a&&a.length;for(let u=0;u<c;u+=3){let l=a[u],f=a[u+1],h=a[u+2];e=l<e?l:e,t=f<t?f:t,r=h<r?h:r,n=l>n?l:n,o=f>o?f:o,i=h>i?h:i}return[[e,t,r],[n,o,i]]}function Xs(s,e,t){let r=Fa(e.value),n=t||Da(e);return{name:s,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:n}}function Da(s){let e={};return"byteOffset"in s&&(e.byteOffset=s.byteOffset.toString(10)),"byteStride"in s&&(e.byteStride=s.byteStride.toString(10)),"normalized"in s&&(e.normalized=s.normalized.toString()),e}var ro={};ke(ro,{createExtMeshFeatures:()=>Jf,decode:()=>Of,encode:()=>Pf,name:()=>Lf});var Ra="4.3.3";var ef=globalThis.loaders?.parseImageNode,Qs=typeof Image<"u",qs=typeof ImageBitmap<"u",tf=!!ef,zs=Ye?!0:tf;function Ga(s){switch(s){case"auto":return qs||Qs||zs;case"imagebitmap":return qs;case"image":return Qs;case"data":return zs;default:throw new Error(`@loaders.gl/images: image ${s} not supported in this environment`)}}function La(){if(qs)return"imagebitmap";if(Qs)return"image";if(zs)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Oa(s){let e=rf(s);if(!e)throw new Error("Not an image");return e}function vr(s){switch(Oa(s)){case"data":return s;case"image":case"imagebitmap":let e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=s.width,e.height=s.height,t.drawImage(s,0,0),t.getImageData(0,0,s.width,s.height);default:throw new Error("getImageData")}}function rf(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&s instanceof Image?"image":s&&typeof s=="object"&&s.data&&s.width&&s.height?"data":null}var nf=/^data:image\/svg\+xml/,sf=/\.svg((\?|#).*)?$/;function en(s){return s&&(nf.test(s)||sf.test(s))}function Pa(s,e){if(en(e)){let r=new TextDecoder().decode(s);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return Ys(s,e)}function Ys(s,e){if(en(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(s)])}async function tn(s,e,t){let r=Pa(s,t),n=self.URL||self.webkitURL,o=typeof r!="string"&&n.createObjectURL(r);try{return await of(o||r,e)}finally{o&&n.revokeObjectURL(o)}}async function of(s,e){let t=new Image;return t.src=s,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,n)=>{try{t.onload=()=>r(t),t.onerror=o=>{let i=o instanceof Error?o.message:"error";n(new Error(i))}}catch(o){n(o)}})}var af={},Ua=!0;async function Na(s,e,t){let r;en(t)?r=await tn(s,e,t):r=Ys(s,t);let n=e&&e.imagebitmap;return await cf(r,n)}async function cf(s,e=null){if((uf(e)||!Ua)&&(e=null),e)try{return await createImageBitmap(s,e)}catch(t){console.warn(t),Ua=!1}return await createImageBitmap(s)}function uf(s){for(let e in s||af)return!1;return!0}function Va(s){return!mf(s,"ftyp",4)||(s[8]&96)===0?null:lf(s)}function lf(s){switch(ff(s,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function ff(s,e,t){return String.fromCharCode(...s.slice(e,t))}function hf(s){return[...s].map(e=>e.charCodeAt(0))}function mf(s,e,t=0){let r=hf(e);for(let n=0;n<r.length;++n)if(r[n]!==s[n+t])return!1;return!0}var We=!1,Er=!0;function wt(s){let e=Tr(s);return df(e)||xf(e)||gf(e)||yf(e)||pf(e)}function pf(s){let e=new Uint8Array(s instanceof DataView?s.buffer:s),t=Va(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function df(s){let e=Tr(s);return e.byteLength>=24&&e.getUint32(0,We)===2303741511?{mimeType:"image/png",width:e.getUint32(16,We),height:e.getUint32(20,We)}:null}function gf(s){let e=Tr(s);return e.byteLength>=10&&e.getUint32(0,We)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Er),height:e.getUint16(8,Er)}:null}function yf(s){let e=Tr(s);return e.byteLength>=14&&e.getUint16(0,We)===16973&&e.getUint32(2,Er)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Er),height:e.getUint32(22,Er)}:null}function xf(s){let e=Tr(s);if(!(e.byteLength>=3&&e.getUint16(0,We)===65496&&e.getUint8(2)===255))return null;let{tableMarkers:r,sofMarkers:n}=bf(),o=2;for(;o+9<e.byteLength;){let i=e.getUint16(o,We);if(n.has(i))return{mimeType:"image/jpeg",height:e.getUint16(o+5,We),width:e.getUint16(o+7,We)};if(!r.has(i))return null;o+=2,o+=e.getUint16(o,We)}return null}function bf(){let s=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)s.add(t);return{tableMarkers:s,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Tr(s){if(s instanceof DataView)return s;if(ArrayBuffer.isView(s))return new DataView(s.buffer);if(s instanceof ArrayBuffer)return new DataView(s);throw new Error("toDataView")}async function Ja(s,e){let{mimeType:t}=wt(s)||{},r=globalThis.loaders?.parseImageNode;return de(r),await r(s,t)}async function Ha(s,e,t){e=e||{};let n=(e.image||{}).type||"auto",{url:o}=t||{},i=Af(n),a;switch(i){case"imagebitmap":a=await Na(s,e,o);break;case"image":a=await tn(s,e,o);break;case"data":a=await Ja(s,e);break;default:de(!1)}return n==="data"&&(a=vr(a)),a}function Af(s){switch(s){case"auto":case"data":return La();default:return Ga(s),s}}var wf=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],_f=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Bf={image:{type:"auto",decode:!0}},Zs={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Ra,mimeTypes:_f,extensions:wf,parse:Ha,tests:[s=>!!wt(new DataView(s))],options:Bf};var eo={};function to(s){if(eo[s]===void 0){let e=Ye?Ef(s):vf(s);eo[s]=e}return eo[s]}function vf(s){let e=["image/png","image/jpeg","image/gif"],t=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&t.includes(s)}function Ef(s){switch(s){case"image/avif":case"image/webp":return Tf(s);default:return!0}}function Tf(s){try{return document.createElement("canvas").toDataURL(s).indexOf(`data:${s}`)===0}catch{return!1}}function oe(s,e){if(!s)throw new Error(e||"assert failed: gltf")}var rn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},nn={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};var ja=["SCALAR","VEC2","VEC3","VEC4"],If=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Cf=new Map(If),kf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sf={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Mf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function sn(s){return ja[s-1]||ja[0]}function at(s){let e=Cf.get(s.constructor);if(!e)throw new Error("Illegal typed array");return e}function Nt(s,e){let t=Mf[s.componentType],r=kf[s.type],n=Sf[s.componentType],o=s.count*r,i=s.count*r*n;oe(i>=0&&i<=e.byteLength);let a=nn[s.componentType],c=rn[s.type];return{ArrayType:t,length:o,byteLength:i,componentByteSize:a,numberOfComponentsInElement:c}}function $a(s,e,t){let r=s.bufferViews[t];oe(r);let n=r.buffer,o=e[n];oe(o);let i=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,i,r.byteLength)}function Wa(s,e,t){let r=typeof t=="number"?s.accessors?.[t]:t;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);let n=s.bufferViews?.[r.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);let{arrayBuffer:o,byteOffset:i}=e[n.buffer],a=(i||0)+(r.byteOffset||0)+(n.byteOffset||0),{ArrayType:c,length:u,componentByteSize:l,numberOfComponentsInElement:f}=Nt(r,n),h=l*f,y=n.byteStride||h;if(typeof n.byteStride>"u"||n.byteStride===h)return new c(o,a,u);let g=new c(u);for(let _=0;_<r.count;_++){let T=new c(o,a+_*y,f);g.set(T,_*f)}return g}function Ff(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}var W=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Ff(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let t=this.getUsedExtensions().find(n=>n===e),r=this.getRequiredExtensions().find(n=>n===e);return typeof t=="string"||typeof r=="string"}getExtension(e){let t=this.getUsedExtensions().find(n=>n===e),r=this.json.extensions||{};return t?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;let r=this.json[e]&&this.json[e][t];if(!r)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);let t=e.buffer,r=this.gltf.buffers[t];oe(r);let n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){let t=this.getAccessor(e);return Wa(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);let t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(n,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){let n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){let r=e?.extensions||{};if(r[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}delete r[t]}addExtension(e,t={}){return oe(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return oe(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){let{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];let n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){let{attributes:t,indices:r,material:n,mode:o=4}=e,a={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(r){let c=this._addIndices(r);a.primitives[0].indices=c}return Number.isFinite(n)&&(a.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){let r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,t){let r=wt(e),n=t||r?.mimeType,i={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(e,t=0,r=this.byteLength){let n=e.byteLength;oe(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);let o={buffer:t,byteOffset:r,byteLength:n};return this.byteLength+=it(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,t){let r={bufferView:e,type:sn(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){let r=this.addBufferView(e),n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));let o={size:t.size,componentType:at(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(o,t))}addTexture(e){let{imageIndex:t}=e,r={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){let e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t),n=0;for(let o of this.sourceBuffers||[])n=Ss(o,r,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let r=!0;for(;r;){let n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}_addAttributes(e={}){let t={};for(let r in e){let n=e[r],o=this._getGltfAttributeName(r),i=this.addBinaryBuffer(n.value,n);t[o]=i}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){let r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];let n=e.subarray(0,t);for(let o of n)r.min.push(o),r.max.push(o);for(let o=t;o<e.length;o+=t)for(let i=0;i<t;i++)r.min[0+i]=Math.min(r.min[0+i],e[o+i]),r.max[0+i]=Math.max(r.max[0+i],e[o+i]);return r}};function Ka(s){return(s%1+1)%1}var Xa={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Df={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Qa={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Ir(s,e){return Qa[e]*Xa[s]}function Vt(s,e,t,r){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;let n=s.getTypedArrayForBufferView(e),o=Jt(n,"SCALAR",t,r+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function Jt(s,e,t,r=1){let n=Xa[e],o=Df[t],i=Qa[t],a=r*n,c=a*i,u=s.buffer,l=s.byteOffset;return l%i!==0&&(u=new Uint8Array(u).slice(l,l+c).buffer,l=0),new o(u,l,a)}function Ht(s,e,t){let r=`TEXCOORD_${e.texCoord||0}`,n=t.attributes[r],o=s.getTypedArrayForAccessor(n),i=s.gltf.json,a=e.index,c=i.textures?.[a]?.source;if(typeof c<"u"){let u=i.images?.[c]?.mimeType,l=s.gltf.images?.[c];if(l&&typeof l.width<"u"){let f=[];for(let h=0;h<o.length;h+=2){let y=Rf(l,u,o,h,e.channels);f.push(y)}return f}}return[]}function on(s,e,t,r,n){if(!t?.length)return;let o=[];for(let l of t){let f=r.findIndex(h=>h===l);f===-1&&(f=r.push(l)-1),o.push(f)}let i=new Uint32Array(o),a=s.gltf.buffers.push({arrayBuffer:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength})-1,c=s.addBufferView(i,a,0),u=s.addAccessor(c,{size:1,componentType:at(i),count:i.length});n.attributes[e]=u}function Rf(s,e,t,r,n=[0]){let o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},i=t[r],a=t[r+1],c=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(c=4);let u=Gf(i,a,s,c),l=0;for(let f of n){let h=typeof f=="number"?Object.values(o)[f]:o[f],y=u+h.offset,g=vr(s);if(g.data.length<=y)throw new Error(`${g.data.length} <= ${y}`);let _=g.data[y];l|=_<<h.shift}return l}function Gf(s,e,t,r=1){let n=t.width,o=Ka(s)*(n-1),i=Math.round(o),a=t.height,c=Ka(e)*(a-1),u=Math.round(c),l=t.components?t.components:r;return(u*n+i)*l}function an(s,e,t,r,n){let o=[];for(let i=0;i<e;i++){let a=t[i],c=t[i+1]-t[i];if(c+a>r)break;let u=a/n,l=c/n;o.push(s.slice(u,u+l))}return o}function cn(s,e,t){let r=[];for(let n=0;n<e;n++){let o=n*t;r.push(s.slice(o,o+t))}return r}function un(s,e,t,r){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){let n=[],o=new TextDecoder("utf8"),i=0;for(let a=0;a<s;a++){let c=r[a+1]-r[a];if(c+i<=e.length){let u=e.subarray(i,c+i),l=o.decode(u);n.push(l),i+=c}}return n}return[]}var jt="EXT_mesh_features",Lf=jt;async function Of(s,e){let t=new W(s);Uf(t,e)}function Pf(s,e){let t=new W(s);return Vf(t,e),t.createBinaryChunk(),t.gltf}function Uf(s,e){let t=s.gltf.json;if(t.meshes)for(let r of t.meshes)for(let n of r.primitives)Nf(s,n,e)}function Nf(s,e,t){if(!t?.gltf?.loadBuffers)return;let n=e.extensions?.[jt]?.featureIds;if(n)for(let o of n){let i;if(typeof o.attribute<"u"){let a=`_FEATURE_ID_${o.attribute}`,c=e.attributes[a];i=s.getTypedArrayForAccessor(c)}else typeof o.texture<"u"&&t?.gltf?.loadImages?i=Ht(s,o.texture,e):i=[];o.data=i}}function Vf(s,e){let t=s.gltf.json.meshes;if(t)for(let r of t)for(let n of r.primitives)Hf(s,n)}function Jf(s,e,t,r){e.extensions||(e.extensions={});let n=e.extensions[jt];n||(n={featureIds:[]},e.extensions[jt]=n);let{featureIds:o}=n,i={featureCount:t.length,propertyTable:r,data:t};o.push(i),s.addObjectExtension(e,jt,n)}function Hf(s,e){let t=e.extensions?.[jt];if(!t)return;let r=t.featureIds;r.forEach((n,o)=>{if(n.data){let{accessorKey:i,index:a}=jf(e.attributes),c=new Uint32Array(n.data);r[o]={featureCount:c.length,propertyTable:n.propertyTable,attribute:a},s.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength});let u=s.addBufferView(c),l=s.addAccessor(u,{size:1,componentType:at(c),count:c.length});e.attributes[i]=l}})}function jf(s){let e="_FEATURE_ID_",t=Object.keys(s).filter(o=>o.indexOf(e)===0),r=-1;for(let o of t){let i=Number(o.substring(e.length));i>r&&(r=i)}return r++,{accessorKey:`${e}${r}`,index:r}}var oo={};ke(oo,{createExtStructuralMetadata:()=>hh,decode:()=>Wf,encode:()=>Kf,name:()=>$f});var $t="EXT_structural_metadata",$f=$t;async function Wf(s,e){let t=new W(s);Xf(t,e)}function Kf(s,e){let t=new W(s);return lh(t,e),t.createBinaryChunk(),t.gltf}function Xf(s,e){if(!e.gltf?.loadBuffers)return;let t=s.getExtension($t);t&&(e.gltf?.loadImages&&Qf(s,t),qf(s,t))}function Qf(s,e){let t=e.propertyTextures,r=s.gltf.json;if(t&&r.meshes)for(let n of r.meshes)for(let o of n.primitives)Yf(s,t,o,e)}function qf(s,e){let t=e.schema;if(!t)return;let r=t.classes,n=e.propertyTables;if(r&&n)for(let o in r){let i=zf(n,o);i&&eh(s,t,i)}}function zf(s,e){for(let t of s)if(t.class===e)return t;return null}function Yf(s,e,t,r){if(!e)return;let o=t.extensions?.[$t]?.propertyTextures;if(o)for(let i of o){let a=e[i];Zf(s,a,t,r)}}function Zf(s,e,t,r){if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);let n=e.class;for(let o in e.properties){let i=`${n}_${o}`,a=e.properties?.[o];if(!a)continue;a.data||(a.data=[]);let c=a.data,u=Ht(s,a,t);u!==null&&(on(s,i,u,c,t),a.data=c,r.dataAttributeNames.push(i))}}function eh(s,e,t){let r=e.classes?.[t.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);let n=t.count;for(let o in r.properties){let i=r.properties[o],a=t.properties?.[o];if(a){let c=th(s,e,i,n,a);a.data=c}}}function th(s,e,t,r,n){let o=[],i=n.values,a=s.getTypedArrayForBufferView(i),c=rh(s,t,n,r),u=nh(s,n,r);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=sh(t,r,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{o=un(r,a,c,u);break}case"ENUM":{o=oh(e,t,r,a,c);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return o}function rh(s,e,t,r){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?Vt(s,t.arrayOffsets,t.arrayOffsetType||"UINT32",r):null}function nh(s,e,t){return typeof e.stringOffsets<"u"?Vt(s,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function sh(s,e,t,r){let n=s.array,o=s.count,i=Ir(s.type,s.componentType),a=t.byteLength/i,c;return s.componentType?c=Jt(t,s.type,s.componentType,a):c=t,n?r?an(c,e,r,t.length,i):o?cn(c,e,o):[]:c}function oh(s,e,t,r,n){let o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let i=s.enums?.[o];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);let a=i.valueType||"UINT16",c=Ir(e.type,a),u=r.byteLength/c,l=Jt(r,e.type,a,u);if(l||(l=r),e.array){if(n)return ih({valuesData:l,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:r.length,elementSize:c,enumEntry:i});let f=e.count;return f?ah(l,t,f,i):[]}return so(l,0,t,i)}function ih(s){let{valuesData:e,numberOfElements:t,arrayOffsets:r,valuesDataBytesLength:n,elementSize:o,enumEntry:i}=s,a=[];for(let c=0;c<t;c++){let u=r[c],l=r[c+1]-r[c];if(l+u>n)break;let f=u/o,h=l/o,y=so(e,f,h,i);a.push(y)}return a}function ah(s,e,t,r){let n=[];for(let o=0;o<e;o++){let i=t*o,a=so(s,i,t,r);n.push(a)}return n}function so(s,e,t,r){let n=[];for(let o=0;o<t;o++)if(s instanceof BigInt64Array||s instanceof BigUint64Array)n.push("");else{let i=s[e+o],a=ch(r,i);a?n.push(a.name):n.push("")}return n}function ch(s,e){for(let t of s.values)if(t.value===e)return t;return null}var uh="schemaClassId";function lh(s,e){let t=s.getExtension($t);if(t&&t.propertyTables)for(let r of t.propertyTables){let n=r.class,o=t.schema?.classes?.[n];r.properties&&o&&fh(r,o,s)}}function fh(s,e,t){for(let r in s.properties){let n=s.properties[r].data;if(n){let o=e.properties[r];if(o){let i=dh(n,o,t);s.properties[r]=i}}}}function hh(s,e,t=uh){let r=s.getExtension($t);r||(r=s.addExtension($t)),r.schema=mh(e,t,r.schema);let n=ph(e,t,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(n)-1}function mh(s,e,t){let r=t??{id:"schema_id"},n={properties:{}};for(let o of s){let i={type:o.elementType,componentType:o.componentType};n.properties[o.name]=i}return r.classes={},r.classes[e]=n,r}function ph(s,e,t){let r={class:e,count:0},n=0,o=t.classes?.[e];for(let i of s){if(n===0&&(n=i.values.length),n!==i.values.length&&i.values.length)throw new Error("Illegal values in attributes");o?.properties[i.name]&&(r.properties||(r.properties={}),r.properties[i.name]={values:0,data:i.values})}return r.count=n,r}function dh(s,e,t){let r={values:0};if(e.type==="STRING"){let{stringData:n,stringOffsets:o}=xh(s);r.stringOffsets=no(o,t),r.values=no(n,t)}else if(e.type==="SCALAR"&&e.componentType){let n=yh(s,e.componentType);r.values=no(n,t)}return r}var gh={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function yh(s,e){let t=[];for(let n of s)t.push(Number(n));let r=gh[e];if(!r)throw new Error("Illegal component type");return new r(t)}function xh(s){let e=new TextEncoder,t=[],r=0;for(let c of s){let u=e.encode(c);r+=u.length,t.push(u)}let n=new Uint8Array(r),o=[],i=0;for(let c of t)n.set(c,i),o.push(i),i+=c.length;o.push(i);let a=new Uint32Array(o);return{stringData:n,stringOffsets:a}}function no(s,e){return e.gltf.buffers.push({arrayBuffer:s.buffer,byteOffset:s.byteOffset,byteLength:s.byteLength}),e.addBufferView(s)}var io={};ke(io,{decode:()=>Ah,name:()=>bh});var qa="EXT_feature_metadata",bh=qa;async function Ah(s,e){let t=new W(s);wh(t,e)}function wh(s,e){if(!e.gltf?.loadBuffers)return;let t=s.getExtension(qa);t&&(e.gltf?.loadImages&&_h(s,t),Bh(s,t))}function _h(s,e){let t=e.schema;if(!t)return;let r=t.classes,{featureTextures:n}=e;if(r&&n)for(let o in r){let i=r[o],a=Eh(n,o);a&&Ih(s,a,i)}}function Bh(s,e){let t=e.schema;if(!t)return;let r=t.classes,n=e.featureTables;if(r&&n)for(let o in r){let i=vh(n,o);i&&Th(s,t,i)}}function vh(s,e){for(let t in s){let r=s[t];if(r.class===e)return r}return null}function Eh(s,e){for(let t in s){let r=s[t];if(r.class===e)return r}return null}function Th(s,e,t){if(!t.class)return;let r=e.classes?.[t.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);let n=t.count;for(let o in r.properties){let i=r.properties[o],a=t.properties?.[o];if(a){let c=Ch(s,e,i,n,a);a.data=c}}}function Ih(s,e,t){let r=e.class;for(let n in t.properties){let o=e?.properties?.[n];if(o){let i=Dh(s,o,r);o.data=i}}}function Ch(s,e,t,r,n){let o=[],i=n.bufferView,a=s.getTypedArrayForBufferView(i),c=kh(s,t,n,r),u=Sh(s,t,n,r);return t.type==="STRING"||t.componentType==="STRING"?o=un(r,a,c,u):Mh(t)&&(o=Fh(t,r,a,c)),o}function kh(s,e,t,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?Vt(s,t.arrayOffsetBufferView,t.offsetType||"UINT32",r):null}function Sh(s,e,t,r){return typeof t.stringOffsetBufferView<"u"?Vt(s,t.stringOffsetBufferView,t.offsetType||"UINT32",r):null}function Mh(s){let e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(s.type)||typeof s.componentType<"u"&&e.includes(s.componentType)}function Fh(s,e,t,r){let n=s.type==="ARRAY",o=s.componentCount,i="SCALAR",a=s.componentType||s.type,c=Ir(i,a),u=t.byteLength/c,l=Jt(t,i,a,u);return n?r?an(l,e,r,t.length,c):o?cn(l,e,o):[]:l}function Dh(s,e,t){let r=s.gltf.json;if(!r.meshes)return[];let n=[];for(let o of r.meshes)for(let i of o.primitives)Rh(s,t,e,n,i);return n}function Rh(s,e,t,r,n){let o={channels:t.channels,...t.texture},i=Ht(s,o,n);i&&on(s,e,i,r,n)}var za="4.3.3";var Ya="4.3.3";var ln={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"},Za;async function co(s){ys(s.modules);let e=xs("basis");return e||(Za||=Gh(s),await Za)}async function Gh(s){let e=null,t=null;return[e,t]=await Promise.all([await je(ln.TRANSCODER,"textures",s),await je(ln.TRANSCODER_WASM,"textures",s)]),e=e||globalThis.BASIS,await Lh(e,t)}function Lh(s,e){let t={};return e&&(t.wasmBinary=e),new Promise(r=>{s(t).then(n=>{let{BasisFile:o,initializeBasis:i}=n;i(),r({BasisFile:o})})})}var ao;async function uo(s){let e=s.modules||{};return e.basisEncoder?e.basisEncoder:(ao=ao||Oh(s),await ao)}async function Oh(s){let e=null,t=null;return[e,t]=await Promise.all([await je(ln.ENCODER,"textures",s),await je(ln.ENCODER_WASM,"textures",s)]),e=e||globalThis.BASIS,await Ph(e,t)}function Ph(s,e){let t={};return e&&(t.wasmBinary=e),new Promise(r=>{s(t).then(n=>{let{BasisFile:o,KTX2File:i,initializeBasis:a,BasisEncoder:c}=n;a(),r({BasisFile:o,KTX2File:i,BasisEncoder:c})})})}var _t={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};var Uh=["","WEBKIT_","MOZ_"],ec={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},fn=null;function tc(s){if(!fn){s=s||Nh()||void 0,fn=new Set;for(let e of Uh)for(let t in ec)if(s&&s.getExtension(`${e}${t}`)){let r=ec[t];fn.add(r)}}return fn}function Nh(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Te=[171,75,84,88,32,50,48,187,13,10,26,10];function rc(s){let e=new Uint8Array(s);return!(e.byteLength<Te.length||e[0]!==Te[0]||e[1]!==Te[1]||e[2]!==Te[2]||e[3]!==Te[3]||e[4]!==Te[4]||e[5]!==Te[5]||e[6]!==Te[6]||e[7]!==Te[7]||e[8]!==Te[8]||e[9]!==Te[9]||e[10]!==Te[10]||e[11]!==Te[11])}var Vh={etc1:{basisFormat:0,compressed:!0,format:_t.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:_t.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:_t.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:_t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:_t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:_t.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function sc(s,e){if(e.basis.containerFormat==="auto"){if(rc(s)){let r=await uo(e);return nc(r.KTX2File,s,e)}let{BasisFile:t}=await co(e);return lo(t,s,e)}switch(e.basis.module){case"encoder":let t=await uo(e);switch(e.basis.containerFormat){case"ktx2":return nc(t.KTX2File,s,e);case"basis":default:return lo(t.BasisFile,s,e)}case"transcoder":default:let{BasisFile:r}=await co(e);return lo(r,s,e)}}function lo(s,e,t){let r=new s(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");let n=r.getNumImages(),o=[];for(let i=0;i<n;i++){let a=r.getNumLevels(i),c=[];for(let u=0;u<a;u++)c.push(Jh(r,i,u,t));o.push(c)}return o}finally{r.close(),r.delete()}}function Jh(s,e,t,r){let n=s.getImageWidth(e,t),o=s.getImageHeight(e,t),i=s.getHasAlpha(),{compressed:a,format:c,basisFormat:u}=oc(r,i),l=s.getImageTranscodedSizeInBytes(e,t,u),f=new Uint8Array(l);if(!s.transcodeImage(f,e,t,u,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:f,compressed:a,format:c,hasAlpha:i}}function nc(s,e,t){let r=new s(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");let n=r.getLevels(),o=[];for(let i=0;i<n;i++)o.push(Hh(r,i,t));return[o]}finally{r.close(),r.delete()}}function Hh(s,e,t){let{alphaFlag:r,height:n,width:o}=s.getImageLevelInfo(e,0,0),{compressed:i,format:a,basisFormat:c}=oc(t,r),u=s.getImageTranscodedSizeInBytes(e,0,0,c),l=new Uint8Array(u);if(!s.transcodeImage(l,e,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:l,compressed:i,levelSize:u,hasAlpha:r,format:a}}function oc(s,e){let t=s&&s.basis&&s.basis.format;return t==="auto"&&(t=hn()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),Vh[t]}function hn(){let s=tc();return s.has("astc")?"astc-4x4":s.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:s.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:s.has("etc1")?"etc1":s.has("etc2")?"etc2":"rgb565"}var ic={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Ya,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},fo={...ic,parse:sc};var Wt=!0,ac=1735152710,po=12,mn=8,jh=1313821514,$h=5130562,Wh=0,Kh=0,Xh=1;function Qh(s,e=0){return`${String.fromCharCode(s.getUint8(e+0))}${String.fromCharCode(s.getUint8(e+1))}${String.fromCharCode(s.getUint8(e+2))}${String.fromCharCode(s.getUint8(e+3))}`}function cc(s,e=0,t={}){let r=new DataView(s),{magic:n=ac}=t,o=r.getUint32(e,!1);return o===n||o===ac}function uc(s,e,t=0,r={}){let n=new DataView(e),o=Qh(n,t+0),i=n.getUint32(t+4,Wt),a=n.getUint32(t+8,Wt);switch(Object.assign(s,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:o,version:i,json:{},binChunks:[]}),t+=po,s.version){case 1:return qh(s,n,t);case 2:return zh(s,n,t,r={});default:throw new Error(`Invalid GLB version ${s.version}. Only supports version 1 and 2.`)}}function qh(s,e,t){de(s.header.byteLength>po+mn);let r=e.getUint32(t+0,Wt),n=e.getUint32(t+4,Wt);return t+=mn,de(n===Wh),ho(s,e,t,r),t+=r,t+=mo(s,e,t,s.header.byteLength),t}function zh(s,e,t,r){return de(s.header.byteLength>po+mn),Yh(s,e,t,r),t+s.header.byteLength}function Yh(s,e,t,r){for(;t+8<=s.header.byteLength;){let n=e.getUint32(t+0,Wt),o=e.getUint32(t+4,Wt);switch(t+=mn,o){case jh:ho(s,e,t,n);break;case $h:mo(s,e,t,n);break;case Kh:r.strict||ho(s,e,t,n);break;case Xh:r.strict||mo(s,e,t,n);break;default:break}t+=it(n,4)}return t}function ho(s,e,t,r){let n=new Uint8Array(e.buffer,t,r),i=new TextDecoder("utf8").decode(n);return s.json=JSON.parse(i),it(r,4)}function mo(s,e,t,r){return s.header.hasBinChunk=!0,s.binChunks.push({byteOffset:t,byteLength:r,arrayBuffer:e.buffer}),it(r,4)}function go(s,e){if(s.startsWith("data:")||s.startsWith("http:")||s.startsWith("https:"))return s;let r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${s}`);return r.substr(0,r.lastIndexOf("/")+1)+s}var xo={};ke(xo,{decode:()=>lm,name:()=>um});var Zh="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",em="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",tm=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),rm=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),nm={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},sm={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function lc(s,e,t,r,n,o="NONE"){let i=await om();cm(i,i.exports[sm[n]],s,e,t,r,i.exports[nm[o||"NONE"]])}var yo;async function om(){return yo||(yo=im()),yo}async function im(){let s=Zh;WebAssembly.validate(tm)&&(s=em,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let e=await WebAssembly.instantiate(am(s),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function am(s){let e=new Uint8Array(s.length);for(let r=0;r<s.length;++r){let n=s.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let r=0;r<s.length;++r)e[t++]=e[r]<60?rm[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,t)}function cm(s,e,t,r,n,o,i){let a=s.exports.sbrk,c=r+3&-4,u=a(c*n),l=a(o.length),f=new Uint8Array(s.exports.memory.buffer);f.set(o,l);let h=e(u,r,n,l,o.length);if(h===0&&i&&i(u,c,n),t.set(f.subarray(u,u+r*n)),a(u-a(0)),h!==0)throw new Error(`Malformed buffer data: ${h}`)}var pn="EXT_meshopt_compression",um=pn;async function lm(s,e){let t=new W(s);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;let r=[];for(let n of s.json.bufferViews||[])r.push(fm(t,n));await Promise.all(r),t.removeExtension(pn)}async function fm(s,e){let t=s.getObjectExtension(e,pn);if(t){let{byteOffset:r=0,byteLength:n=0,byteStride:o,count:i,mode:a,filter:c="NONE",buffer:u}=t,l=s.gltf.buffers[u],f=new Uint8Array(l.arrayBuffer,l.byteOffset+r,n),h=new Uint8Array(s.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await lc(h,i,o,f,a,c),s.removeObjectExtension(e,pn)}}var bo={};ke(bo,{name:()=>hm,preprocess:()=>mm});var Kt="EXT_texture_webp",hm=Kt;function mm(s,e){let t=new W(s);if(!to("image/webp")){if(t.getRequiredExtensions().includes(Kt))throw new Error(`gltf: Required extension ${Kt} not supported by browser`);return}let{json:r}=t;for(let n of r.textures||[]){let o=t.getObjectExtension(n,Kt);o&&(n.source=o.source),t.removeObjectExtension(n,Kt)}t.removeExtension(Kt)}var Ao={};ke(Ao,{name:()=>pm,preprocess:()=>dm});var dn="KHR_texture_basisu",pm=dn;function dm(s,e){let t=new W(s),{json:r}=t;for(let n of r.textures||[]){let o=t.getObjectExtension(n,dn);o&&(n.source=o.source,t.removeObjectExtension(n,dn))}t.removeExtension(dn)}var Eo={};ke(Eo,{decode:()=>Mm,encode:()=>Fm,name:()=>km,preprocess:()=>Sm});var fc="4.3.3";var hc={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:fc,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function pc(s,e,t){let r=dc(e.metadata),n=[],o=gm(e.attributes);for(let i in s){let a=s[i],c=mc(i,a,o[i]);n.push(c)}if(t){let i=mc("indices",t);n.push(i)}return{fields:n,metadata:r}}function gm(s){let e={};for(let t in s){let r=s[t];e[r.name||"undefined"]=r}return e}function mc(s,e,t){let r=t?dc(t.metadata):void 0;return Xs(s,e,r)}function dc(s){Object.entries(s);let e={};for(let t in s)e[`${t}.string`]=JSON.stringify(s[t]);return e}var gc={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},ym={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},xm=4,Cr=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){let r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);let n=this.decoder.GetEncodedGeometryType(r),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let i;switch(n){case this.draco.TRIANGULAR_MESH:i=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:i=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!i.ok()||!o.ptr){let h=`DRACO decompression failed: ${i.error_msg()}`;throw new Error(h)}let a=this._getDracoLoaderData(o,n,t),c=this._getMeshData(o,a,t),u=Ks(c.attributes),l=pc(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:o.num_points(),boundingBox:u},...c,schema:l}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,r){let n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,t){let r={};for(let n=0;n<e.num_attributes();n++){let o=this.decoder.GetAttribute(e,n),i=this._getAttributeMetadata(e,n);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:i};let a=this._getQuantizationTransform(o,t);a&&(r[o.unique_id()].quantization_transform=a);let c=this._getOctahedronTransform(o,t);c&&(r[o.unique_id()].octahedron_transform=c)}return r}_getMeshData(e,t,r){let n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){let n={};for(let o of Object.values(e.attributes)){let i=this._deduceAttributeName(o,r);o.name=i;let a=this._getAttributeValues(t,o);if(a){let{value:c,size:u}=a;n[i]={value:c,size:u,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return n}_getTriangleListIndices(e){let r=e.num_faces()*3,n=r*xm,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){let t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),wm(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){let r=ym[t.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;let n=t.num_components,i=e.num_points()*n,a=i*r.BYTES_PER_ELEMENT,c=bm(this.draco,r),u,l=this.draco._malloc(a);try{let f=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,f,c,a,l),u=new r(this.draco.HEAPF32.buffer,l,i).slice()}finally{this.draco._free(l)}return{value:u,size:n}}_deduceAttributeName(e,t){let r=e.unique_id;for(let[i,a]of Object.entries(t.extraAttributes||{}))if(a===r)return i;let n=e.attribute_type;for(let i in gc)if(this.draco[i]===n)return gc[i];let o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){let t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){let r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){let o=this.metadataQuerier.GetEntryName(e,n);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){let r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);let n=Am(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){let{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e,n=[...t,...r];for(let o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){let{quantizedAttributes:r=[]}=t,n=e.attribute_type();if(r.map(i=>this.decoder[i]).includes(n)){let i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(e))return{quantization_bits:i.quantization_bits(),range:i.range(),min_values:new Float32Array([1,2,3]).map(a=>i.min_value(a))}}finally{this.draco.destroy(i)}}return null}_getOctahedronTransform(e,t){let{octahedronAttributes:r=[]}=t,n=e.attribute_type();if(r.map(i=>this.decoder[i]).includes(n)){let i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(e))return{quantization_bits:i.quantization_bits()}}finally{this.draco.destroy(i)}}return null}};function bm(s,e){switch(e){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32;default:return s.DT_INVALID}}function Am(s){let e=s.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=s.GetValue(r);return t}function wm(s){let e=s.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=s.GetValue(r);return t}var _m="1.5.6",Bm="1.4.1",wo=`https://www.gstatic.com/draco/versioned/decoders/${_m}`,be={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},_o={[be.DECODER]:`${wo}/${be.DECODER}`,[be.DECODER_WASM]:`${wo}/${be.DECODER_WASM}`,[be.FALLBACK_DECODER]:`${wo}/${be.FALLBACK_DECODER}`,[be.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Bm}/javascript/${be.ENCODER}`},Bo;async function yc(s){let e=s.modules||{};return e.draco3d?Bo||=e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Bo||=vm(s),await Bo}async function vm(s){let e,t;switch(s.draco&&s.draco.decoderType){case"js":e=await je(_o[be.FALLBACK_DECODER],"draco",s,be.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await je(_o[be.DECODER],"draco",s,be.DECODER),await je(_o[be.DECODER_WASM],"draco",s,be.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Em(e,t)}function Em(s,e){let t={};return e&&(t.wasmBinary=e),new Promise(r=>{s({...t,onModuleLoaded:n=>r({draco:n})})})}var xc={...hc,parse:Tm};async function Tm(s,e){let{draco:t}=await yc(e),r=new Cr(t);try{return r.parseSync(s,e?.draco)}finally{r.destroy()}}function bc(s){let e={};for(let t in s){let r=s[t];if(t!=="indices"){let n=vo(r);e[t]=n}}return e}function vo(s){let{buffer:e,size:t,count:r}=Im(s);return{value:e,size:t,byteOffset:0,count:r,type:sn(t),componentType:at(e)}}function Im(s){let e=s,t=1,r=0;return s&&s.value&&(e=s.value,t=s.size||1),e&&(ArrayBuffer.isView(e)||(e=Cm(e,Float32Array)),r=e.length/t),{buffer:e,size:t,count:r}}function Cm(s,e,t=!1){return s?Array.isArray(s)?new e(s):t&&!(s instanceof e)?new e(s):s:null}var ct="KHR_draco_mesh_compression",km=ct;function Sm(s,e,t){let r=new W(s);for(let n of Ac(r))r.getObjectExtension(n,ct)}async function Mm(s,e,t){if(!e?.gltf?.decompressMeshes)return;let r=new W(s),n=[];for(let o of Ac(r))r.getObjectExtension(o,ct)&&n.push(Dm(r,o,e,t));await Promise.all(n),r.removeExtension(ct)}function Fm(s,e={}){let t=new W(s);for(let r of t.json.meshes||[])Rm(r,e),t.addRequiredExtension(ct)}async function Dm(s,e,t,r){let n=s.getObjectExtension(e,ct);if(!n)return;let o=s.getTypedArrayForBufferView(n.bufferView),i=Ar(o.buffer,o.byteOffset),a={...t};delete a["3d-tiles"];let c=await pr(i,xc,a,r),u=bc(c.attributes);for(let[l,f]of Object.entries(u))if(l in e.attributes){let h=e.attributes[l],y=s.getAccessor(h);y?.min&&y?.max&&(f.min=y.min,f.max=y.max)}e.attributes=u,c.indices&&(e.indices=vo(c.indices)),s.removeObjectExtension(e,ct),Gm(e)}function Rm(s,e,t=4,r,n){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let o=r.DracoWriter.encodeSync({attributes:s}),i=n?.parseSync?.({attributes:s}),a=r._addFauxAttributes(i.attributes),c=r.addBufferView(o);return{primitives:[{attributes:a,mode:t,extensions:{[ct]:{bufferView:c,attributes:a}}}]}}function Gm(s){if(!s.attributes&&Object.keys(s.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Ac(s){for(let e of s.json.meshes||[])for(let t of e.primitives)yield t}var Fo={};ke(Fo,{decode:()=>ep,name:()=>zm});var qA=1/Math.PI*180,zA=1/180*Math.PI,Lm={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Lm}};var le=globalThis.mathgl.config;function wc(s,{precision:e=le.precision}={}){return s=Om(s),`${parseFloat(s.toPrecision(e))}`}function Xt(s){return Array.isArray(s)||ArrayBuffer.isView(s)&&!(s instanceof DataView)}function To(s,e,t){let r=le.EPSILON;t&&(le.EPSILON=t);try{if(s===e)return!0;if(Xt(s)&&Xt(e)){if(s.length!==e.length)return!1;for(let n=0;n<s.length;++n)if(!To(s[n],e[n]))return!1;return!0}return s&&s.equals?s.equals(e):e&&e.equals?e.equals(s):typeof s=="number"&&typeof e=="number"?Math.abs(s-e)<=le.EPSILON*Math.max(1,Math.abs(s),Math.abs(e)):!1}finally{le.EPSILON=r}}function Om(s){return Math.round(s/le.EPSILON)*le.EPSILON}var Qt=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Xt(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(le)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+wc(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!To(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){let o=e[n],i=typeof t=="number"?t:t[n];this[n]=o+r*(i-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(let t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(let t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(le.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}};function Pm(s,e){if(s.length!==e)return!1;for(let t=0;t<s.length;++t)if(!Number.isFinite(s[t]))return!1;return!0}function me(s){if(!Number.isFinite(s))throw new Error(`Invalid number ${JSON.stringify(s)}`);return s}function _c(s,e,t=""){if(le.debug&&!Pm(s,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return s}function Io(s,e){if(!s)throw new Error(`math.gl assertion ${e}`)}var gn=class extends Qt{get x(){return this[0]}set x(e){this[0]=me(e)}get y(){return this[1]}set y(e){this[1]=me(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){let n=this[r]-e[r];t+=n*n}return me(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return me(t)}normalize(){let e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(let t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Io(e>=0&&e<this.ELEMENTS,"index is out of range"),me(this[e])}setComponent(e,t){return Io(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var qt=typeof Float32Array<"u"?Float32Array:Array;var cw=Math.PI/180;function Jm(){let s=new qt(2);return qt!=Float32Array&&(s[0]=0,s[1]=0),s}function vc(s,e,t){let r=e[0],n=e[1];return s[0]=t[0]*r+t[3]*n+t[6],s[1]=t[1]*r+t[4]*n+t[7],s}var uw=(function(){let s=Jm();return function(e,t,r,n,o,i){let a,c;for(t||(t=2),r||(r=0),n?c=Math.min(n*t+r,e.length):c=e.length,a=r;a<c;a+=t)s[0]=e[a],s[1]=e[a+1],o(s,s,i),e[a]=s[0],e[a+1]=s[1];return e}})();function Ec(s,e,t){let r=e[0],n=e[1],o=e[2],i=t[3]*r+t[7]*n+t[11]*o||1;return s[0]=(t[0]*r+t[4]*n+t[8]*o)/i,s[1]=(t[1]*r+t[5]*n+t[9]*o)/i,s[2]=(t[2]*r+t[6]*n+t[10]*o)/i,s}function Tc(s,e,t){let r=e[0],n=e[1];return s[0]=t[0]*r+t[2]*n,s[1]=t[1]*r+t[3]*n,s[2]=e[2],s}function Ic(s,e,t){let r=e[0],n=e[1],o=e[2];return s[0]=t[0]*r+t[3]*n+t[6]*o,s[1]=t[1]*r+t[4]*n+t[7]*o,s[2]=t[2]*r+t[5]*n+t[8]*o,s[3]=e[3],s}function jm(){let s=new qt(3);return qt!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function $m(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Cc(s,e,t){let r=e[0],n=e[1],o=e[2],i=t[0],a=t[1],c=t[2];return s[0]=n*c-o*a,s[1]=o*i-r*c,s[2]=r*a-n*i,s}function kc(s,e,t){let r=e[0],n=e[1],o=e[2],i=t[3]*r+t[7]*n+t[11]*o+t[15];return i=i||1,s[0]=(t[0]*r+t[4]*n+t[8]*o+t[12])/i,s[1]=(t[1]*r+t[5]*n+t[9]*o+t[13])/i,s[2]=(t[2]*r+t[6]*n+t[10]*o+t[14])/i,s}function yn(s,e,t){let r=e[0],n=e[1],o=e[2];return s[0]=r*t[0]+n*t[3]+o*t[6],s[1]=r*t[1]+n*t[4]+o*t[7],s[2]=r*t[2]+n*t[5]+o*t[8],s}function Sc(s,e,t){let r=t[0],n=t[1],o=t[2],i=t[3],a=e[0],c=e[1],u=e[2],l=n*u-o*c,f=o*a-r*u,h=r*c-n*a,y=n*h-o*f,g=o*l-r*h,_=r*f-n*l,T=i*2;return l*=T,f*=T,h*=T,y*=2,g*=2,_*=2,s[0]=a+l+y,s[1]=c+f+g,s[2]=u+h+_,s}function Mc(s,e,t,r){let n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),s[0]=o[0]+t[0],s[1]=o[1]+t[1],s[2]=o[2]+t[2],s}function Fc(s,e,t,r){let n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),s[0]=o[0]+t[0],s[1]=o[1]+t[1],s[2]=o[2]+t[2],s}function Dc(s,e,t,r){let n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],s[0]=o[0]+t[0],s[1]=o[1]+t[1],s[2]=o[2]+t[2],s}function Rc(s,e){let t=s[0],r=s[1],n=s[2],o=e[0],i=e[1],a=e[2],c=Math.sqrt((t*t+r*r+n*n)*(o*o+i*i+a*a)),u=c&&$m(s,e)/c;return Math.acos(Math.min(Math.max(u,-1),1))}var fw=(function(){let s=jm();return function(e,t,r,n,o,i){let a,c;for(t||(t=3),r||(r=0),n?c=Math.min(n*t+r,e.length):c=e.length,a=r;a<c;a+=t)s[0]=e[a],s[1]=e[a+1],s[2]=e[a+2],o(s,s,i),e[a]=s[0],e[a+1]=s[1],e[a+2]=s[2];return e}})();var Co=[0,0,0],xn,kr=class s extends gn{static get ZERO(){return xn||(xn=new s(0,0,0),Object.freeze(xn)),xn}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Xt(e)?this.copy(e):(le.debug&&(me(e),me(t),me(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return le.debug&&(me(e.x),me(e.y),me(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=me(e)}angle(e){return Rc(this,e)}cross(e){return Cc(this,this,e),this.check()}rotateX({radians:e,origin:t=Co}){return Mc(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Co}){return Fc(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Co}){return Dc(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return kc(this,this,e),this.check()}transformAsVector(e){return Ec(this,this,e),this.check()}transformByMatrix3(e){return yn(this,this,e),this.check()}transformByMatrix2(e){return Tc(this,this,e),this.check()}transformByQuaternion(e){return Sc(this,this,e),this.check()}};var bn=class extends Qt{toString(){let e="[";if(le.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=me(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){let r=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[r+n];return t}setColumn(e,t){let r=e*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=t[n];return this}};function Gc(s,e){if(s===e){let t=e[1],r=e[2],n=e[5];s[1]=e[3],s[2]=e[6],s[3]=t,s[5]=e[7],s[6]=r,s[7]=n}else s[0]=e[0],s[1]=e[3],s[2]=e[6],s[3]=e[1],s[4]=e[4],s[5]=e[7],s[6]=e[2],s[7]=e[5],s[8]=e[8];return s}function Lc(s,e){let t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],c=e[6],u=e[7],l=e[8],f=l*i-a*u,h=-l*o+a*c,y=u*o-i*c,g=t*f+r*h+n*y;return g?(g=1/g,s[0]=f*g,s[1]=(-l*r+n*u)*g,s[2]=(a*r-n*i)*g,s[3]=h*g,s[4]=(l*t-n*c)*g,s[5]=(-a*t+n*o)*g,s[6]=y*g,s[7]=(-u*t+r*c)*g,s[8]=(i*t-r*o)*g,s):null}function Oc(s){let e=s[0],t=s[1],r=s[2],n=s[3],o=s[4],i=s[5],a=s[6],c=s[7],u=s[8];return e*(u*o-i*c)+t*(-u*n+i*a)+r*(c*n-o*a)}function ko(s,e,t){let r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=t[0],y=t[1],g=t[2],_=t[3],T=t[4],d=t[5],C=t[6],E=t[7],I=t[8];return s[0]=h*r+y*i+g*u,s[1]=h*n+y*a+g*l,s[2]=h*o+y*c+g*f,s[3]=_*r+T*i+d*u,s[4]=_*n+T*a+d*l,s[5]=_*o+T*c+d*f,s[6]=C*r+E*i+I*u,s[7]=C*n+E*a+I*l,s[8]=C*o+E*c+I*f,s}function Pc(s,e,t){let r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=t[0],y=t[1];return s[0]=r,s[1]=n,s[2]=o,s[3]=i,s[4]=a,s[5]=c,s[6]=h*r+y*i+u,s[7]=h*n+y*a+l,s[8]=h*o+y*c+f,s}function Uc(s,e,t){let r=e[0],n=e[1],o=e[2],i=e[3],a=e[4],c=e[5],u=e[6],l=e[7],f=e[8],h=Math.sin(t),y=Math.cos(t);return s[0]=y*r+h*i,s[1]=y*n+h*a,s[2]=y*o+h*c,s[3]=y*i-h*r,s[4]=y*a-h*n,s[5]=y*c-h*o,s[6]=u,s[7]=l,s[8]=f,s}function So(s,e,t){let r=t[0],n=t[1];return s[0]=r*e[0],s[1]=r*e[1],s[2]=r*e[2],s[3]=n*e[3],s[4]=n*e[4],s[5]=n*e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s}function Nc(s,e){let t=e[0],r=e[1],n=e[2],o=e[3],i=t+t,a=r+r,c=n+n,u=t*i,l=r*i,f=r*a,h=n*i,y=n*a,g=n*c,_=o*i,T=o*a,d=o*c;return s[0]=1-f-g,s[3]=l-d,s[6]=h+T,s[1]=l+d,s[4]=1-u-g,s[7]=y-_,s[2]=h-T,s[5]=y+_,s[8]=1-u-f,s}var Mo;(function(s){s[s.COL0ROW0=0]="COL0ROW0",s[s.COL0ROW1=1]="COL0ROW1",s[s.COL0ROW2=2]="COL0ROW2",s[s.COL1ROW0=3]="COL1ROW0",s[s.COL1ROW1=4]="COL1ROW1",s[s.COL1ROW2=5]="COL1ROW2",s[s.COL2ROW0=6]="COL2ROW0",s[s.COL2ROW1=7]="COL2ROW1",s[s.COL2ROW2=8]="COL2ROW2"})(Mo||(Mo={}));var Xm=Object.freeze([1,0,0,0,1,0,0,0,1]),Ze=class extends bn{static get IDENTITY(){return qm()}static get ZERO(){return Qm()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Mo}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Xm)}fromObject(e){return this.check()}fromQuaternion(e){return Nc(this,e),this.check()}set(e,t,r,n,o,i,a,c,u){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=i,this[6]=a,this[7]=c,this[8]=u,this.check()}setRowMajor(e,t,r,n,o,i,a,c,u){return this[0]=e,this[1]=n,this[2]=a,this[3]=t,this[4]=o,this[5]=c,this[6]=r,this[7]=i,this[8]=u,this.check()}determinant(){return Oc(this)}transpose(){return Gc(this,this),this.check()}invert(){return Lc(this,this),this.check()}multiplyLeft(e){return ko(this,e,this),this.check()}multiplyRight(e){return ko(this,this,e),this.check()}rotate(e){return Uc(this,this,e),this.check()}scale(e){return Array.isArray(e)?So(this,this,e):So(this,this,[e,e]),this.check()}translate(e){return Pc(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=vc(t||[-0,-0],e,this);break;case 3:r=yn(t||[-0,-0,-0],e,this);break;case 4:r=Ic(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return _c(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}},An,wn=null;function Qm(){return An||(An=new Ze([0,0,0,0,0,0,0,0,0]),Object.freeze(An)),An}function qm(){return wn||(wn=new Ze,Object.freeze(wn)),wn}var Bn="KHR_texture_transform",zm=Bn,_n=new kr,Ym=new Ze,Zm=new Ze;async function ep(s,e){if(!new W(s).hasExtension(Bn)||!e.gltf?.loadBuffers)return;let n=s.json.materials||[];for(let o=0;o<n.length;o++)tp(o,s)}function tp(s,e){let t=e.json.materials?.[s],r=[t?.pbrMetallicRoughness?.baseColorTexture,t?.emissiveTexture,t?.normalTexture,t?.occlusionTexture,t?.pbrMetallicRoughness?.metallicRoughnessTexture],n=[];for(let o of r)o&&o?.extensions?.[Bn]&&rp(e,s,o,n)}function rp(s,e,t,r){let n=np(t,r);if(!n)return;let o=s.json.meshes||[];for(let i of o)for(let a of i.primitives){let c=a.material;Number.isFinite(c)&&e===c&&sp(s,a,n)}}function np(s,e){let t=s.extensions?.[Bn],{texCoord:r=0}=s,{texCoord:n=r}=t;if(!(e.findIndex(([i,a])=>i===r&&a===n)!==-1)){let i=ap(t);return r!==n&&(s.texCoord=n),e.push([r,n]),{originalTexCoord:r,texCoord:n,matrix:i}}return null}function sp(s,e,t){let{originalTexCoord:r,texCoord:n,matrix:o}=t,i=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(i)){let a=s.json.accessors?.[i];if(a&&a.bufferView){let c=s.json.bufferViews?.[a.bufferView];if(c){let{arrayBuffer:u,byteOffset:l}=s.buffers[c.buffer],f=(l||0)+(a.byteOffset||0)+(c.byteOffset||0),{ArrayType:h,length:y}=Nt(a,c),g=nn[a.componentType],_=rn[a.type],T=c.byteStride||g*_,d=new Float32Array(y);for(let C=0;C<a.count;C++){let E=new h(u,f+C*T,2);_n.set(E[0],E[1],1),_n.transformByMatrix3(o),d.set([_n[0],_n[1]],C*_)}r===n?op(a,c,s.buffers,d):ip(n,a,e,s,d)}}}}function op(s,e,t,r){s.componentType=5126,t.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function ip(s,e,t,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});let o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});let i=r.json.accessors;i&&(i.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${s}`]=i.length-1)}function ap(s){let{offset:e=[0,0],rotation:t=0,scale:r=[1,1]}=s,n=new Ze().set(1,0,0,0,1,0,e[0],e[1],1),o=Ym.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),i=Zm.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(i)}var Do={};ke(Do,{decode:()=>up,encode:()=>lp,name:()=>cp});var Bt="KHR_lights_punctual",cp=Bt;async function up(s){let e=new W(s),{json:t}=e,r=e.getExtension(Bt);r&&(e.json.lights=r.lights,e.removeExtension(Bt));for(let n of t.nodes||[]){let o=e.getObjectExtension(n,Bt);o&&(n.light=o.light),e.removeObjectExtension(n,Bt)}}async function lp(s){let e=new W(s),{json:t}=e;if(t.lights){let r=e.addExtension(Bt);oe(!r.lights),r.lights=t.lights,delete t.lights}if(e.json.lights){for(let r of e.json.lights){let n=r.node;e.addObjectExtension(n,Bt,r)}delete e.json.lights}}var Ro={};ke(Ro,{decode:()=>hp,encode:()=>mp,name:()=>fp});var Sr="KHR_materials_unlit",fp=Sr;async function hp(s){let e=new W(s),{json:t}=e;for(let r of t.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,Sr);e.removeExtension(Sr)}function mp(s){let e=new W(s),{json:t}=e;if(e.materials)for(let r of t.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,Sr,{}),e.addExtension(Sr))}var Go={};ke(Go,{decode:()=>dp,encode:()=>gp,name:()=>pp});var Mr="KHR_techniques_webgl",pp=Mr;async function dp(s){let e=new W(s),{json:t}=e,r=e.getExtension(Mr);if(r){let n=yp(r,e);for(let o of t.materials||[]){let i=e.getObjectExtension(o,Mr);i&&(o.technique=Object.assign({},i,n[i.technique]),o.technique.values=xp(o.technique,e)),e.removeObjectExtension(o,Mr)}e.removeExtension(Mr)}}async function gp(s,e){}function yp(s,e){let{programs:t=[],shaders:r=[],techniques:n=[]}=s,o=new TextDecoder;return r.forEach(i=>{if(Number.isFinite(i.bufferView))i.code=o.decode(e.getTypedArrayForBufferView(i.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(i=>{i.fragmentShader=r[i.fragmentShader],i.vertexShader=r[i.vertexShader]}),n.forEach(i=>{i.program=t[i.program]}),n}function xp(s,e){let t=Object.assign({},s.values);return Object.keys(s.uniforms||{}).forEach(r=>{s.uniforms[r].value&&!(r in t)&&(t[r]=s.uniforms[r].value)}),Object.keys(t).forEach(r=>{typeof t[r]=="object"&&t[r].index!==void 0&&(t[r].texture=e.getTexture(t[r].index))}),t}var Vc=[oo,ro,xo,bo,Ao,Eo,Do,Ro,Go,Fo,io];function Jc(s,e={},t){let r=Vc.filter(n=>jc(n.name,e));for(let n of r)n.preprocess?.(s,e,t)}async function Hc(s,e={},t){let r=Vc.filter(n=>jc(n.name,e));for(let n of r)await n.decode?.(s,e,t)}function jc(s,e){let t=e?.gltf?.excludeExtensions||{};return!(s in t&&!t[s])}var Lo="KHR_binary_glTF";function $c(s){let e=new W(s),{json:t}=e;for(let r of t.images||[]){let n=e.getObjectExtension(r,Lo);n&&Object.assign(r,n),e.removeObjectExtension(r,Lo)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(Lo)}var Wc={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Ap={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},Oo=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;let r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),$c(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let t in Wc)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){let r=e[t];if(!(!r||Array.isArray(r))){e[t]=[];for(let n in r){let o=r[n];o.id=o.id||n;let i=e[t].length;e[t].push(o),this.idToIndexMap[t][n]=i}}}_convertObjectIdsToArrayIndices(e){for(let t in Wc)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(let t of e.textures)this._convertTextureIds(t);for(let t of e.meshes)this._convertMeshIds(t);for(let t of e.nodes)this._convertNodeIds(t);for(let t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let t of e.primitives){let{attributes:r,indices:n,material:o}=t;for(let i in r)r[i]=this._convertIdToIndex(r[i],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(let r of e[t])for(let n in r){let o=r[n],i=this._convertIdToIndex(o,n);r[n]=i}}_convertIdToIndex(e,t){let r=Ap[t];if(r in this.idToIndexMap){let n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(let t of this.json.buffers)delete t.type}_updateMaterial(e){for(let t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let r=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,n=e.textures.findIndex(o=>o.id===r);n!==-1&&(t.pbrMetallicRoughness.baseColorTexture={index:n})}}};function Kc(s,e={}){return new Oo().normalize(s,e)}async function Xc(s,e,t=0,r,n){return wp(s,e,t,r),Kc(s,{normalize:r?.gltf?.normalize}),Jc(s,r,n),r?.gltf?.loadBuffers&&s.json.buffers&&await _p(s,r,n),r?.gltf?.loadImages&&await Bp(s,r,n),await Hc(s,r,n),s}function wp(s,e,t,r){if(r.uri&&(s.baseUri=r.uri),e instanceof ArrayBuffer&&!cc(e,t,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")s.json=Is(e);else if(e instanceof ArrayBuffer){let i={};t=uc(i,e,t,r.glb),oe(i.type==="glTF",`Invalid GLB magic string ${i.type}`),s._glb=i,s.json=i.json}else oe(!1,"GLTF: must be ArrayBuffer or string");let n=s.json.buffers||[];if(s.buffers=new Array(n.length).fill(null),s._glb&&s._glb.header.hasBinChunk){let{binChunks:i}=s._glb;s.buffers[0]={arrayBuffer:i[0].arrayBuffer,byteOffset:i[0].byteOffset,byteLength:i[0].byteLength}}let o=s.json.images||[];s.images=new Array(o.length).fill({})}async function _p(s,e,t){let r=s.json.buffers||[];for(let n=0;n<r.length;++n){let o=r[n];if(o.uri){let{fetch:i}=t;oe(i);let a=go(o.uri,e),u=await(await t?.fetch?.(a))?.arrayBuffer?.();s.buffers[n]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete o.uri}else s.buffers[n]===null&&(s.buffers[n]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function Bp(s,e,t){let r=vp(s),n=s.json.images||[],o=[];for(let i of r)o.push(Ep(s,n[i],i,e,t));return await Promise.all(o)}function vp(s){let e=new Set,t=s.json.textures||[];for(let r of t)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function Ep(s,e,t,r,n){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){let a=go(e.uri,r),{fetch:c}=n;o=await(await c(a)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){let a=$a(s.json,s.buffers,e.bufferView);o=Ar(a.buffer,a.byteOffset,a.byteLength)}oe(o,"glTF image has no data");let i=await pr(o,[Zs,fo],{...r,mimeType:e.mimeType,basis:r.basis||{format:hn()}},n);i&&i[0]&&(i={compressed:!0,mipmaps:!1,width:i[0].width,height:i[0].height,data:i[0]}),s.images=s.images||[],s.images[t]=i}var zt={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:za,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Tp,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Tp(s,e={},t){e={...zt.options,...e},e.gltf={...zt.options.gltf,...e.gltf};let{byteOffset:r=0}=e;return await Xc({},s,r,e,t)}var Ip={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Cp={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Me={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},kp={magFilter:Me.TEXTURE_MAG_FILTER,minFilter:Me.TEXTURE_MIN_FILTER,wrapS:Me.TEXTURE_WRAP_S,wrapT:Me.TEXTURE_WRAP_T},Sp={[Me.TEXTURE_MAG_FILTER]:Me.LINEAR,[Me.TEXTURE_MIN_FILTER]:Me.NEAREST_MIPMAP_LINEAR,[Me.TEXTURE_WRAP_S]:Me.REPEAT,[Me.TEXTURE_WRAP_T]:Me.REPEAT};function Mp(){return{id:"default-sampler",parameters:Sp}}function Fp(s){return Cp[s]}function Dp(s){return Ip[s]}var Po=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,t={}){let{json:r,buffers:n=[],images:o=[]}=e,{baseUri:i=""}=e;return oe(r),this.baseUri=i,this.buffers=n,this.images=o,this.jsonUnprocessed=r,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){let r={...e};return this.json=r,e.bufferViews&&(r.bufferViews=e.bufferViews.map((n,o)=>this._resolveBufferView(n,o))),e.images&&(r.images=e.images.map((n,o)=>this._resolveImage(n,o))),e.samplers&&(r.samplers=e.samplers.map((n,o)=>this._resolveSampler(n,o))),e.textures&&(r.textures=e.textures.map((n,o)=>this._resolveTexture(n,o))),e.accessors&&(r.accessors=e.accessors.map((n,o)=>this._resolveAccessor(n,o))),e.materials&&(r.materials=e.materials.map((n,o)=>this._resolveMaterial(n,o))),e.meshes&&(r.meshes=e.meshes.map((n,o)=>this._resolveMesh(n,o))),e.nodes&&(r.nodes=e.nodes.map((n,o)=>this._resolveNode(n,o)),r.nodes=r.nodes.map((n,o)=>this._resolveNodeChildren(n))),e.skins&&(r.skins=e.skins.map((n,o)=>this._resolveSkin(n,o))),e.scenes&&(r.scenes=e.scenes.map((n,o)=>this._resolveScene(n,o))),typeof this.json.scene=="number"&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;let r=e&&e[t];return r||console.warn(`glTF file error: Could not find ${e}[${t}]`),r}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(r=>this.getNode(r))}}_resolveNode(e,t){let r={...e,id:e?.id||`node-${t}`};return e.mesh!==void 0&&(r.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(r.camera=this.getCamera(e.camera)),e.skin!==void 0&&(r.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(r.mesh=e.meshes.reduce((n,o)=>{let i=this.getMesh(o);return n.id=i.id,n.primitives=n.primitives.concat(i.primitives),n},{primitives:[]})),r}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){let r=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:r}}_resolveMesh(e,t){let r={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(r.primitives=e.primitives.map(n=>{let o={...n,attributes:{},indices:void 0,material:void 0},i=n.attributes;for(let a in i)o.attributes[a]=this.getAccessor(i[a]);return n.indices!==void 0&&(o.indices=this.getAccessor(n.indices)),n.material!==void 0&&(o.material=this.getMaterial(n.material)),o})),r}_resolveMaterial(e,t){let r={...e,id:e.id||`material-${t}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};let n=r.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return r}_resolveAccessor(e,t){let r=Fp(e.componentType),n=Dp(e.type),o=r*n,i={...e,id:e.id||`accessor-${t}`,bytesPerComponent:r,components:n,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(i.bufferView=this.getBufferView(e.bufferView)),i.bufferView){let a=i.bufferView.buffer,{ArrayType:c,byteLength:u}=Nt(i,i.bufferView),l=(i.bufferView.byteOffset||0)+(i.byteOffset||0)+a.byteOffset,f=a.arrayBuffer.slice(l,l+u);i.bufferView.byteStride&&(f=this._getValueFromInterleavedBuffer(a,l,i.bufferView.byteStride,i.bytesPerElement,i.count)),i.value=new c(f)}return i}_getValueFromInterleavedBuffer(e,t,r,n,o){let i=new Uint8Array(o*n);for(let a=0;a<o;a++){let c=t+a*r;i.set(new Uint8Array(e.arrayBuffer.slice(c,c+n)),a*n)}return i.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Mp(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){let r={id:e.id||`sampler-${t}`,...e,parameters:{}};for(let n in r){let o=this._enumSamplerParameter(n);o!==void 0&&(r.parameters[o]=r[n])}return r}_enumSamplerParameter(e){return kp[e]}_resolveImage(e,t){let r={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[t];return n&&(r.image=n),r}_resolveBufferView(e,t){let r=e.buffer,n=this.buffers[r].arrayBuffer,o=this.buffers[r].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[r],data:new Uint8Array(n,o,e.byteLength)}}_resolveCamera(e,t){let r={...e,id:e.id||`camera-${t}`};return r.perspective,r.orthographic,r}};function Uo(s,e){return new Po().postProcess(s,e)}var vt={create(){},brand:"physicsWorld",dependencies:[],globalDependencies:[],init:async()=>{let s=(await import("./rapier-35QE4UIF.js")).default;return console.log(s,s.World),{world:new s.World({x:0,y:-9.81,z:0}),RAPIER:s}},fixedUpdate({state:s,instances:e}){s.world.step()},onDestroy(s){}};function Rp(s){let e=Math.sqrt(1-s.w*s.w);return{angle:2*Math.acos(s.w),axis:e===0?[1,0,0]:[s.x/e,s.y/e,s.z/e]}}var vn={brand:"rigidBody",dependencies:[Ee],globalDependencies:[vt],create(s,e,{physicsWorld:t}){return{body:t.state.world.createRigidBody(s)}},onDestroy(s,{physicsWorld:e}){e.state.world.removeRigidBody(s.body)},init:()=>{},fixedUpdate({state:s,instances:e}){for(let t of e){let r=t.data.body.translation(),n=t.data.body.rotation(),o=Rp(n);t.entity.transform.matrix=fe(he([r.x,r.y,r.z]),mr(o.axis,o.angle))}}},Qc={brand:"rigidBodyCollider",dependencies:[vn],globalDependencies:[vt],create(s,e,{physicsWorld:t},r){let n=r(vn);return{collider:t.state.world.createCollider(s,n.body)}},onDestroy(s,{physicsWorld:e}){e.state.world.removeCollider(s.collider,!1)},init:()=>{}};function qc(s,e){return{vertices:ze(s,e.vertices.buffer,GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX),indices:ze(s,e.indices.buffer,GPUBufferUsage.COPY_DST|GPUBufferUsage.INDEX),drawCount:e.drawCount}}function Gp(s,e,t,r){let n=r[1]*r[0],o=(r[1]-1)*(r[0]-1)*6,i=new Float32Array(n*3),a=new Uint32Array(o),[c,u]=e,[l,f]=t,h=(l-c)/(r[0]-1),y=(f-u)/(r[1]-1);for(let g=0;g<r[1];g++)for(let _=0;_<r[0];_++){let T=(g*r[0]+_)*3,d=c+h*_,C=u+y*g,E=s([d,C]);i[T]=E[0],i[T+1]=E[1],i[T+2]=E[2]}for(let g=0;g<r[1]-1;g++)for(let _=0;_<r[0]-1;_++){let T=(g*(r[0]-1)+_)*6,d=g*r[0]+_;a[T]=d,a[T+1]=d+1,a[T+2]=d+r[0],a[T+3]=d+1,a[T+5]=d+r[0],a[T+4]=d+r[0]+1}return console.log(o,n),{vertices:i,indices:a,drawCount:o}}function zc(s,e){return Gp(([t,r])=>{let n=Math.cos(t)*Math.cos(r)*s,o=Math.sin(t)*Math.cos(r)*s,i=Math.sin(r)*s;return[n,i,o]},[0,-Math.PI/2],[Math.PI*2,Math.PI/2],e)}var No=`struct LightingVertInput {\r
  @location(0) sample_pos: vec3f,\r
}\r
\r
struct LightingFragInput {\r
  @builtin(position) vertex_position : vec4f,\r
  @location(0) tex_pos: vec2f,\r
}\r
\r
struct LightingFragOutput {\r
  @location(0) color : vec4f,\r
}\r
\r
@group(0) @binding(0) var tex_sampler : sampler;\r
@group(0) @binding(1) var tex_pos : texture_2d<f32>;\r
@group(0) @binding(2) var tex_normal : texture_2d<f32>;\r
@group(0) @binding(3) var tex_albedo : texture_2d<f32>;\r
\r
struct Params {\r
  mvp: mat4x4f,\r
  inv_vp: mat4x4f,\r
  m: mat4x4f,\r
  light_pos: vec4f,\r
  light_color: vec3f,\r
  quadratic: f32,\r
  linear: f32,\r
  constant: f32,\r
  cutoff_radius: f32,\r
}\r
\r
@group(1) @binding(0) var<uniform> params : Params;\r
\r
@vertex\r
fn VSMain(input: LightingVertInput) -> LightingFragInput {\r
  var frag: LightingFragInput;\r
  var pos = params.mvp * vec4(input.sample_pos, 1.0);\r
  // var pos2 = params.vp * vec4(input.sample_pos, 1.0);\r
  frag.tex_pos = ((pos.xy ) / ((pos.w - 0.0) * 1.0)) * 0.5 + 0.5;\r
  frag.tex_pos.y = 1.0 - frag.tex_pos.y;\r
  frag.vertex_position = pos;\r
  return frag;\r
}\r
\r
@fragment\r
fn FSMain(input: LightingFragInput) -> LightingFragOutput {\r
  var o: LightingFragOutput;\r
  // _ = tex_pos;\r
  // _ = tex_albedo;\r
  // _ = tex_normal;\r
  let uv = input.vertex_position.xy / vec2f(textureDimensions(tex_pos).xy);\r
  let ipos = vec2i(input.vertex_position.xy);\r
\r
  let albedo = textureSample(tex_albedo, tex_sampler, uv);\r
  let pos = params.inv_vp * textureSample(tex_pos, tex_sampler, uv);\r
  let normal = textureSample(tex_normal, tex_sampler, uv);\r
\r
  let vec_to_light = (params.m * vec4f(0.0,0.0, 0.0, 1.0)).xyz - pos.xyz;\r
  let dist_to_light = length(vec_to_light);\r
  let dir_to_light = vec4f(vec_to_light / dist_to_light, 0.0).xyz;\r
\r
  let attenuation = \r
    params.quadratic * dist_to_light * dist_to_light\r
    + params.linear * dist_to_light\r
    + params.constant;\r
\r
  var brightness = 1.0 / attenuation + 0.3;\r
\r
  brightness = brightness * min(\r
    1.0, \r
    3.0 * (1.0 - dist_to_light / params.cutoff_radius)\r
  );\r
\r
  var brightness_factor = brightness * max(dot(\r
    normal.xyz,\r
    dir_to_light\r
  ), 0.0);\r
\r
  var dither_factor = (brightness_factor * 4.0);\r
\r
  var modulate_color = select(\r
    (ceil(dither_factor) - 1.0) / 4.0,  \r
    ceil(dither_factor) / 4.0,\r
    dither256(fract(dither_factor), ipos),\r
  );\r
\r
  o.color = (albedo * modulate_color);\r
\r
  o.color = max(o.color, vec4f(0.0));\r
\r
  o.color.a = 1.0;\r
\r
  o.color = pow(o.color, vec4(1 / 2.2));\r
\r
  // o.color = vec4f(dir_to_light.xyz * 0.5 + 0.5, 1.0);\r
  // o.color = vec4f(normal.xyz * 0.5 + 0.5, 1.0);\r
  // o.color = vec4f(max(dot(\r
  //  normal.xyz,\r
  //  dir_to_light\r
  // ), 0.0) * 1.0);\r
  \r
  // o.color.a = 1.0;\r
\r
  // o.color = vec4(1.0, 0.0, 0.0, 1.0);\r
\r
  return o;\r
} \r
\r
const DITHER256_THRESHOLDS = array<f32, 256>(\r
  0,\r
  128,\r
  32,\r
  160,\r
  8,\r
  136,\r
  40,\r
  168,\r
  2,\r
  130,\r
  34,\r
  162,\r
  10,\r
  138,\r
  42,\r
  170,\r
  192,\r
  64,\r
  224,\r
  96,\r
  200,\r
  72,\r
  232,\r
  104,\r
  194,\r
  66,\r
  226,\r
  98,\r
  202,\r
  74,\r
  234,\r
  106,\r
  48,\r
  176,\r
  16,\r
  144,\r
  56,\r
  184,\r
  24,\r
  152,\r
  50,\r
  178,\r
  18,\r
  146,\r
  58,\r
  186,\r
  26,\r
  154,\r
  240,\r
  112,\r
  208,\r
  80,\r
  248,\r
  120,\r
  216,\r
  88,\r
  242,\r
  114,\r
  210,\r
  82,\r
  250,\r
  122,\r
  218,\r
  90,\r
  12,\r
  140,\r
  44,\r
  172,\r
  4,\r
  132,\r
  36,\r
  164,\r
  14,\r
  142,\r
  46,\r
  174,\r
  6,\r
  134,\r
  38,\r
  166,\r
  204,\r
  76,\r
  236,\r
  108,\r
  196,\r
  68,\r
  228,\r
  100,\r
  206,\r
  78,\r
  238,\r
  110,\r
  198,\r
  70,\r
  230,\r
  102,\r
  60,\r
  188,\r
  28,\r
  156,\r
  52,\r
  180,\r
  20,\r
  148,\r
  62,\r
  190,\r
  30,\r
  158,\r
  54,\r
  182,\r
  22,\r
  150,\r
  252,\r
  124,\r
  220,\r
  92,\r
  244,\r
  116,\r
  212,\r
  84,\r
  254,\r
  126,\r
  222,\r
  94,\r
  246,\r
  118,\r
  214,\r
  86,\r
  3,\r
  131,\r
  35,\r
  163,\r
  11,\r
  139,\r
  43,\r
  171,\r
  1,\r
  129,\r
  33,\r
  161,\r
  9,\r
  137,\r
  41,\r
  169,\r
  195,\r
  67,\r
  227,\r
  99,\r
  203,\r
  75,\r
  235,\r
  107,\r
  193,\r
  65,\r
  225,\r
  97,\r
  201,\r
  73,\r
  233,\r
  105,\r
  51,\r
  179,\r
  19,\r
  147,\r
  59,\r
  187,\r
  27,\r
  155,\r
  49,\r
  177,\r
  17,\r
  145,\r
  57,\r
  185,\r
  25,\r
  153,\r
  243,\r
  115,\r
  211,\r
  83,\r
  251,\r
  123,\r
  219,\r
  91,\r
  241,\r
  113,\r
  209,\r
  81,\r
  249,\r
  121,\r
  217,\r
  89,\r
  15,\r
  143,\r
  47,\r
  175,\r
  7,\r
  135,\r
  39,\r
  167,\r
  13,\r
  141,\r
  45,\r
  173,\r
  5,\r
  133,\r
  37,\r
  165,\r
  207,\r
  79,\r
  239,\r
  111,\r
  199,\r
  71,\r
  231,\r
  103,\r
  205,\r
  77,\r
  237,\r
  109,\r
  197,\r
  69,\r
  229,\r
  101,\r
  63,\r
  191,\r
  31,\r
  159,\r
  55,\r
  183,\r
  23,\r
  151,\r
  61,\r
  189,\r
  29,\r
  157,\r
  53,\r
  181,\r
  21,\r
  149,\r
  255,\r
  127,\r
  223,\r
  95,\r
  247,\r
  119,\r
  215,\r
  87,\r
  253,\r
  125,\r
  221,\r
  93,\r
  245,\r
  117,\r
  213,\r
  85\r
);\r
\r
fn dither256(factor: f32, coord: vec2i) -> bool {\r
  let x = coord.x % 16;\r
  let y = coord.y % 16;\r
  let threshold = DITHER256_THRESHOLDS[y * 16 + x] / 256.0;\r
  return factor > threshold ;\r
}`;var Yc={bindGroups:[[{name:"tex_sampler",type:{name:"sampler",attributes:[{id:47824,line:14,name:"group",value:"0"},{id:47825,line:14,name:"binding",value:"0"}],size:0,format:null,access:null},group:0,binding:0,attributes:[{id:47824,line:14,name:"group",value:"0"},{id:47825,line:14,name:"binding",value:"0"}],resourceType:3,access:""},{name:"tex_pos",type:{name:"texture_2d",attributes:[{id:47828,line:15,name:"group",value:"0"},{id:47829,line:15,name:"binding",value:"1"}],size:0,format:{name:"f32",attributes:null,size:4},access:null},group:0,binding:1,attributes:[{id:47828,line:15,name:"group",value:"0"},{id:47829,line:15,name:"binding",value:"1"}],resourceType:2,access:"read"},{name:"tex_normal",type:{name:"texture_2d",attributes:[{id:47833,line:16,name:"group",value:"0"},{id:47834,line:16,name:"binding",value:"2"}],size:0,format:{name:"f32",attributes:null,size:4},access:null},group:0,binding:2,attributes:[{id:47833,line:16,name:"group",value:"0"},{id:47834,line:16,name:"binding",value:"2"}],resourceType:2,access:"read"},{name:"tex_albedo",type:{name:"texture_2d",attributes:[{id:47838,line:17,name:"group",value:"0"},{id:47839,line:17,name:"binding",value:"3"}],size:0,format:{name:"f32",attributes:null,size:4},access:null},group:0,binding:3,attributes:[{id:47838,line:17,name:"group",value:"0"},{id:47839,line:17,name:"binding",value:"3"}],resourceType:2,access:"read"}],[{name:"params",type:{name:"Params",attributes:null,size:240,members:[{name:"mvp",type:{name:"mat4x4f",attributes:null,size:64},attributes:null,offset:0,size:64},{name:"inv_vp",type:{name:"mat4x4f",attributes:null,size:64},attributes:null,offset:64,size:64},{name:"m",type:{name:"mat4x4f",attributes:null,size:64},attributes:null,offset:128,size:64},{name:"light_pos",type:{name:"vec4f",attributes:null,size:16},attributes:null,offset:192,size:16},{name:"light_color",type:{name:"vec3f",attributes:null,size:12},attributes:null,offset:208,size:12},{name:"quadratic",type:{name:"f32",attributes:null,size:4},attributes:null,offset:220,size:4},{name:"linear",type:{name:"f32",attributes:null,size:4},attributes:null,offset:224,size:4},{name:"constant",type:{name:"f32",attributes:null,size:4},attributes:null,offset:228,size:4},{name:"cutoff_radius",type:{name:"f32",attributes:null,size:4},attributes:null,offset:232,size:4}],align:16,startLine:19,endLine:29,inUse:!0},group:1,binding:0,attributes:[{id:47862,line:31,name:"group",value:"1"},{id:47863,line:31,name:"binding",value:"0"}],resourceType:0,access:"read"}]]};var V=$u(mu(),1);var pu=V.default.Matrix?V.default.Matrix:V.Matrix;var du=V.inverse;function gu(s){let e=new pu([s.slice(0,4),s.slice(4,8),s.slice(8,12),s.slice(12,16)]).transpose();return du(e).transpose().to1DArray()}var yu={async init(s){let{device:e,canvasFormat:t,onResize:r}=await s(q),n=e.createBindGroupLayout({entries:[{binding:0,sampler:{type:"non-filtering"},visibility:GPUShaderStage.FRAGMENT},{binding:1,texture:{sampleType:"unfilterable-float",viewDimension:"2d"},visibility:GPUShaderStage.FRAGMENT},{binding:2,texture:{sampleType:"unfilterable-float",viewDimension:"2d"},visibility:GPUShaderStage.FRAGMENT},{binding:3,texture:{sampleType:"float",viewDimension:"2d"},visibility:GPUShaderStage.FRAGMENT}]}),o=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),i=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[n,o]}),vertex:{module:e.createShaderModule({code:No}),buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:e.createShaderModule({code:No}),targets:[{format:"rgba8unorm",blend:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{operation:"add",srcFactor:"one",dstFactor:"zero"}}}]},primitive:{topology:"triangle-list",cullMode:"back"}}),c={pointLightGeometry:qc(e,zc(1,[12,12])),lightingPipeline:i,lightingBindGroupLayout:n,lightingUniformBindGroupLayout:o,lightingBindGroup:void 0};return await r(async()=>{let u=(await s(q)).textures.gbuffer;c.lightingBindGroup=e.createBindGroup({layout:n,entries:[{binding:0,resource:e.createSampler({minFilter:"nearest",magFilter:"nearest"})},{binding:1,resource:u.position},{binding:2,resource:u.normal},{binding:3,resource:u.albedo}]})}),c},create(s,e,{deferredWebgpuRenderer:t}){let{device:r}=t.state,n=r.createBuffer({label:"uniform buffer",size:1024,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),o=r.createBindGroup({label:"lighting uniform bind group",entries:[{binding:0,resource:n}],layout:e.state.lightingUniformBindGroupLayout});return{uniformBuffer:n,uniformBindGroup:o,color:s.color,quadratic:s.quadratic,linear:s.linear,constant:s.constant}},renderUpdate({state:s,instances:e,subsystem:t,scheduleTask:r}){r(()=>{let{projectionMatrix:n,viewMatrix:o,device:i,textures:a,ctx:c}=t(q).state,u=i.createCommandEncoder(),l=u.beginRenderPass({colorAttachments:[{view:a.lighting.color.createView({mipLevelCount:1}),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]});l.setBindGroup(0,s.lightingBindGroup);let f=5/256;for(let h of e){let y=(-h.data.linear+Math.sqrt(h.data.linear**2-4*h.data.quadratic*(h.data.constant-Math.max(...h.data.color)/f)))/(2*h.data.quadratic),g=fe(h.entity.transform.matrix,ki([y,y,y])),_=fe(n,o),T=fe(_,g),d=fs(T,[0,0,0,1]),C=st(Yc,1,0,{inv_vp:gu(_),mvp:T,m:g,light_color:h.data.color,light_pos:d,quadratic:h.data.quadratic,linear:h.data.linear,constant:h.data.constant,cutoff_radius:y});i.queue.writeBuffer(h.data.uniformBuffer,0,C),l.setBindGroup(1,h.data.uniformBindGroup),l.setPipeline(s.lightingPipeline),l.setVertexBuffer(0,s.pointLightGeometry.vertices),l.setIndexBuffer(s.pointLightGeometry.indices,"uint32"),l.drawIndexed(s.pointLightGeometry.drawCount)}return l.end(),i.queue.submit([u.finish()]),Promise.resolve()},[Hr],[hs])},dependencies:[Ee],globalDependencies:[q],brand:"pointLightSource",onDestroy(){}};var Yo=`struct GBufferVertInput {\r
  @location(0) pos: vec3f,\r
  @location(1) normal: vec3f,\r
  //  @location(2) uv: vec2f,\r
}\r
\r
struct GBufferFragInput {\r
  @builtin(position) vertex_position:  vec4f, \r
  @location(0) pos: vec4f,\r
  @location(1) normal: vec4f,\r
  @location(2) albedo: vec4f,\r
}\r
\r
struct GBufferFragOutput {\r
  @location(0) pos: vec4f,\r
  @location(1) normal: vec4f,\r
  @location(2) albedo: vec4f,\r
}\r
\r
struct Params {\r
  mvp: mat4x4f,\r
  m: mat4x4f,\r
  draw_color: vec4f\r
}\r
\r
@group(0) @binding(0) var<uniform> params : Params;\r
\r
@vertex\r
fn VSMain(input: GBufferVertInput) -> GBufferFragInput {\r
  var frag: GBufferFragInput;\r
  let clipspace = params.mvp * vec4f(input.pos, 1.0);\r
  frag.pos = params.mvp * vec4f(input.pos, 1.0);\r
  frag.vertex_position = clipspace;\r
  frag.normal = params.m * vec4f(input.normal, 0.0);\r
  frag.albedo = params.draw_color;\r
  return frag;\r
}\r
\r
const DITHER16_THRESHOLDS = array(\r
  0.0, 8.0, 2.0, 10.0,\r
  12.0, 4.0, 13.0, 6.0,\r
  3.0, 11.0, 1.0, 9.0,\r
  14.0, 7.0, 15.0, 5.0\r
);\r
\r
fn dither16(factor: f32, coord: vec2i) -> bool {\r
  let x = coord.x % 4;\r
  let y = coord.y % 4;\r
  let threshold = DITHER16_THRESHOLDS[y * 4 + x] / 16.0;\r
  return factor > threshold ;\r
}\r
\r
\r
/* \r
function makeDitherKernel(iters) {\r
	if (iters === 0) {\r
		return [0];\r
	}\r
\r
	const kernel = makeDitherKernel(iters - 1);\r
	const oldLength = kernel.length;\r
	const oldSideLength = Math.sqrt(oldLength);\r
	\r
	const newLength = kernel.length * 4;\r
	const newSideLength = Math.sqrt(newLength);\r
\r
	let k = new Array(newLength);\r
	\r
	for (const [x, y, idx] of [[0, 0,0], [1, 1, 1], [1, 0, 2], [0, 1, 3]]) {\r
		let baseIndex = y * newSideLength + x;\r
		for (let i = 0; i < oldSideLength; i++) {\r
			for (let j = 0; j < oldSideLength; j++) {\r
				k[baseIndex + i * 2 * newSideLength + j * 2] = \r
					kernel[i * oldSideLength + j] + idx * kernel.length\r
			}\r
		}\r
	}\r
\r
	return k;\r
	\r
}\r
\r
console.log(makeDitherKernel(4));\r
*/\r
\r
const DITHER256_THRESHOLDS = array<f32, 256>(\r
  0,\r
  128,\r
  32,\r
  160,\r
  8,\r
  136,\r
  40,\r
  168,\r
  2,\r
  130,\r
  34,\r
  162,\r
  10,\r
  138,\r
  42,\r
  170,\r
  192,\r
  64,\r
  224,\r
  96,\r
  200,\r
  72,\r
  232,\r
  104,\r
  194,\r
  66,\r
  226,\r
  98,\r
  202,\r
  74,\r
  234,\r
  106,\r
  48,\r
  176,\r
  16,\r
  144,\r
  56,\r
  184,\r
  24,\r
  152,\r
  50,\r
  178,\r
  18,\r
  146,\r
  58,\r
  186,\r
  26,\r
  154,\r
  240,\r
  112,\r
  208,\r
  80,\r
  248,\r
  120,\r
  216,\r
  88,\r
  242,\r
  114,\r
  210,\r
  82,\r
  250,\r
  122,\r
  218,\r
  90,\r
  12,\r
  140,\r
  44,\r
  172,\r
  4,\r
  132,\r
  36,\r
  164,\r
  14,\r
  142,\r
  46,\r
  174,\r
  6,\r
  134,\r
  38,\r
  166,\r
  204,\r
  76,\r
  236,\r
  108,\r
  196,\r
  68,\r
  228,\r
  100,\r
  206,\r
  78,\r
  238,\r
  110,\r
  198,\r
  70,\r
  230,\r
  102,\r
  60,\r
  188,\r
  28,\r
  156,\r
  52,\r
  180,\r
  20,\r
  148,\r
  62,\r
  190,\r
  30,\r
  158,\r
  54,\r
  182,\r
  22,\r
  150,\r
  252,\r
  124,\r
  220,\r
  92,\r
  244,\r
  116,\r
  212,\r
  84,\r
  254,\r
  126,\r
  222,\r
  94,\r
  246,\r
  118,\r
  214,\r
  86,\r
  3,\r
  131,\r
  35,\r
  163,\r
  11,\r
  139,\r
  43,\r
  171,\r
  1,\r
  129,\r
  33,\r
  161,\r
  9,\r
  137,\r
  41,\r
  169,\r
  195,\r
  67,\r
  227,\r
  99,\r
  203,\r
  75,\r
  235,\r
  107,\r
  193,\r
  65,\r
  225,\r
  97,\r
  201,\r
  73,\r
  233,\r
  105,\r
  51,\r
  179,\r
  19,\r
  147,\r
  59,\r
  187,\r
  27,\r
  155,\r
  49,\r
  177,\r
  17,\r
  145,\r
  57,\r
  185,\r
  25,\r
  153,\r
  243,\r
  115,\r
  211,\r
  83,\r
  251,\r
  123,\r
  219,\r
  91,\r
  241,\r
  113,\r
  209,\r
  81,\r
  249,\r
  121,\r
  217,\r
  89,\r
  15,\r
  143,\r
  47,\r
  175,\r
  7,\r
  135,\r
  39,\r
  167,\r
  13,\r
  141,\r
  45,\r
  173,\r
  5,\r
  133,\r
  37,\r
  165,\r
  207,\r
  79,\r
  239,\r
  111,\r
  199,\r
  71,\r
  231,\r
  103,\r
  205,\r
  77,\r
  237,\r
  109,\r
  197,\r
  69,\r
  229,\r
  101,\r
  63,\r
  191,\r
  31,\r
  159,\r
  55,\r
  183,\r
  23,\r
  151,\r
  61,\r
  189,\r
  29,\r
  157,\r
  53,\r
  181,\r
  21,\r
  149,\r
  255,\r
  127,\r
  223,\r
  95,\r
  247,\r
  119,\r
  215,\r
  87,\r
  253,\r
  125,\r
  221,\r
  93,\r
  245,\r
  117,\r
  213,\r
  85\r
);\r
\r
fn dither256(factor: f32, coord: vec2i) -> bool {\r
  let x = coord.x % 16;\r
  let y = coord.y % 16;\r
  let threshold = DITHER256_THRESHOLDS[y * 16 + x] / 256.0;\r
  return factor > threshold ;\r
}\r
\r
@fragment\r
fn FSMain(input: GBufferFragInput) -> GBufferFragOutput {\r
  var o: GBufferFragOutput;\r
\r
  let ipos = vec2i(input.vertex_position.xy);\r
  if (\r
    !dither256(input.pos.z * 0.5 - 0.5, ipos)\r
    // && (ipos.x + ipos.y) % 4 != 0\r
  ) {\r
    discard;\r
  }\r
\r
\r
  o.pos = input.pos;\r
  o.normal = input.normal;\r
  o.albedo = input.albedo;\r
  return o;\r
} `;var xu={bindGroups:[[{name:"params",type:{name:"Params",attributes:null,size:144,members:[{name:"mvp",type:{name:"mat4x4f",attributes:null,size:64},attributes:null,offset:0,size:64},{name:"m",type:{name:"mat4x4f",attributes:null,size:64},attributes:null,offset:64,size:64},{name:"draw_color",type:{name:"vec4f",attributes:null,size:16},attributes:null,offset:128,size:16}],align:16,startLine:20,endLine:24,inUse:!0},group:0,binding:0,attributes:[{id:47367,line:26,name:"group",value:"0"},{id:47368,line:26,name:"binding",value:"0"}],resourceType:0,access:"read"}]]};var bu={async init(s){let{device:e}=await s(q);return{gbufferPipeline:e.createRenderPipeline({layout:"auto",vertex:{module:e.createShaderModule({code:Yo}),buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]},{arrayStride:12,attributes:[{shaderLocation:1,offset:0,format:"float32x3"}]}]},fragment:{module:e.createShaderModule({code:Yo}),targets:[{format:"rgba32float"},{format:"rgba16float"},{format:"rgba8unorm"}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},primitive:{topology:"triangle-list",cullMode:"back"}})}},create(s,e,{deferredWebgpuRenderer:t}){let{device:r}=t.state,n=r.createBuffer({label:"uniform buffer",size:1024,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|GPUBufferUsage.UNIFORM});return{bindGroup:r.createBindGroup({layout:e.state.gbufferPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:n}]}),vertexBuffer:s.vertexBuffer,indexBuffer:s.indexBuffer,normalBuffer:s.normalBuffer,vertexCount:s.size,uniformBuffer:n,indexFormat:s.indexFormat,drawColor:s.drawColor}},renderUpdate({state:s,instances:e,subsystem:t,scheduleTask:r}){r(()=>{let{device:n,viewMatrix:o,projectionMatrix:i,textures:a,gBufferRenderPass:c}=t(q).state,{gbufferPipeline:u}=s,l=c;for(let f of e){let h=st(xu,0,0,{m:f.entity.transform.matrix,mvp:fe(i,fe(o,f.entity.transform.matrix)),draw_color:f.data.drawColor});n.queue.writeBuffer(f.data.uniformBuffer,0,h),l.setPipeline(u),l.setVertexBuffer(0,f.data.vertexBuffer),l.setVertexBuffer(1,f.data.normalBuffer),l.setIndexBuffer(f.data.indexBuffer,f.data.indexFormat),l.setBindGroup(0,f.data.bindGroup),l.drawIndexed(f.data.vertexCount)}return Promise.resolve()},[Rt])},onDestroy(){},dependencies:[Ee],globalDependencies:[q],brand:"sampleWebgpuRendererGeometry"};var Au=`struct ParticlesVertInput {\r
  @location(0) position: vec3f,\r
  @builtin(vertex_index) vindex : u32,\r
  //  @location(2) uv: vec2f,\r
}\r
\r
struct ParticlesFragInput {\r
  @builtin(position) vertex_position: vec4f, \r
  @location(0) pos: vec4f,\r
  @location(1) normal: vec4f,\r
  @location(2) albedo: vec4f,\r
}\r
\r
struct ParticlesFragOutput {\r
  @location(0) pos: vec4f,\r
  @location(1) normal: vec4f,\r
  @location(2) albedo: vec4f,\r
}\r
\r
struct Params {\r
  mvp: mat4x4f,\r
  draw_color: vec4f,\r
  scale: vec2f,\r
}\r
\r
@group(0) @binding(0) var<uniform> params : Params;\r
\r
@vertex\r
fn VSMain(input: ParticlesVertInput) -> ParticlesFragInput {\r
  var frag: ParticlesFragInput;\r
\r
  let center = params.mvp * vec4f(input.position, 1.0);\r
\r
  frag.normal = params.mvp * vec4f(0.0, 1.0, 0.0, 0.0);\r
  frag.albedo = params.draw_color;\r
\r
  frag.pos = vec4(array(\r
    vec2( 1.0,  1.0),\r
    vec2( 1.0, -1.0), \r
    vec2(-1.0, -1.0),\r
    vec2( 1.0,  1.0),\r
    vec2(-1.0, -1.0),\r
    vec2(-1.0,  1.0),\r
  )[input.vindex] * params.scale, 1.0, 1.0) + center;\r
\r
  frag.vertex_position = frag.pos;\r
\r
  /*\r
  frag.uv = array(\r
    vec2(1.0, 0.0),\r
    vec2(1.0, 1.0),\r
    vec2(0.0, 1.0),\r
    vec2(1.0, 0.0),\r
    vec2(0.0, 1.0),\r
    vec2(0.0, 0.0),\r
  )[input.vindex]; */\r
\r
  return frag;\r
}\r
\r
@fragment\r
fn FSMain(input: ParticlesFragInput) -> ParticlesFragOutput {\r
  var o: ParticlesFragOutput;\r
\r
  let ipos = vec2i(input.vertex_position.xy);\r
\r
  // if (\r
  //   input.pos.z < 10.0\r
  //   && (ipos.x + ipos.y) % 4 != 0\r
  // ) {\r
  //   discard;\r
  // }\r
\r
  o.pos = input.pos;\r
  o.normal = input.normal;\r
  o.albedo = input.albedo;\r
  return o;\r
} `;var wu={bindGroups:[[{name:"params",type:{name:"Params",attributes:null,size:96,members:[{name:"mvp",type:{name:"mat4x4f",attributes:null,size:64},attributes:null,offset:0,size:64},{name:"draw_color",type:{name:"vec4f",attributes:null,size:16},attributes:null,offset:64,size:16},{name:"scale",type:{name:"vec2f",attributes:null,size:8},attributes:null,offset:80,size:8}],align:16,startLine:20,endLine:24,inUse:!0},group:0,binding:0,attributes:[{id:47209,line:26,name:"group",value:"0"},{id:47210,line:26,name:"binding",value:"0"}],resourceType:0,access:"read"}]]};var Zo=`@group(0) @binding(0)\r
var<storage, read_write> buf_position: array<vec3f>;\r
\r
@group(0) @binding(1)\r
var<storage, read_write> buf_velocity: array<vec3f>;\r
\r
@group(0) @binding(2)\r
var tex_force: texture_storage_3d<rgba8snorm, read>;\r
\r
@compute @workgroup_size(64)\r
fn ComputeMain(\r
  @builtin(global_invocation_id) id3: vec3u\r
) {\r
  let i = id3.x;\r
\r
  let gridOffset = vec3i(16, 16 , 16);\r
\r
  let force_pos = (vec3i(floor(buf_position[i])) + gridOffset + vec3i(320, 320, 320)) % vec3i(32);\r
\r
  var vel = buf_velocity[i];\r
\r
  vel += textureLoad(tex_force, force_pos).xyz * 0.01;\r
  vel *= 0.99;\r
  buf_position[i] += vel;\r
  buf_velocity[i] = vel;\r
}`;var _u={async init(s){let{device:e}=await s(q);return{particlesForcefieldPipeline:e.createComputePipeline({layout:"auto",compute:{module:e.createShaderModule({code:Zo})}})}},create(s,e,{deferredWebgpuRenderer:t}){let{device:r}=t.state;return{bindGroup:r.createBindGroup({layout:e.state.particlesForcefieldPipeline.getBindGroupLayout(0),entries:[{resource:s.positionBuffer,binding:0},{resource:s.velocityBuffer,binding:1},{resource:s.forceFieldTexture,binding:2}]}),positionBuffer:s.positionBuffer,particleCount:s.count,velocityBuffer:s.velocityBuffer,forceFieldTexture:s.forceFieldTexture}},renderUpdate({state:s,instances:e,subsystem:t,scheduleTask:r}){r(()=>{let{device:n,viewMatrix:o,projectionMatrix:i,textures:a,gBufferRenderPass:c}=t(q).state,u=n.createCommandEncoder(),l=u.beginComputePass();l.setPipeline(s.particlesForcefieldPipeline);for(let f of e)l.setBindGroup(0,f.data.bindGroup),l.dispatchWorkgroups(Math.floor(f.data.particleCount/64));return l.end(),n.queue.submit([u.finish()]),Promise.resolve()},[Rt])},dependencies:[Ee],globalDependencies:[q],onDestroy(){},brand:"particleForcefield"},Bu={async init(s){let{device:e}=await s(q),t=e.createShaderModule({code:Au}),r={color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}},n=e.createRenderPipeline({layout:"auto",vertex:{module:t,buffers:[{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]}]},fragment:{module:t,targets:[{format:"rgba32float"},{format:"rgba16float"},{format:"rgba8unorm"}]},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},primitive:{topology:"triangle-list"}}),o=e.createComputePipeline({layout:"auto",compute:{module:e.createShaderModule({code:Zo})}});return{particlesPipeline:n,particlesForcefieldPipeline:o}},create(s,e,{deferredWebgpuRenderer:t}){let{device:r}=t.state,n=r.createBuffer({label:"uniform buffer",size:1024,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC|GPUBufferUsage.UNIFORM});return{bindGroup:r.createBindGroup({layout:e.state.particlesPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:n}]}),positionBuffer:s.positionBuffer,particleCount:s.count,uniformBuffer:n,drawColor:s.drawColor}},renderUpdate({state:s,instances:e,subsystem:t,scheduleTask:r}){r(()=>{let{device:n,viewMatrix:o,projectionMatrix:i,textures:a,gBufferRenderPass:c,aspect:u}=t(q).state,{particlesPipeline:l}=s,f=c;for(let h of e){let y=st(wu,0,0,{scale:[.03/u,.03],mvp:fe(i,fe(o,h.entity.transform.matrix)),draw_color:h.data.drawColor});n.queue.writeBuffer(h.data.uniformBuffer,0,y),f.setPipeline(l),f.setVertexBuffer(0,h.data.positionBuffer),f.setBindGroup(0,h.data.bindGroup),f.draw(6,h.data.particleCount)}return Promise.resolve()},[Rt])},dependencies:[Ee],globalDependencies:[q],onDestroy(){},brand:"particleSystem"};var vu=(s,e,t)=>({async create(r,n,o,i){},onDestroy(){},async init(r){let{device:n,canvas:o,onResize:i,ctx:a}=await r(q),c={global:await s({device:n,canvas:o,ctx:a}),resolutionDependent:void 0};return i(async()=>{c.resolutionDependent=await e({device:n,canvas:o,ctx:a},[o.width,o.height],c.global)}),c},globalDependencies:[q],dependencies:[],brand:"postprocessingPipeline",async renderUpdate({state:r,scheduleTask:n,subsystem:o}){n(async()=>{let{device:i,canvas:a,ctx:c,textures:u}=o(q).state;await t({device:i,canvas:a,ctx:c,position:u.gbuffer.position,normal:u.gbuffer.normal,albedo:u.gbuffer.albedo,lighting:u.lighting.color},[a.width,a.height],r.global,r.resolutionDependent)},[],[Hr])}});function Eu(s,e){return new RegExp(RegExp.escape(s)+"[\\s\\S]*?"+RegExp.escape(e),"g")}function Tu(s,e){for(let t of e)s=s.replaceAll(typeof t.delimiter=="string"?Eu(t.delimiter,t.delimiter):Eu(t.start,t.end),t.replaceWith);return s}var we=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}},Ln=class{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Ke=class extends we{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},Xe=class extends we{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}},Gr=class extends we{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}},rt=class extends we{constructor(e,t,r,n){super(e,r),this.format=t,this.access=n}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}},lt;(s=>{s[s.Uniform=0]="Uniform",s[s.Storage=1]="Storage",s[s.Texture=2]="Texture",s[s.Sampler=3]="Sampler",s[s.StorageTexture=4]="StorageTexture"})(lt||(lt={}));var nr=class{constructor(e,t,r,n,o,i,a){this.name=e,this.type=t,this.group=r,this.binding=n,this.attributes=o,this.resourceType=i,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},ri=class{constructor(e,t){this.name=e,this.type=t}},ni=class{constructor(e,t,r,n){this.name=e,this.type=t,this.locationType=r,this.location=n,this.interpolation=null}},On=class{constructor(e,t,r,n){this.name=e,this.type=t,this.locationType=r,this.location=n}},si=class{constructor(e,t,r,n){this.name=e,this.type=t,this.attributes=r,this.id=n}},oi=class{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}},ii=class{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}},ai=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}};function Gd(s){var e=(32768&s)>>15,t=(31744&s)>>10,r=1023&s;return t==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):t==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))}var ku=new Float32Array(1),Ld=new Int32Array(ku.buffer),pe=new Uint16Array(1);function Od(s){ku[0]=s;let e=Ld[0],t=e>>31&1,r=e>>23&255,n=8388607&e;if(r===255)return pe[0]=t<<15|31744|(n!==0?512:0),pe[0];if(r===0){if(n===0)return pe[0]=t<<15,pe[0];n|=8388608;let o=113;for(;!(8388608&n);)n<<=1,o--;return r=127-o,n&=8388607,r>0?(n=(n>>126-r)+(n>>127-r&1),pe[0]=t<<15|r<<10|n>>13,pe[0]):(pe[0]=t<<15,pe[0])}return r=r-127+15,r>=31?(pe[0]=t<<15|31744,pe[0]):r<=0?r<-10?(pe[0]=t<<15,pe[0]):(n=(8388608|n)>>1-r,pe[0]=t<<15|n>>13,pe[0]):(n>>=13,pe[0]=t<<15|r<<10|n,pe[0])}var _i=new Uint32Array(1),Su=new Float32Array(_i.buffer,0,1);function Iu(s){let e=112+(s>>6&31)<<23|(63&s)<<17;return _i[0]=e,Su[0]}function Pd(s,e,t,r,n,o,i,a,c){let u=r*(i>>=n)*(o>>=n)+t*i+e*a;switch(c){case"r8unorm":return[K(s,u,"8unorm",1)[0]];case"r8snorm":return[K(s,u,"8snorm",1)[0]];case"r8uint":return[K(s,u,"8uint",1)[0]];case"r8sint":return[K(s,u,"8sint",1)[0]];case"rg8unorm":{let l=K(s,u,"8unorm",2);return[l[0],l[1]]}case"rg8snorm":{let l=K(s,u,"8snorm",2);return[l[0],l[1]]}case"rg8uint":{let l=K(s,u,"8uint",2);return[l[0],l[1]]}case"rg8sint":{let l=K(s,u,"8sint",2);return[l[0],l[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let l=K(s,u,"8unorm",4);return[l[0],l[1],l[2],l[3]]}case"rgba8snorm":{let l=K(s,u,"8snorm",4);return[l[0],l[1],l[2],l[3]]}case"rgba8uint":{let l=K(s,u,"8uint",4);return[l[0],l[1],l[2],l[3]]}case"rgba8sint":{let l=K(s,u,"8sint",4);return[l[0],l[1],l[2],l[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let l=K(s,u,"8unorm",4);return[l[2],l[1],l[0],l[3]]}case"r16uint":return[K(s,u,"16uint",1)[0]];case"r16sint":return[K(s,u,"16sint",1)[0]];case"r16float":return[K(s,u,"16float",1)[0]];case"rg16uint":{let l=K(s,u,"16uint",2);return[l[0],l[1]]}case"rg16sint":{let l=K(s,u,"16sint",2);return[l[0],l[1]]}case"rg16float":{let l=K(s,u,"16float",2);return[l[0],l[1]]}case"rgba16uint":{let l=K(s,u,"16uint",4);return[l[0],l[1],l[2],l[3]]}case"rgba16sint":{let l=K(s,u,"16sint",4);return[l[0],l[1],l[2],l[3]]}case"rgba16float":{let l=K(s,u,"16float",4);return[l[0],l[1],l[2],l[3]]}case"r32uint":return[K(s,u,"32uint",1)[0]];case"r32sint":return[K(s,u,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[K(s,u,"32float",1)[0]];case"rg32uint":{let l=K(s,u,"32uint",2);return[l[0],l[1]]}case"rg32sint":{let l=K(s,u,"32sint",2);return[l[0],l[1]]}case"rg32float":{let l=K(s,u,"32float",2);return[l[0],l[1]]}case"rgba32uint":{let l=K(s,u,"32uint",4);return[l[0],l[1],l[2],l[3]]}case"rgba32sint":{let l=K(s,u,"32sint",4);return[l[0],l[1],l[2],l[3]]}case"rgba32float":{let l=K(s,u,"32float",4);return[l[0],l[1],l[2],l[3]]}case"rg11b10ufloat":{let l=new Uint32Array(s.buffer,u,1)[0],f=(4192256&l)>>11,h=(4290772992&l)>>22;return[Iu(2047&l),Iu(f),(function(y){let g=112+(y>>5&31)<<23|(31&y)<<18;return _i[0]=g,Su[0]})(h),1]}}return null}function K(s,e,t,r){let n=[0,0,0,0];for(let o=0;o<r;++o)switch(t){case"8unorm":n[o]=s[e]/255,e++;break;case"8snorm":n[o]=s[e]/255*2-1,e++;break;case"8uint":n[o]=s[e],e++;break;case"8sint":n[o]=s[e]-127,e++;break;case"16uint":n[o]=s[e]|s[e+1]<<8,e+=2;break;case"16sint":n[o]=(s[e]|s[e+1]<<8)-32768,e+=2;break;case"16float":n[o]=Gd(s[e]|s[e+1]<<8),e+=2;break;case"32uint":case"32sint":n[o]=s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24,e+=4;break;case"32float":n[o]=new Float32Array(s.buffer,e,1)[0],e+=4}return n}function X(s,e,t,r,n){for(let o=0;o<r;++o)switch(t){case"8unorm":s[e]=255*n[o],e++;break;case"8snorm":s[e]=.5*(n[o]+1)*255,e++;break;case"8uint":s[e]=n[o],e++;break;case"8sint":s[e]=n[o]+127,e++;break;case"16uint":new Uint16Array(s.buffer,e,1)[0]=n[o],e+=2;break;case"16sint":new Int16Array(s.buffer,e,1)[0]=n[o],e+=2;break;case"16float":{let i=Od(n[o]);new Uint16Array(s.buffer,e,1)[0]=i,e+=2;break}case"32uint":new Uint32Array(s.buffer,e,1)[0]=n[o],e+=4;break;case"32sint":new Int32Array(s.buffer,e,1)[0]=n[o],e+=4;break;case"32float":new Float32Array(s.buffer,e,1)[0]=n[o],e+=4}return n}var ei={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}},Ge=class s{constructor(){this.id=s._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(lr.instance);for(let r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(fr.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}};Ge._id=0;var lr=class extends Ge{};lr.instance=new lr;var fr=class extends Ge{};fr.instance=new fr;var Mu=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]),Y=class extends Ge{constructor(){super()}},St=class extends Y{constructor(e,t,r,n,o,i){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=n,this.startLine=o,this.endLine=i}get astNodeType(){return"function"}search(e){if(this.attributes)for(let t of this.attributes)e(t);e(this);for(let t of this.args)e(t);this.searchBlock(this.body,e)}},ci=class extends Y{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},Pn=class extends Y{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},Lr=class extends Y{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},Un=class extends Y{constructor(e,t,r,n){super(),this.init=e,this.condition=t,this.increment=r,this.body=n}get astNodeType(){return"for"}search(e){var t,r,n;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}},Ue=class extends Y{constructor(e,t,r,n,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=n,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},Or=class extends Y{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},It=class extends Y{constructor(e,t,r,n,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=n,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},ir=class extends Y{constructor(e,t,r,n,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=n,this.value=o}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},sr,Rr,v,A;(s=>{s.increment="++",s.decrement="--"})(sr||(sr={})),(s=>{s.parse=function(e){let t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return s[t]}})(sr||(sr={}));var Nn=class extends Y{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(s=>{s.assign="=",s.addAssign="+=",s.subtractAssin="-=",s.multiplyAssign="*=",s.divideAssign="/=",s.moduloAssign="%=",s.andAssign="&=",s.orAssign="|=",s.xorAssign="^=",s.shiftLeftAssign="<<=",s.shiftRightAssign=">>="})(Rr||(Rr={})),(s=>{s.parse=function(e){let t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Rr||(Rr={}));var Vn=class extends Y{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},Pr=class extends Y{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Mu.has(this.name)}search(e){for(let t of this.args)t.search(e);e(this)}},Jn=class extends Y{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}},Hn=class extends Y{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(let t of this.cases)t.search(e)}},jn=class extends Y{constructor(e,t,r,n){super(),this.condition=e,this.body=t,this.elseif=r,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},$n=class extends Y{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},ui=class extends Y{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},li=class extends Y{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},Wn=class extends Y{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}},Ur=class extends Y{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}},fi=class extends Y{constructor(){super()}get astNodeType(){return"discard"}},Kn=class extends Y{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},Xn=class extends Y{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},k=class s extends Y{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){let n=s._priority.get(t.name);s._priority.get(e[r].name)<n&&(t=e[r])}return t.name==="x32"?s.i32:t}getTypeName(){return this.name}};k.x32=new k("x32"),k.f32=new k("f32"),k.i32=new k("i32"),k.u32=new k("u32"),k.f16=new k("f16"),k.bool=new k("bool"),k.void=new k("void"),k._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var Qn=class extends k{constructor(e){super(e)}},Pe=class extends k{constructor(e,t,r,n){super(e),this.members=t,this.startLine=r,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(let t of this.members)e(t)}},B=class extends k{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};B.vec2f=new B("vec2",k.f32,null),B.vec3f=new B("vec3",k.f32,null),B.vec4f=new B("vec4",k.f32,null),B.vec2i=new B("vec2",k.i32,null),B.vec3i=new B("vec3",k.i32,null),B.vec4i=new B("vec4",k.i32,null),B.vec2u=new B("vec2",k.u32,null),B.vec3u=new B("vec3",k.u32,null),B.vec4u=new B("vec4",k.u32,null),B.vec2h=new B("vec2",k.f16,null),B.vec3h=new B("vec3",k.f16,null),B.vec4h=new B("vec4",k.f16,null),B.vec2b=new B("vec2",k.bool,null),B.vec3b=new B("vec3",k.bool,null),B.vec4b=new B("vec4",k.bool,null),B.mat2x2f=new B("mat2x2",k.f32,null),B.mat2x3f=new B("mat2x3",k.f32,null),B.mat2x4f=new B("mat2x4",k.f32,null),B.mat3x2f=new B("mat3x2",k.f32,null),B.mat3x3f=new B("mat3x3",k.f32,null),B.mat3x4f=new B("mat3x4",k.f32,null),B.mat4x2f=new B("mat4x2",k.f32,null),B.mat4x3f=new B("mat4x3",k.f32,null),B.mat4x4f=new B("mat4x4",k.f32,null),B.mat2x2h=new B("mat2x2",k.f16,null),B.mat2x3h=new B("mat2x3",k.f16,null),B.mat2x4h=new B("mat2x4",k.f16,null),B.mat3x2h=new B("mat3x2",k.f16,null),B.mat3x3h=new B("mat3x3",k.f16,null),B.mat3x4h=new B("mat3x4",k.f16,null),B.mat4x2h=new B("mat4x2",k.f16,null),B.mat4x3h=new B("mat4x3",k.f16,null),B.mat4x4h=new B("mat4x4",k.f16,null),B.mat2x2i=new B("mat2x2",k.i32,null),B.mat2x3i=new B("mat2x3",k.i32,null),B.mat2x4i=new B("mat2x4",k.i32,null),B.mat3x2i=new B("mat3x2",k.i32,null),B.mat3x3i=new B("mat3x3",k.i32,null),B.mat3x4i=new B("mat3x4",k.i32,null),B.mat4x2i=new B("mat4x2",k.i32,null),B.mat4x3i=new B("mat4x3",k.i32,null),B.mat4x4i=new B("mat4x4",k.i32,null),B.mat2x2u=new B("mat2x2",k.u32,null),B.mat2x3u=new B("mat2x3",k.u32,null),B.mat2x4u=new B("mat2x4",k.u32,null),B.mat3x2u=new B("mat3x2",k.u32,null),B.mat3x3u=new B("mat3x3",k.u32,null),B.mat3x4u=new B("mat3x4",k.u32,null),B.mat4x2u=new B("mat4x2",k.u32,null),B.mat4x3u=new B("mat4x3",k.u32,null),B.mat4x4u=new B("mat4x4",k.u32,null);var ar=class extends k{constructor(e,t,r,n){super(e),this.storage=t,this.type=r,this.access=n}get astNodeType(){return"pointer"}},Ct=class extends k{constructor(e,t,r,n){super(e),this.attributes=t,this.format=r,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}},Tt=class extends k{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}},Ce=class extends Ge{constructor(){super(),this.postfix=null}},nt=class extends Ce{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},Re=class extends Ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}},Nr=class extends Ce{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Mu.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(let t of this.args)t.search(e);e(this)}},xe=class extends Ce{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}},qn=class extends Ce{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){let r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}},re=class extends Ce{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof w}get isVector(){return this.value instanceof p||this.value instanceof P}get scalarValue(){return this.value instanceof w?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof p||this.value instanceof P?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},zn=class extends Ce{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}};var ht=class extends Ce{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},Yn=class extends Ce{constructor(){super()}},te=class extends Yn{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},Ie=class extends Yn{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?k.f32:e.name==="u32"||t.name==="u32"?k.u32:k.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},Zn=class extends Ge{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}},cr=class extends Ce{constructor(){super()}get astNodeType(){return"default"}},es=class extends Zn{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},ts=class extends Zn{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},rs=class extends Ge{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}},hi=class extends Ge{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},ns=class extends Ge{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}},ss=class extends Ge{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}},Le=class s{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=s._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,n){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}};Le._id=0;var Vr=class extends Le{constructor(){super(new we("void",null),null)}toString(){return"void"}};Vr.void=new Vr;var ft=class extends Le{constructor(e){super(new Gr("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,n){this.reference.setDataValue(e,t,r,n)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}},w=class s extends Le{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new s(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new s(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new s(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,n){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof s))return void console.error("SetDataValue: Invalid value",t);let o=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function Ud(s,e,t){let r=e.length;return r===2?t==="f32"?new p(new Float32Array(e),s.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new p(new Int32Array(e),s.getTypeInfo("vec2i")):t==="u32"?new p(new Uint32Array(e),s.getTypeInfo("vec2u")):t==="f16"?new p(new Float32Array(e),s.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new p(new Float32Array(e),s.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new p(new Int32Array(e),s.getTypeInfo("vec3i")):t==="u32"?new p(new Uint32Array(e),s.getTypeInfo("vec3u")):t==="f16"?new p(new Float32Array(e),s.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new p(new Float32Array(e),s.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new p(new Int32Array(e),s.getTypeInfo("vec4i")):t==="u32"?new p(new Uint32Array(e),s.getTypeInfo("vec4u")):t==="f16"?new p(new Float32Array(e),s.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}var p=class s extends Le{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{let n=this.typeInfo.name;n==="vec2f"||n==="vec3f"||n==="vec4f"?this.data=new Float32Array(e):n==="vec2i"||n==="vec3i"||n==="vec4i"?this.data=new Int32Array(e):n==="vec2u"||n==="vec3u"||n==="vec4u"?this.data=new Uint32Array(e):n==="vec2h"||n==="vec3h"||n==="vec4h"?this.data=new Float32Array(e):n==="vec2b"||n==="vec3b"||n==="vec4b"?this.data=new Int32Array(e):n==="vec2"||n==="vec3"||n==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${n}`)}}clone(){if(this.data instanceof Float32Array)return new s(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new s(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new s(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,n){r instanceof nt?console.error("TODO: Set vector postfix"):t instanceof s?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let n=e.getTypeInfo("f32");if(this.typeInfo instanceof rt)n=this.typeInfo.format||n;else{let i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?n=e.getTypeInfo("f32"):i==="vec2i"||i==="vec3i"||i==="vec4i"?n=e.getTypeInfo("i32"):i==="vec2b"||i==="vec3b"||i==="vec4b"?n=e.getTypeInfo("bool"):i==="vec2u"||i==="vec3u"||i==="vec4u"?n=e.getTypeInfo("u32"):i==="vec2h"||i==="vec3h"||i==="vec4h"?n=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${i}`)}let o=this;for(;t!==null&&o!==null;){if(t instanceof ht){let i=t.index,a=-1;if(i instanceof re){if(!(i.value instanceof w))return console.error(`GetSubData: Invalid array index ${i.value}`),null;a=i.value.value}else{let c=e.evalExpression(i,r);if(!(c instanceof w))return console.error("GetSubData: Unknown index type",i),null;a=c.value}if(a<0||a>=o.data.length)return console.error("GetSubData: Index out of range",a),null;if(o.data instanceof Float32Array){let c=new Float32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new w(c,n)}if(o.data instanceof Int32Array){let c=new Int32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new w(c,n)}if(o.data instanceof Uint32Array){let c=new Uint32Array(o.data.buffer,o.data.byteOffset+4*a,1);return new w(c,n)}throw"GetSubData: Invalid data type"}if(!(t instanceof nt))return console.error("GetSubData: Unknown postfix",t),null;{let i=t.value.toLowerCase();if(i.length===1){let c=0;if(i==="x"||i==="r")c=0;else if(i==="y"||i==="g")c=1;else if(i==="z"||i==="b")c=2;else{if(i!=="w"&&i!=="a")return console.error(`GetSubData: Unknown member ${i}`),null;c=3}if(this.data instanceof Float32Array){let u=new Float32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new w(u,n,this)}if(this.data instanceof Int32Array){let u=new Int32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new w(u,n,this)}if(this.data instanceof Uint32Array){let u=new Uint32Array(this.data.buffer,this.data.byteOffset+4*c,1);return new w(u,n,this)}}let a=[];for(let c of i)c==="x"||c==="r"?a.push(this.data[0]):c==="y"||c==="g"?a.push(this.data[1]):c==="z"||c==="b"?a.push(this.data[2]):c==="w"||c==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${c}`);o=Ud(e,a,n.name)}t=t.postfix}return o}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},P=class s extends Le{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new s(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,n){r instanceof nt?console.error("TODO: Set matrix postfix"):t instanceof s?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let n=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof rt)this.typeInfo.format;else if(n.endsWith("f"))e.getTypeInfo("f32");else if(n.endsWith("i"))e.getTypeInfo("i32");else if(n.endsWith("u"))e.getTypeInfo("u32");else{if(!n.endsWith("h"))return console.error(`GetDataValue: Unknown type ${n}`),null;e.getTypeInfo("f16")}if(t instanceof ht){let o=t.index,i=-1;if(o instanceof re){if(!(o.value instanceof w))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;i=o.value.value}else{let u=e.evalExpression(o,r);if(!(u instanceof w))return console.error("GetDataValue: Unknown index type",o),null;i=u.value}if(i<0||i>=this.data.length)return console.error("GetDataValue: Index out of range",i),null;let a=n.endsWith("h")?"h":"f",c;if(n==="mat2x2"||n==="mat2x2f"||n==="mat2x2h"||n==="mat3x2"||n==="mat3x2f"||n==="mat3x2h"||n==="mat4x2"||n==="mat4x2f"||n==="mat4x2h")c=new p(new Float32Array(this.data.buffer,this.data.byteOffset+2*i*4,2),e.getTypeInfo(`vec2${a}`));else if(n==="mat2x3"||n==="mat2x3f"||n==="mat2x3h"||n==="mat3x3"||n==="mat3x3f"||n==="mat3x3h"||n==="mat4x3"||n==="mat4x3f"||n==="mat4x3h")c=new p(new Float32Array(this.data.buffer,this.data.byteOffset+3*i*4,3),e.getTypeInfo(`vec3${a}`));else{if(n!=="mat2x4"&&n!=="mat2x4f"&&n!=="mat2x4h"&&n!=="mat3x4"&&n!=="mat3x4f"&&n!=="mat3x4h"&&n!=="mat4x4"&&n!=="mat4x4f"&&n!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${n}`),null;c=new p(new Float32Array(this.data.buffer,this.data.byteOffset+4*i*4,4),e.getTypeInfo(`vec4${a}`))}return t.postfix?c.getSubData(e,t.postfix,r):c}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},ne=class s extends Le{constructor(e,t,r=0,n=null){super(t,n),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){let e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new s(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,n){if(t===null)return void console.log("setDataValue: NULL data.");let o=this.offset,i=this.typeInfo;for(;r;){if(r instanceof ht)if(i instanceof Xe){let a=r.index;if(a instanceof re){if(!(a.value instanceof w))return void console.error(`SetDataValue: Invalid index type ${a.value}`);o+=a.value.value*i.stride}else{let c=e.evalExpression(a,n);if(!(c instanceof w))return void console.error("SetDataValue: Unknown index type",a);o+=c.value*i.stride}i=i.format}else console.error(`SetDataValue: Type ${i.getTypeName()} is not an array`);else{if(!(r instanceof nt))return void console.error("SetDataValue: Unknown postfix type",r);{let a=r.value;if(i instanceof Ke){let c=!1;for(let u of i.members)if(u.name===a){o+=u.offset,i=u.type,c=!0;break}if(!c)return void console.error(`SetDataValue: Member ${a} not found`)}else if(i instanceof we){let c=i.getTypeName(),u=0;if(a==="x"||a==="r")u=0;else if(a==="y"||a==="g")u=1;else if(a==="z"||a==="b")u=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);u=3}if(!(t instanceof w))return void console.error("SetDataValue: Invalid value",t);let l=t.value;return c==="vec2f"?void(new Float32Array(this.buffer,o,2)[u]=l):c==="vec3f"?void(new Float32Array(this.buffer,o,3)[u]=l):c==="vec4f"?void(new Float32Array(this.buffer,o,4)[u]=l):c==="vec2i"?void(new Int32Array(this.buffer,o,2)[u]=l):c==="vec3i"?void(new Int32Array(this.buffer,o,3)[u]=l):c==="vec4i"?void(new Int32Array(this.buffer,o,4)[u]=l):c==="vec2u"?void(new Uint32Array(this.buffer,o,2)[u]=l):c==="vec3u"?void(new Uint32Array(this.buffer,o,3)[u]=l):c==="vec4u"?void(new Uint32Array(this.buffer,o,4)[u]=l):void console.error(`SetDataValue: Type ${c} is not a struct`)}}}r=r.postfix}this.setData(e,t,i,o,n)}setData(e,t,r,n,o){let i=r.getTypeName();if(i!=="f32"&&i!=="f16")if(i!=="i32"&&i!=="atomic<i32>"&&i!=="x32")if(i!=="u32"&&i!=="atomic<u32>")if(i!=="bool"){if(i==="vec2f"||i==="vec2h"){let a=new Float32Array(this.buffer,n,2);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(i==="vec3f"||i==="vec3h"){let a=new Float32Array(this.buffer,n,3);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(i==="vec4f"||i==="vec4h"){let a=new Float32Array(this.buffer,n,4);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(i==="vec2i"){let a=new Int32Array(this.buffer,n,2);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(i==="vec3i"){let a=new Int32Array(this.buffer,n,3);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(i==="vec4i"){let a=new Int32Array(this.buffer,n,4);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(i==="vec2u"){let a=new Uint32Array(this.buffer,n,2);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(i==="vec3u"){let a=new Uint32Array(this.buffer,n,3);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(i==="vec4u"){let a=new Uint32Array(this.buffer,n,4);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(i==="vec2b"){let a=new Uint32Array(this.buffer,n,2);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1]):(a[0]=t[0],a[1]=t[1]))}if(i==="vec3b"){let a=new Uint32Array(this.buffer,n,3);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2]):(a[0]=t[0],a[1]=t[1],a[2]=t[2]))}if(i==="vec4b"){let a=new Uint32Array(this.buffer,n,4);return void(t instanceof p?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(i==="mat2x2f"||i==="mat2x2h"){let a=new Float32Array(this.buffer,n,4);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]))}if(i==="mat2x3f"||i==="mat2x3h"){let a=new Float32Array(this.buffer,n,6);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(i==="mat2x4f"||i==="mat2x4h"){let a=new Float32Array(this.buffer,n,8);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(i==="mat3x2f"||i==="mat3x2h"){let a=new Float32Array(this.buffer,n,6);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5]))}if(i==="mat3x3f"||i==="mat3x3h"){let a=new Float32Array(this.buffer,n,9);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8]))}if(i==="mat3x4f"||i==="mat3x4h"){let a=new Float32Array(this.buffer,n,12);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(i==="mat4x2f"||i==="mat4x2h"){let a=new Float32Array(this.buffer,n,8);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7]))}if(i==="mat4x3f"||i==="mat4x3h"){let a=new Float32Array(this.buffer,n,12);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11]))}if(i==="mat4x4f"||i==="mat4x4h"){let a=new Float32Array(this.buffer,n,16);return void(t instanceof P?(a[0]=t.data[0],a[1]=t.data[1],a[2]=t.data[2],a[3]=t.data[3],a[4]=t.data[4],a[5]=t.data[5],a[6]=t.data[6],a[7]=t.data[7],a[8]=t.data[8],a[9]=t.data[9],a[10]=t.data[10],a[11]=t.data[11],a[12]=t.data[12],a[13]=t.data[13],a[14]=t.data[14],a[15]=t.data[15]):(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]))}if(t instanceof s){if(r===t.typeInfo)return void new Uint8Array(this.buffer,n,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",i,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${i}`)}else t instanceof w&&(new Int32Array(this.buffer,n,1)[0]=t.value);else t instanceof w&&(new Uint32Array(this.buffer,n,1)[0]=t.value);else t instanceof w&&(new Int32Array(this.buffer,n,1)[0]=t.value);else t instanceof w&&(new Float32Array(this.buffer,n,1)[0]=t.value)}getSubData(e,t,r){var n,o,i;if(t===null)return this;let a=this.offset,c=this.typeInfo;for(;t;){if(t instanceof ht){let l=t.index,f=l instanceof Ce?e.evalExpression(l,r):l,h=0;if(f instanceof w?h=f.value:typeof f=="number"?h=f:console.error("GetDataValue: Invalid index type",l),c instanceof Xe)a+=h*c.stride,c=c.format;else{let y=c.getTypeName();y==="mat4x4"||y==="mat4x4f"||y==="mat4x4h"?(a+=16*h,c=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${c.getTypeName()} is not an array`)}}else{if(!(t instanceof nt))return console.error("GetDataValue: Unknown postfix type",t),null;{let l=t.value;if(c instanceof Ke){let f=!1;for(let h of c.members)if(h.name===l){a+=h.offset,c=h.type,f=!0;break}if(!f)return console.error(`GetDataValue: Member ${l} not found`),null}else if(c instanceof we){let f=c.getTypeName();if(f==="vec2f"||f==="vec3f"||f==="vec4f"||f==="vec2i"||f==="vec3i"||f==="vec4i"||f==="vec2u"||f==="vec3u"||f==="vec4u"||f==="vec2b"||f==="vec3b"||f==="vec4b"||f==="vec2h"||f==="vec3h"||f==="vec4h"||f==="vec2"||f==="vec3"||f==="vec4"){if(l.length>0&&l.length<5){let h="f",y=[];for(let g=0;g<l.length;++g){let _=l[g].toLowerCase(),T=0;if(_==="x"||_==="r")T=0;else if(_==="y"||_==="g")T=1;else if(_==="z"||_==="b")T=2;else{if(_!=="w"&&_!=="a")return console.error(`Unknown member ${l}`),null;T=3}if(l.length===1){if(f.endsWith("f"))return this.buffer.byteLength<a+4*T+4?(console.log("Insufficient buffer data"),null):new w(new Float32Array(this.buffer,a+4*T,1),e.getTypeInfo("f32"),this);if(f.endsWith("h"))return new w(new Float32Array(this.buffer,a+4*T,1),e.getTypeInfo("f16"),this);if(f.endsWith("i"))return new w(new Int32Array(this.buffer,a+4*T,1),e.getTypeInfo("i32"),this);if(f.endsWith("b"))return new w(new Int32Array(this.buffer,a+4*T,1),e.getTypeInfo("bool"),this);if(f.endsWith("u"))return new w(new Uint32Array(this.buffer,a+4*T,1),e.getTypeInfo("i32"),this)}if(f==="vec2f")y.push(new Float32Array(this.buffer,a,2)[T]);else if(f==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let d=new Float32Array(this.buffer,a,3);y.push(d[T])}else if(f==="vec4f")y.push(new Float32Array(this.buffer,a,4)[T]);else if(f==="vec2i")h="i",y.push(new Int32Array(this.buffer,a,2)[T]);else if(f==="vec3i")h="i",y.push(new Int32Array(this.buffer,a,3)[T]);else if(f==="vec4i")h="i",y.push(new Int32Array(this.buffer,a,4)[T]);else if(f==="vec2u"){h="u";let d=new Uint32Array(this.buffer,a,2);y.push(d[T])}else f==="vec3u"?(h="u",y.push(new Uint32Array(this.buffer,a,3)[T])):f==="vec4u"&&(h="u",y.push(new Uint32Array(this.buffer,a,4)[T]))}return y.length===2?c=e.getTypeInfo(`vec2${h}`):y.length===3?c=e.getTypeInfo(`vec3${h}`):y.length===4?c=e.getTypeInfo(`vec4${h}`):console.error(`GetDataValue: Invalid vector length ${y.length}`),new p(y,c,null)}return console.error(`GetDataValue: Unknown member ${l}`),null}return console.error(`GetDataValue: Type ${f} is not a struct`),null}}}t=t.postfix}let u=c.getTypeName();return u==="f32"?new w(new Float32Array(this.buffer,a,1),c,this):u==="i32"?new w(new Int32Array(this.buffer,a,1),c,this):u==="u32"?new w(new Uint32Array(this.buffer,a,1),c,this):u==="vec2f"?new p(new Float32Array(this.buffer,a,2),c,this):u==="vec3f"?new p(new Float32Array(this.buffer,a,3),c,this):u==="vec4f"?new p(new Float32Array(this.buffer,a,4),c,this):u==="vec2i"?new p(new Int32Array(this.buffer,a,2),c,this):u==="vec3i"?new p(new Int32Array(this.buffer,a,3),c,this):u==="vec4i"?new p(new Int32Array(this.buffer,a,4),c,this):u==="vec2u"?new p(new Uint32Array(this.buffer,a,2),c,this):u==="vec3u"?new p(new Uint32Array(this.buffer,a,3),c,this):u==="vec4u"?new p(new Uint32Array(this.buffer,a,4),c,this):c instanceof rt&&c.name==="atomic"?((n=c.format)===null||n===void 0?void 0:n.name)==="u32"?new w(new Uint32Array(this.buffer,a,1)[0],c.format,this):((o=c.format)===null||o===void 0?void 0:o.name)==="i32"?new w(new Int32Array(this.buffer,a,1)[0],c.format,this):(console.error(`GetDataValue: Invalid atomic format ${(i=c.format)===null||i===void 0?void 0:i.name}`),null):new s(this.buffer,c,a,this)}toString(){let e="";if(this.typeInfo instanceof Xe)if(this.typeInfo.format.name==="f32"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){let t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){let t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Ke?e+="{...}":e="[...]";return e}},tt=class s extends Le{constructor(e,t,r,n){super(t,null),this.data=e,this.descriptor=r,this.view=n}clone(){return new s(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;let r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){let e=this.format,t=ei[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=this.format,t=ei[e];return!!t&&t.isDepthStencil}getGpuSize(){let e=this.format,t=ei[e],r=this.width;if(!e||r<=0||!t)return-1;let n=this.height,o=this.depthOrArrayLayers,i=this.dimension;return r/t.blockWidth*(i==="1d"?1:n/t.blockHeight)*t.bytesPerBlock*o}getPixel(e,t,r=0,n=0){let o=this.texelByteSize,i=this.bytesPerRow,a=this.height,c=this.data[n];return Pd(new Uint8Array(c),e,t,r,n,a,i,o,this.format)}setPixel(e,t,r,n,o){let i=this.texelByteSize,a=this.bytesPerRow,c=this.height,u=this.data[n];(function(l,f,h,y,g,_,T,d,C,E){let I=y*(T>>=g)*(_>>=g)+h*T+f*d;switch(C){case"r8unorm":return void X(l,I,"8unorm",1,E);case"r8snorm":return void X(l,I,"8snorm",1,E);case"r8uint":return void X(l,I,"8uint",1,E);case"r8sint":return void X(l,I,"8sint",1,E);case"rg8unorm":return void X(l,I,"8unorm",2,E);case"rg8snorm":return void X(l,I,"8snorm",2,E);case"rg8uint":return void X(l,I,"8uint",2,E);case"rg8sint":return void X(l,I,"8sint",2,E);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void X(l,I,"8unorm",4,E);case"rgba8snorm":return void X(l,I,"8snorm",4,E);case"rgba8uint":return void X(l,I,"8uint",4,E);case"rgba8sint":return void X(l,I,"8sint",4,E);case"r16uint":return void X(l,I,"16uint",1,E);case"r16sint":return void X(l,I,"16sint",1,E);case"r16float":return void X(l,I,"16float",1,E);case"rg16uint":return void X(l,I,"16uint",2,E);case"rg16sint":return void X(l,I,"16sint",2,E);case"rg16float":return void X(l,I,"16float",2,E);case"rgba16uint":return void X(l,I,"16uint",4,E);case"rgba16sint":return void X(l,I,"16sint",4,E);case"rgba16float":return void X(l,I,"16float",4,E);case"r32uint":return void X(l,I,"32uint",1,E);case"r32sint":return void X(l,I,"32sint",1,E);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void X(l,I,"32float",1,E);case"rg32uint":return void X(l,I,"32uint",2,E);case"rg32sint":return void X(l,I,"32sint",2,E);case"rg32float":return void X(l,I,"32float",2,E);case"rgba32uint":return void X(l,I,"32uint",4,E);case"rgba32sint":return void X(l,I,"32sint",4,E);case"rgba32float":return void X(l,I,"32float",4,E);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(u),e,t,r,n,c,a,i,this.format,o)}};(s=>{s[s.token=0]="token",s[s.keyword=1]="keyword",s[s.reserved=2]="reserved"})(A||(A={}));var b=class{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}},m=class{};v=m,m.none=new b("",A.reserved,""),m.eof=new b("EOF",A.token,""),m.reserved={asm:new b("asm",A.reserved,"asm"),bf16:new b("bf16",A.reserved,"bf16"),do:new b("do",A.reserved,"do"),enum:new b("enum",A.reserved,"enum"),f16:new b("f16",A.reserved,"f16"),f64:new b("f64",A.reserved,"f64"),handle:new b("handle",A.reserved,"handle"),i8:new b("i8",A.reserved,"i8"),i16:new b("i16",A.reserved,"i16"),i64:new b("i64",A.reserved,"i64"),mat:new b("mat",A.reserved,"mat"),premerge:new b("premerge",A.reserved,"premerge"),regardless:new b("regardless",A.reserved,"regardless"),typedef:new b("typedef",A.reserved,"typedef"),u8:new b("u8",A.reserved,"u8"),u16:new b("u16",A.reserved,"u16"),u64:new b("u64",A.reserved,"u64"),unless:new b("unless",A.reserved,"unless"),using:new b("using",A.reserved,"using"),vec:new b("vec",A.reserved,"vec"),void:new b("void",A.reserved,"void")},m.keywords={array:new b("array",A.keyword,"array"),atomic:new b("atomic",A.keyword,"atomic"),bool:new b("bool",A.keyword,"bool"),f32:new b("f32",A.keyword,"f32"),i32:new b("i32",A.keyword,"i32"),mat2x2:new b("mat2x2",A.keyword,"mat2x2"),mat2x3:new b("mat2x3",A.keyword,"mat2x3"),mat2x4:new b("mat2x4",A.keyword,"mat2x4"),mat3x2:new b("mat3x2",A.keyword,"mat3x2"),mat3x3:new b("mat3x3",A.keyword,"mat3x3"),mat3x4:new b("mat3x4",A.keyword,"mat3x4"),mat4x2:new b("mat4x2",A.keyword,"mat4x2"),mat4x3:new b("mat4x3",A.keyword,"mat4x3"),mat4x4:new b("mat4x4",A.keyword,"mat4x4"),ptr:new b("ptr",A.keyword,"ptr"),sampler:new b("sampler",A.keyword,"sampler"),sampler_comparison:new b("sampler_comparison",A.keyword,"sampler_comparison"),struct:new b("struct",A.keyword,"struct"),texture_1d:new b("texture_1d",A.keyword,"texture_1d"),texture_2d:new b("texture_2d",A.keyword,"texture_2d"),texture_2d_array:new b("texture_2d_array",A.keyword,"texture_2d_array"),texture_3d:new b("texture_3d",A.keyword,"texture_3d"),texture_cube:new b("texture_cube",A.keyword,"texture_cube"),texture_cube_array:new b("texture_cube_array",A.keyword,"texture_cube_array"),texture_multisampled_2d:new b("texture_multisampled_2d",A.keyword,"texture_multisampled_2d"),texture_storage_1d:new b("texture_storage_1d",A.keyword,"texture_storage_1d"),texture_storage_2d:new b("texture_storage_2d",A.keyword,"texture_storage_2d"),texture_storage_2d_array:new b("texture_storage_2d_array",A.keyword,"texture_storage_2d_array"),texture_storage_3d:new b("texture_storage_3d",A.keyword,"texture_storage_3d"),texture_depth_2d:new b("texture_depth_2d",A.keyword,"texture_depth_2d"),texture_depth_2d_array:new b("texture_depth_2d_array",A.keyword,"texture_depth_2d_array"),texture_depth_cube:new b("texture_depth_cube",A.keyword,"texture_depth_cube"),texture_depth_cube_array:new b("texture_depth_cube_array",A.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new b("texture_depth_multisampled_2d",A.keyword,"texture_depth_multisampled_2d"),texture_external:new b("texture_external",A.keyword,"texture_external"),u32:new b("u32",A.keyword,"u32"),vec2:new b("vec2",A.keyword,"vec2"),vec3:new b("vec3",A.keyword,"vec3"),vec4:new b("vec4",A.keyword,"vec4"),bitcast:new b("bitcast",A.keyword,"bitcast"),block:new b("block",A.keyword,"block"),break:new b("break",A.keyword,"break"),case:new b("case",A.keyword,"case"),continue:new b("continue",A.keyword,"continue"),continuing:new b("continuing",A.keyword,"continuing"),default:new b("default",A.keyword,"default"),diagnostic:new b("diagnostic",A.keyword,"diagnostic"),discard:new b("discard",A.keyword,"discard"),else:new b("else",A.keyword,"else"),enable:new b("enable",A.keyword,"enable"),fallthrough:new b("fallthrough",A.keyword,"fallthrough"),false:new b("false",A.keyword,"false"),fn:new b("fn",A.keyword,"fn"),for:new b("for",A.keyword,"for"),function:new b("function",A.keyword,"function"),if:new b("if",A.keyword,"if"),let:new b("let",A.keyword,"let"),const:new b("const",A.keyword,"const"),loop:new b("loop",A.keyword,"loop"),while:new b("while",A.keyword,"while"),private:new b("private",A.keyword,"private"),read:new b("read",A.keyword,"read"),read_write:new b("read_write",A.keyword,"read_write"),return:new b("return",A.keyword,"return"),requires:new b("requires",A.keyword,"requires"),storage:new b("storage",A.keyword,"storage"),switch:new b("switch",A.keyword,"switch"),true:new b("true",A.keyword,"true"),alias:new b("alias",A.keyword,"alias"),type:new b("type",A.keyword,"type"),uniform:new b("uniform",A.keyword,"uniform"),var:new b("var",A.keyword,"var"),override:new b("override",A.keyword,"override"),workgroup:new b("workgroup",A.keyword,"workgroup"),write:new b("write",A.keyword,"write"),r8unorm:new b("r8unorm",A.keyword,"r8unorm"),r8snorm:new b("r8snorm",A.keyword,"r8snorm"),r8uint:new b("r8uint",A.keyword,"r8uint"),r8sint:new b("r8sint",A.keyword,"r8sint"),r16uint:new b("r16uint",A.keyword,"r16uint"),r16sint:new b("r16sint",A.keyword,"r16sint"),r16float:new b("r16float",A.keyword,"r16float"),rg8unorm:new b("rg8unorm",A.keyword,"rg8unorm"),rg8snorm:new b("rg8snorm",A.keyword,"rg8snorm"),rg8uint:new b("rg8uint",A.keyword,"rg8uint"),rg8sint:new b("rg8sint",A.keyword,"rg8sint"),r32uint:new b("r32uint",A.keyword,"r32uint"),r32sint:new b("r32sint",A.keyword,"r32sint"),r32float:new b("r32float",A.keyword,"r32float"),rg16uint:new b("rg16uint",A.keyword,"rg16uint"),rg16sint:new b("rg16sint",A.keyword,"rg16sint"),rg16float:new b("rg16float",A.keyword,"rg16float"),rgba8unorm:new b("rgba8unorm",A.keyword,"rgba8unorm"),rgba8unorm_srgb:new b("rgba8unorm_srgb",A.keyword,"rgba8unorm_srgb"),rgba8snorm:new b("rgba8snorm",A.keyword,"rgba8snorm"),rgba8uint:new b("rgba8uint",A.keyword,"rgba8uint"),rgba8sint:new b("rgba8sint",A.keyword,"rgba8sint"),bgra8unorm:new b("bgra8unorm",A.keyword,"bgra8unorm"),bgra8unorm_srgb:new b("bgra8unorm_srgb",A.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new b("rgb10a2unorm",A.keyword,"rgb10a2unorm"),rg11b10float:new b("rg11b10float",A.keyword,"rg11b10float"),rg32uint:new b("rg32uint",A.keyword,"rg32uint"),rg32sint:new b("rg32sint",A.keyword,"rg32sint"),rg32float:new b("rg32float",A.keyword,"rg32float"),rgba16uint:new b("rgba16uint",A.keyword,"rgba16uint"),rgba16sint:new b("rgba16sint",A.keyword,"rgba16sint"),rgba16float:new b("rgba16float",A.keyword,"rgba16float"),rgba32uint:new b("rgba32uint",A.keyword,"rgba32uint"),rgba32sint:new b("rgba32sint",A.keyword,"rgba32sint"),rgba32float:new b("rgba32float",A.keyword,"rgba32float"),static_assert:new b("static_assert",A.keyword,"static_assert")},m.tokens={decimal_float_literal:new b("decimal_float_literal",A.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new b("hex_float_literal",A.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new b("int_literal",A.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new b("uint_literal",A.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new b("name",A.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new b("ident",A.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new b("and",A.token,"&"),and_and:new b("and_and",A.token,"&&"),arrow:new b("arrow ",A.token,"->"),attr:new b("attr",A.token,"@"),forward_slash:new b("forward_slash",A.token,"/"),bang:new b("bang",A.token,"!"),bracket_left:new b("bracket_left",A.token,"["),bracket_right:new b("bracket_right",A.token,"]"),brace_left:new b("brace_left",A.token,"{"),brace_right:new b("brace_right",A.token,"}"),colon:new b("colon",A.token,":"),comma:new b("comma",A.token,","),equal:new b("equal",A.token,"="),equal_equal:new b("equal_equal",A.token,"=="),not_equal:new b("not_equal",A.token,"!="),greater_than:new b("greater_than",A.token,">"),greater_than_equal:new b("greater_than_equal",A.token,">="),shift_right:new b("shift_right",A.token,">>"),less_than:new b("less_than",A.token,"<"),less_than_equal:new b("less_than_equal",A.token,"<="),shift_left:new b("shift_left",A.token,"<<"),modulo:new b("modulo",A.token,"%"),minus:new b("minus",A.token,"-"),minus_minus:new b("minus_minus",A.token,"--"),period:new b("period",A.token,"."),plus:new b("plus",A.token,"+"),plus_plus:new b("plus_plus",A.token,"++"),or:new b("or",A.token,"|"),or_or:new b("or_or",A.token,"||"),paren_left:new b("paren_left",A.token,"("),paren_right:new b("paren_right",A.token,")"),semicolon:new b("semicolon",A.token,";"),star:new b("star",A.token,"*"),tilde:new b("tilde",A.token,"~"),underscore:new b("underscore",A.token,"_"),xor:new b("xor",A.token,"^"),plus_equal:new b("plus_equal",A.token,"+="),minus_equal:new b("minus_equal",A.token,"-="),times_equal:new b("times_equal",A.token,"*="),division_equal:new b("division_equal",A.token,"/="),modulo_equal:new b("modulo_equal",A.token,"%="),and_equal:new b("and_equal",A.token,"&="),or_equal:new b("or_equal",A.token,"|="),xor_equal:new b("xor_equal",A.token,"^="),shift_right_equal:new b("shift_right_equal",A.token,">>="),shift_left_equal:new b("shift_left_equal",A.token,"<<=")},m.simpleTokens={"@":v.tokens.attr,"{":v.tokens.brace_left,"}":v.tokens.brace_right,":":v.tokens.colon,",":v.tokens.comma,"(":v.tokens.paren_left,")":v.tokens.paren_right,";":v.tokens.semicolon},m.literalTokens={"&":v.tokens.and,"&&":v.tokens.and_and,"->":v.tokens.arrow,"/":v.tokens.forward_slash,"!":v.tokens.bang,"[":v.tokens.bracket_left,"]":v.tokens.bracket_right,"=":v.tokens.equal,"==":v.tokens.equal_equal,"!=":v.tokens.not_equal,">":v.tokens.greater_than,">=":v.tokens.greater_than_equal,">>":v.tokens.shift_right,"<":v.tokens.less_than,"<=":v.tokens.less_than_equal,"<<":v.tokens.shift_left,"%":v.tokens.modulo,"-":v.tokens.minus,"--":v.tokens.minus_minus,".":v.tokens.period,"+":v.tokens.plus,"++":v.tokens.plus_plus,"|":v.tokens.or,"||":v.tokens.or_or,"*":v.tokens.star,"~":v.tokens.tilde,_:v.tokens.underscore,"^":v.tokens.xor,"+=":v.tokens.plus_equal,"-=":v.tokens.minus_equal,"*=":v.tokens.times_equal,"/=":v.tokens.division_equal,"%=":v.tokens.modulo_equal,"&=":v.tokens.and_equal,"|=":v.tokens.or_equal,"^=":v.tokens.xor_equal,">>=":v.tokens.shift_right_equal,"<<=":v.tokens.shift_left_equal},m.regexTokens={decimal_float_literal:v.tokens.decimal_float_literal,hex_float_literal:v.tokens.hex_float_literal,int_literal:v.tokens.int_literal,uint_literal:v.tokens.uint_literal,ident:v.tokens.ident},m.storage_class=[v.keywords.function,v.keywords.private,v.keywords.workgroup,v.keywords.uniform,v.keywords.storage],m.access_mode=[v.keywords.read,v.keywords.write,v.keywords.read_write],m.sampler_type=[v.keywords.sampler,v.keywords.sampler_comparison],m.sampled_texture_type=[v.keywords.texture_1d,v.keywords.texture_2d,v.keywords.texture_2d_array,v.keywords.texture_3d,v.keywords.texture_cube,v.keywords.texture_cube_array],m.multisampled_texture_type=[v.keywords.texture_multisampled_2d],m.storage_texture_type=[v.keywords.texture_storage_1d,v.keywords.texture_storage_2d,v.keywords.texture_storage_2d_array,v.keywords.texture_storage_3d],m.depth_texture_type=[v.keywords.texture_depth_2d,v.keywords.texture_depth_2d_array,v.keywords.texture_depth_cube,v.keywords.texture_depth_cube_array,v.keywords.texture_depth_multisampled_2d],m.texture_external_type=[v.keywords.texture_external],m.any_texture_type=[...v.sampled_texture_type,...v.multisampled_texture_type,...v.storage_texture_type,...v.depth_texture_type,...v.texture_external_type],m.texel_format=[v.keywords.r8unorm,v.keywords.r8snorm,v.keywords.r8uint,v.keywords.r8sint,v.keywords.r16uint,v.keywords.r16sint,v.keywords.r16float,v.keywords.rg8unorm,v.keywords.rg8snorm,v.keywords.rg8uint,v.keywords.rg8sint,v.keywords.r32uint,v.keywords.r32sint,v.keywords.r32float,v.keywords.rg16uint,v.keywords.rg16sint,v.keywords.rg16float,v.keywords.rgba8unorm,v.keywords.rgba8unorm_srgb,v.keywords.rgba8snorm,v.keywords.rgba8uint,v.keywords.rgba8sint,v.keywords.bgra8unorm,v.keywords.bgra8unorm_srgb,v.keywords.rgb10a2unorm,v.keywords.rg11b10float,v.keywords.rg32uint,v.keywords.rg32sint,v.keywords.rg32float,v.keywords.rgba16uint,v.keywords.rgba16sint,v.keywords.rgba16float,v.keywords.rgba32uint,v.keywords.rgba32sint,v.keywords.rgba32float],m.const_literal=[v.tokens.int_literal,v.tokens.uint_literal,v.tokens.decimal_float_literal,v.tokens.hex_float_literal,v.keywords.true,v.keywords.false],m.literal_or_ident=[v.tokens.ident,v.tokens.int_literal,v.tokens.uint_literal,v.tokens.decimal_float_literal,v.tokens.hex_float_literal,v.tokens.name],m.element_count_expression=[v.tokens.int_literal,v.tokens.uint_literal,v.tokens.ident],m.template_types=[v.keywords.vec2,v.keywords.vec3,v.keywords.vec4,v.keywords.mat2x2,v.keywords.mat2x3,v.keywords.mat2x4,v.keywords.mat3x2,v.keywords.mat3x3,v.keywords.mat3x4,v.keywords.mat4x2,v.keywords.mat4x3,v.keywords.mat4x4,v.keywords.atomic,v.keywords.bitcast,...v.any_texture_type],m.attribute_name=[v.tokens.ident,v.keywords.block,v.keywords.diagnostic],m.assignment_operators=[v.tokens.equal,v.tokens.plus_equal,v.tokens.minus_equal,v.tokens.times_equal,v.tokens.division_equal,v.tokens.modulo_equal,v.tokens.and_equal,v.tokens.or_equal,v.tokens.xor_equal,v.tokens.shift_right_equal,v.tokens.shift_left_equal],m.increment_operators=[v.tokens.plus_plus,v.tokens.minus_minus];var os=class{constructor(e,t,r,n,o){this.type=e,this.lexeme=t,this.line=r,this.start=n,this.end=o}toString(){return this.lexeme}isTemplateType(){return m.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==m.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},mi=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new os(m.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let i=1;for(;i>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),i--,i==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),i++)}return!0}}let t=m.simpleTokens[e];if(t)return this._addToken(t),!0;let r=m.none,n=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let i=this._peekAhead();for(;this._isAlphaNumeric(i);)e+=this._advance(),i=this._peekAhead()}if(n){let i=m.keywords[e];if(i)return this._addToken(i),!0}if(n||o)return this._addToken(m.tokens.ident),!0;for(;;){let i=this._findType(e),a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(m.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(m.tokens.minus_minus),!0;let c=this._tokens.length-1;if((m.literal_or_ident.indexOf(this._tokens[c].type)!=-1||this._tokens[c].type==m.tokens.paren_right)&&a!=">")return this._addToken(i),!0}if(e==">"&&(a==">"||a=="=")){let c=!1,u=this._tokens.length-1;for(let l=0;l<5&&u>=0&&m.assignment_operators.indexOf(this._tokens[u].type)===-1;++l,--u)if(this._tokens[u].type===m.tokens.less_than){u>0&&this._tokens[u-1].isArrayOrTemplateType()&&(c=!0);break}if(c)return this._addToken(i),!0}if(i===m.none){let c=e,u=0,l=2;for(let f=0;f<l;++f)if(c+=this._peekAhead(f),i=this._findType(c),i!==m.none){u=f;break}if(i===m.none)return r!==m.none&&(this._current--,this._addToken(r),!0);e=c,this._current+=u+1}if(r=i,this._isAtEnd())break;e+=this._advance()}return r!==m.none&&(this._addToken(r),!0)}_findType(e){for(let r in m.regexTokens){let n=m.regexTokens[r];if(this._match(e,n.rule))return n}return m.literalTokens[e]||m.none}_match(e,t){let r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let t=this._source.substring(this._start,this._current);this._tokens.push(new os(e,t,this._line,this._start,this._current))}};function D(s){return Array.isArray(s)||s?.buffer instanceof ArrayBuffer}var is=new Float32Array(1),Nd=new Uint32Array(is.buffer),Vd=new Uint32Array(is.buffer),as=new Int32Array(1),Jd=new Float32Array(as.buffer),Hd=new Uint32Array(as.buffer),cs=new Uint32Array(1),jd=new Float32Array(cs.buffer),$d=new Int32Array(cs.buffer);function Cu(s,e,t){if(e===t)return s;if(e==="f32"){if(t==="i32"||t==="x32")return is[0]=s,Nd[0];if(t==="u32")return is[0]=s,Vd[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return as[0]=s,Jd[0];if(t==="u32")return as[0]=s,Hd[0]}else if(e==="u32"){if(t==="f32")return cs[0]=s,jd[0];if(t==="i32"||t==="x32")return cs[0]=s,$d[0]}return console.error(`Unsupported cast from ${e} to ${t}`),s}var pi=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},or=class{constructor(e,t){this.align=e,this.size=t}},kt=class s{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new ai,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(let t of e)t instanceof St&&this._functions.set(t.name,new pi(t));for(let t of e)if(t instanceof Pe){let r=this.getTypeInfo(t,null);r instanceof Ke&&this.structs.push(r)}for(let t of e)if(t instanceof Ur)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Or){let r=t,n=this._getAttributeNum(r.attributes,"id",0),o=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new si(r.name,o,r.attributes,n));continue}if(this._isUniformVar(t)){let r=t,n=this._getAttributeNum(r.attributes,"group",0),o=this._getAttributeNum(r.attributes,"binding",0),i=this.getTypeInfo(r.type,r.attributes),a=new nr(r.name,i,n,o,r.attributes,lt.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(t)){let r=t,n=this._getAttributeNum(r.attributes,"group",0),o=this._getAttributeNum(r.attributes,"binding",0),i=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(i),c=new nr(r.name,i,n,o,r.attributes,a?lt.StorageTexture:lt.Storage,r.access);c.access||(c.access="read"),this.storage.push(c);continue}if(this._isTextureVar(t)){let r=t,n=this._getAttributeNum(r.attributes,"group",0),o=this._getAttributeNum(r.attributes,"binding",0),i=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(i),c=new nr(r.name,i,n,o,r.attributes,a?lt.StorageTexture:lt.Texture,r.access);c.access||(c.access="read"),a?this.storage.push(c):this.textures.push(c);continue}if(this._isSamplerVar(t)){let r=t,n=this._getAttributeNum(r.attributes,"group",0),o=this._getAttributeNum(r.attributes,"binding",0),i=this.getTypeInfo(r.type,r.attributes),a=new nr(r.name,i,n,o,r.attributes,lt.Sampler,r.access);this.samplers.push(a);continue}}for(let t of e)if(t instanceof St){let r=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),o=this._getAttribute(t,"compute"),i=r||n||o,a=new ii(t.name,i?.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,i&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!i),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[i.name].push(a)),a.arguments=t.args.map(c=>new oi(c.name,this.getTypeInfo(c.type,c.attributes),c.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(let t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(let t of this._functions.values())t.node.search(r=>{var n,o,i;if(r instanceof ss){if(r.value)if(D(r.value))for(let a of r.value)for(let c of this.overrides)a===c.name&&((n=t.info)===null||n===void 0||n.overrides.push(c));else for(let a of this.overrides)r.value===a.name&&((o=t.info)===null||o===void 0||o.overrides.push(a))}else if(r instanceof xe)for(let a of this.overrides)r.name===a.name&&((i=t.info)===null||i===void 0||i.overrides.push(a))});for(let t of this.uniforms)this._markStructsInUse(t.type);for(let t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(let t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(let t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(let t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(let n of e.calls){let o=(r=this._functions.get(n.name))===null||r===void 0?void 0:r.info;o&&t.add(o)}}findResource(e,t,r){if(r){for(let n of this.entry.compute)if(n.name===r){for(let o of n.resources)if(o.group==e&&o.binding==t)return o}for(let n of this.entry.vertex)if(n.name===r){for(let o of n.resources)if(o.group==e&&o.binding==t)return o}for(let n of this.entry.fragment)if(n.name===r){for(let o of n.resources)if(o.group==e&&o.binding==t)return o}}for(let n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(let n of this.storage)if(n.group==e&&n.binding==t)return n;for(let n of this.textures)if(n.group==e&&n.binding==t)return n;for(let n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(let t of this.uniforms)if(t.name==e)return t;for(let t of this.storage)if(t.name==e)return t;for(let t of this.textures)if(t.name==e)return t;for(let t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){let t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){let r=[],n=this,o=[];return e.search(i=>{if(i instanceof lr)o.push({});else if(i instanceof fr)o.pop();else if(i instanceof Ue){let a=i;t&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(i instanceof Re){let a=i;t&&a.type!==null&&this._markStructsFromAST(a.type)}else if(i instanceof It){let a=i;t&&a.type!==null&&this._markStructsFromAST(a.type),o.length>0&&(o[o.length-1][a.name]=a)}else if(i instanceof xe){let a=i;if(o.length>0&&o[o.length-1][a.name])return;let c=n._findResource(a.name);c&&r.push(c)}else if(i instanceof Nr){let a=i,c=n._functions.get(a.name);c&&(t&&(c.inUse=!0),e.calls.add(c.node),c.resources===null&&(c.resources=n._findResources(c.node,t)),r.push(...c.resources))}else if(i instanceof Pr){let a=i,c=n._functions.get(a.name);c&&(t&&(c.inUse=!0),e.calls.add(c.node),c.resources===null&&(c.resources=n._findResources(c.node,t)),r.push(...c.resources))}}),[...new Map(r.map(i=>[i.name,i])).values()]}getBindGroups(){let e=[];function t(r,n){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),n>=e[r].length&&(e[r].length=n+1)}for(let r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(let r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Pe)this._getStructOutputs(e,t);else{let r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(let r of e.members)if(r.type instanceof Pe)this._getStructOutputs(r.type,t);else{let n=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(n!==null){let o=this.getTypeInfo(r.type,r.type.attributes),i=this._parseInt(n.value),a=new On(r.name,o,n.name,i);t.push(a)}}}_getOutputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){let r=this.getTypeInfo(e,e.attributes),n=this._parseInt(t.value);return new On("",r,t.name,n)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(let r of e)if(r.type instanceof Pe)this._getStructInputs(r.type,t);else{let n=this._getInputInfo(r);n!==null&&t.push(n)}return t}_getStructInputs(e,t){for(let r of e.members)if(r.type instanceof Pe)this._getStructInputs(r.type,t);else{let n=this._getInputInfo(r);n!==null&&t.push(n)}}_getInputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){let r=this._getAttribute(e,"interpolation"),n=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),i=new ni(e.name,n,t.name,o);return r!==null&&(i.interpolation=this._parseString(r.value)),i}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(let t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ri(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let t of this.structs)if(t.name==e)return t;for(let t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof ar){let n=e.type?this.getTypeInfo(e.type,e.attributes):null,o=new Gr(e.name,n,t);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ct){let n=e,o=n.format?this.getTypeInfo(n.format,n.attributes):null,i=new Xe(n.name,t);return i.format=o,i.count=n.count,this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Pe){let n=e,o=new Ke(n.name,t);o.startLine=n.startLine,o.endLine=n.endLine;for(let i of n.members){let a=this.getTypeInfo(i.type,i.attributes);o.members.push(new Ln(i.name,a,i.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Tt){let n=e,o=n.format instanceof k,i=n.format?o?this.getTypeInfo(n.format,null):new we(n.format,null):null,a=new rt(n.name,i,t,n.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof B){let n=e,o=n.format?this.getTypeInfo(n.format,null):null,i=new rt(n.name,o,t,n.access);return this._types.set(e,i),this._updateTypeInfo(i),i}let r=new we(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,n;let o=this._getTypeSize(e);if(e.size=(t=o?.size)!==null&&t!==void 0?t:0,e instanceof Xe&&e.format){let i=this._getTypeSize(e.format);e.stride=Math.max((r=i?.size)!==null&&r!==void 0?r:0,(n=i?.align)!==null&&n!==void 0?n:0),this._updateTypeInfo(e.format)}e instanceof Gr&&this._updateTypeInfo(e.format),e instanceof Ke&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,n=0,o=0,i=0;for(let a=0,c=e.members.length;a<c;++a){let u=e.members[a],l=this._getTypeSize(u);if(!l)continue;(t=this._getAlias(u.type.name))!==null&&t!==void 0||u.type;let f=l.align,h=l.size;r=this._roundUp(f,r+n),n=h,o=r,i=Math.max(i,f),u.offset=r,u.size=h,this._updateTypeInfo(u.type)}e.size=this._roundUp(i,o+n),e.align=i}_getTypeSize(e){var t,r;if(e==null)return null;let n=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ln&&(e=e.type),e instanceof we){let i=this._getAlias(e.name);i!==null&&(e=i)}{let i=s._typeInfo[e.name];if(i!==void 0){let a=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new or(Math.max(o,i.align/a),Math.max(n,i.size/a))}}{let i=s._typeInfo[e.name.substring(0,e.name.length-1)];if(i){let a=e.name[e.name.length-1]==="h"?2:1;return new or(Math.max(o,i.align/a),Math.max(n,i.size/a))}}if(e instanceof Xe){let i=e,a=8,c=8,u=this._getTypeSize(i.format);return u!==null&&(c=u.size,a=u.align),c=i.count*this._getAttributeNum((r=e?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,c)),n&&(c=n),new or(Math.max(o,a),Math.max(n,c))}if(e instanceof Ke){let i=0,a=0,c=0,u=0,l=0;for(let f of e.members){let h=this._getTypeSize(f.type);h!==null&&(i=Math.max(h.align,i),c=this._roundUp(h.align,c+u),u=h.size,l=c)}return a=this._roundUp(i,l+u),new or(Math.max(o,i),Math.max(n,a))}return null}_isUniformVar(e){return e instanceof Ue&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ue&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ue&&e.type!==null&&s._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ue&&e.type!==null&&s._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){let r=e;if(!r||!r.attributes)return null;let n=r.attributes;for(let o of n)if(o.name==t)return o;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let n of e)if(n.name==t){let o=n!==null&&n.value!==null?n.value:r;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}};kt._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},kt._textureTypes=m.any_texture_type.map(s=>s.name),kt._samplerTypes=m.sampler_type.map(s=>s.name);var Bi=0,di=class s{constructor(e,t,r){this.id=Bi++,this.name=e,this.value=t,this.node=r}clone(){return new s(this.name,this.value,this.node)}},gi=class s{constructor(e){this.id=Bi++,this.name=e.name,this.node=e}clone(){return new s(this.node)}},yi=class s{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Bi++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new di(e,t,r??null))}setVariable(e,t,r){let n=this.getVariable(e);n!==null?n.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;let r=this.getVariable(e);return(t=r?.value)!==null&&t!==void 0?t:null}clone(){return new s(this)}},xi=class{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}},bi=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){let r=this.exec.evalExpression(e.args[0],t),n=!0;if(r instanceof p)return r.data.forEach(o=>{o||(n=!1)}),new w(n?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p){let n=r.data.some(o=>o);return new w(n?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){let r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof w))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.evalExpression(r,t);if(n instanceof ne&&n.typeInfo.size===0){let o=n.typeInfo,i=n.buffer.byteLength/o.stride;return new w(i,this.getTypeInfo("u32"))}return new w(n.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.abs(o)),r.typeInfo);let n=r;return new w(Math.abs(n.value),n.typeInfo)}Acos(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.acos(o)),r.typeInfo);let n=r;return new w(Math.acos(n.value),r.typeInfo)}Acosh(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.acosh(o)),r.typeInfo);let n=r;return new w(Math.acosh(n.value),r.typeInfo)}Asin(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.asin(o)),r.typeInfo);let n=r;return new w(Math.asin(n.value),r.typeInfo)}Asinh(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.asinh(o)),r.typeInfo);let n=r;return new w(Math.asinh(n.value),r.typeInfo)}Atan(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.atan(o)),r.typeInfo);let n=r;return new w(Math.atan(n.value),r.typeInfo)}Atanh(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.atanh(o)),r.typeInfo);let n=r;return new w(Math.atanh(n.value),r.typeInfo)}Atan2(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p)return new p(r.data.map((a,c)=>Math.atan2(a,n.data[c])),r.typeInfo);let o=r,i=n;return new w(Math.atan2(o.value,i.value),r.typeInfo)}Ceil(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.ceil(o)),r.typeInfo);let n=r;return new w(Math.ceil(n.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(r instanceof p&&n instanceof p&&o instanceof p)return new p(r.data.map((u,l)=>this._clamp(u,n.data[l],o.data[l])),r.typeInfo);let i=r,a=n,c=o;return new w(this._clamp(i.value,a.value,c.value),r.typeInfo)}Cos(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.cos(o)),r.typeInfo);let n=r;return new w(Math.cos(n.value),r.typeInfo)}Cosh(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.cosh(o)),r.typeInfo);let n=r;return new w(Math.cos(n.value),r.typeInfo)}CountLeadingZeros(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.clz32(o)),r.typeInfo);let n=r;return new w(Math.clz32(n.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>this._countOneBits(o)),r.typeInfo);let n=r;return new w(this._countOneBits(n.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>this._countTrailingZeros(o)),r.typeInfo);let n=r;return new w(this._countTrailingZeros(n.value),r.typeInfo)}Cross(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p){if(r.data.length!==3||n.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let o=r.data,i=n.data;return new p([o[1]*i[2]-i[1]*o[2],o[2]*i[0]-i[2]*o[0],o[0]*i[1]-i[0]*o[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){let r=this.exec.evalExpression(e.args[0],t),n=180/Math.PI;return r instanceof p?new p(r.data.map(o=>o*n),r.typeInfo):new w(r.value*n,this.getTypeInfo("f32"))}Determinant(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof P){let n=r.data,o=r.typeInfo.getTypeName(),i=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new w(n[0]*n[3]-n[1]*n[2],i);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new w(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),i);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new w(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),i);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p){let a=0;for(let c=0;c<r.data.length;++c)a+=(r.data[c]-n.data[c])*(r.data[c]-n.data[c]);return new w(Math.sqrt(a),this.getTypeInfo("f32"))}let o=r,i=n;return new w(Math.abs(o.value-i.value),r.typeInfo)}_dot(e,t){let r=0;for(let n=0;n<e.length;++n)r+=t[n]*e[n];return r}Dot(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);return r instanceof p&&n instanceof p?new w(this._dot(r.data,n.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.exp(o)),r.typeInfo);let n=r;return new w(Math.exp(n.value),r.typeInfo)}Exp2(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.pow(2,o)),r.typeInfo);let n=r;return new w(Math.pow(2,n.value),r.typeInfo)}ExtractBits(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(n.typeInfo.name!=="u32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let i=n.value,a=o.value;if(r instanceof p)return new p(r.data.map(u=>u>>i&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;let c=r.value;return new w(c>>i&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(r instanceof p&&n instanceof p&&o instanceof p){let i=this._dot(n.data,o.data);return new p(i<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>this._firstLeadingBit(o)),r.typeInfo);let n=r;return new w(this._firstLeadingBit(n.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>this._firstTrailingBit(o)),r.typeInfo);let n=r;return new w(this._firstTrailingBit(n.value),r.typeInfo)}Floor(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.floor(o)),r.typeInfo);let n=r;return new w(Math.floor(n.value),r.typeInfo)}Fma(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(r instanceof p&&n instanceof p&&o instanceof p)return r.data.length!==n.data.length||r.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new p(r.data.map((u,l)=>u*n.data[l]+o.data[l]),r.typeInfo);let i=r,a=n,c=o;return new w(i.value*a.value+c.value,i.typeInfo)}Fract(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>o-Math.floor(o)),r.typeInfo);let n=r;return new w(n.value-Math.floor(n.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t),i=this.exec.evalExpression(e.args[3],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let a=o.value,c=(1<<i.value)-1<<a,u=~c;if(r instanceof p&&n instanceof p)return new p(r.data.map((h,y)=>h&u|n.data[y]<<a&c),r.typeInfo);let l=r.value,f=n.value;return new w(l&u|f<<a&c,r.typeInfo)}InverseSqrt(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>1/Math.sqrt(o)),r.typeInfo);let n=r;return new w(1/Math.sqrt(n.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p){let o=0;return r.data.forEach(i=>{o+=i*i}),new w(Math.sqrt(o),this.getTypeInfo("f32"))}let n=r;return new w(Math.abs(n.value),r.typeInfo)}Log(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.log(o)),r.typeInfo);let n=r;return new w(Math.log(n.value),r.typeInfo)}Log2(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.log2(o)),r.typeInfo);let n=r;return new w(Math.log2(n.value),r.typeInfo)}Max(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p)return new p(r.data.map((a,c)=>Math.max(a,n.data[c])),r.typeInfo);let o=r,i=n;return new w(Math.max(o.value,i.value),r.typeInfo)}Min(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p)return new p(r.data.map((a,c)=>Math.min(a,n.data[c])),r.typeInfo);let o=r,i=n;return new w(Math.min(o.value,i.value),r.typeInfo)}Mix(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(r instanceof p&&n instanceof p&&o instanceof p)return new p(r.data.map((c,u)=>r.data[u]*(1-o.data[u])+n.data[u]*o.data[u]),r.typeInfo);let i=n,a=o;return new w(r.value*(1-a.value)+i.value*a.value,r.typeInfo)}Modf(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p)return new p(r.data.map((i,a)=>i%n.data[a]),r.typeInfo);let o=n;return new w(r.value%o.value,r.typeInfo)}Normalize(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p){let n=this.Length(e,t).value;return new p(r.data.map(o=>o/n),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p)return new p(r.data.map((a,c)=>Math.pow(a,n.data[c])),r.typeInfo);let o=r,i=n;return new w(Math.pow(o.value,i.value),r.typeInfo)}QuantizeToF16(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof p?new p(r.data.map(n=>n),r.typeInfo):new w(r.value,r.typeInfo)}Radians(e,t){let r=this.exec.evalExpression(e.args[0],t);return r instanceof p?new p(r.data.map(n=>n*Math.PI/180),r.typeInfo):new w(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(r instanceof p&&n instanceof p){let o=this._dot(r.data,n.data);return new p(r.data.map((i,a)=>i-2*o*n.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(r instanceof p&&n instanceof p&&o instanceof w){let i=this._dot(n.data,r.data);return new p(r.data.map((a,c)=>{let u=1-o.value*o.value*(1-i*i);if(u<0)return 0;let l=Math.sqrt(u);return o.value*a-(o.value*i+l)*n.data[c]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.round(o)),r.typeInfo);let n=r;return new w(Math.round(n.value),r.typeInfo)}Saturate(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.min(Math.max(o,0),1)),r.typeInfo);let n=r;return new w(Math.min(Math.max(n.value,0),1),r.typeInfo)}Sign(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.sign(o)),r.typeInfo);let n=r;return new w(Math.sign(n.value),r.typeInfo)}Sin(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.sin(o)),r.typeInfo);let n=r;return new w(Math.sin(n.value),r.typeInfo)}Sinh(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.sinh(o)),r.typeInfo);let n=r;return new w(Math.sinh(n.value),r.typeInfo)}_smoothstep(e,t,r){let n=Math.min(Math.max((r-e)/(t-e),0),1);return n*n*(3-2*n)}SmoothStep(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(o instanceof p&&r instanceof p&&n instanceof p)return new p(o.data.map((u,l)=>this._smoothstep(r.data[l],n.data[l],u)),o.typeInfo);let i=r,a=n,c=o;return new w(this._smoothstep(i.value,a.value,c.value),o.typeInfo)}Sqrt(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.sqrt(o)),r.typeInfo);let n=r;return new w(Math.sqrt(n.value),r.typeInfo)}Step(e,t){let r=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(n instanceof p&&r instanceof p)return new p(n.data.map((i,a)=>i<r.data[a]?0:1),n.typeInfo);let o=r;return new w(n.value<o.value?0:1,o.typeInfo)}Tan(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.tan(o)),r.typeInfo);let n=r;return new w(Math.tan(n.value),r.typeInfo)}Tanh(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.tanh(o)),r.typeInfo);let n=r;return new w(Math.tanh(n.value),r.typeInfo)}_getTransposeType(e){let t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){let r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof P))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let n=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){let o=r.data;return new P([o[0],o[2],o[1],o[3]],n)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){let o=r.data;return new P([o[0],o[3],o[6],o[1],o[4],o[7]],n)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){let o=r.data;return new P([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],n)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){let o=r.data;return new P([o[0],o[3],o[1],o[4],o[2],o[5]],n)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){let o=r.data;return new P([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],n)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){let o=r.data;return new P([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],n)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){let o=r.data;return new P([o[0],o[4],o[1],o[5],o[2],o[6]],n)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){let o=r.data;return new P([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],n)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){let o=r.data;return new P([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],n)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){let r=this.exec.evalExpression(e.args[0],t);if(r instanceof p)return new p(r.data.map(o=>Math.trunc(o)),r.typeInfo);let n=r;return new w(Math.trunc(n.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){let r=e.args[0],n=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof xe){let o=r.name,i=t.getVariableValue(o);if(i instanceof tt){if(n<0||n>=i.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let a=i.getMipLevelSize(n),c=i.dimension;return c==="1d"?new w(a[0],this.getTypeInfo("u32")):c==="3d"?new p(a,this.getTypeInfo("vec3u")):c==="2d"?new p(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${c} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){let r=e.args[0],n=this.exec.evalExpression(e.args[1],t),o=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(n instanceof p)||n.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof xe){let i=r.name,a=t.getVariableValue(i);if(a instanceof tt){let c=Math.floor(n.data[0]),u=Math.floor(n.data[1]);if(c<0||c>=a.width||u<0||u>=a.height)return console.error(`Texture ${i} out of bounds. Line ${e.line}`),null;let l=a.getPixel(c,u,0,o);return l===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new p(l,this.getTypeInfo("vec4f"))}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){let r=e.args[0];if(r instanceof xe){let n=r.name,o=t.getVariableValue(n);return o instanceof tt?new w(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){let r=e.args[0];if(r instanceof xe){let n=r.name,o=t.getVariableValue(n);return o instanceof tt?new w(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){let r=e.args[0];if(r instanceof xe){let n=r.name,o=t.getVariableValue(n);return o instanceof tt?new w(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){let r=e.args[0],n=this.exec.evalExpression(e.args[1],t),o=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,i=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(i.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(n instanceof p)||n.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof xe){let a=r.name,c=t.getVariableValue(a);if(c instanceof tt){let u=c.getMipLevelSize(0),l=Math.floor(n.data[0]),f=Math.floor(n.data[1]);return l<0||l>=u[0]||f<0||f>=u[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(c.setPixel(l,f,0,o,Array.from(i)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t);return t.getVariable(n).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t);return c instanceof w&&a instanceof w&&(c.value=a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value+=a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicSub(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value-=a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicMax(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value=Math.max(c.value,a.value)),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicMin(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value=Math.min(c.value,a.value)),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicAnd(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value=c.value&a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicOr(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value=c.value|a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicXor(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value=c.value^a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicExchange(e,t){let r=e.args[0];r instanceof te&&(r=r.right);let n=this.exec.getVariableName(r,t),o=t.getVariable(n),i=e.args[1],a=this.exec.evalExpression(i,t),c=o.value.getSubData(this.exec,r.postfix,t),u=new w(c.value,c.typeInfo);return c instanceof w&&a instanceof w&&(c.value=a.value),o.value instanceof ne&&o.value.setDataValue(this.exec,c,r.postfix,t),u}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}},ti={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},ye={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]},ur=class s extends xi{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new kt,this.reflection.updateAST(this.ast),this.context=(r=t?.clone())!==null&&r!==void 0?r:new yi,this.builtins=new bi(this),this.typeInfo={bool:this.getTypeInfo(k.bool),i32:this.getTypeInfo(k.i32),u32:this.getTypeInfo(k.u32),f32:this.getTypeInfo(k.f32),f16:this.getTypeInfo(k.f16),vec2f:this.getTypeInfo(B.vec2f),vec2u:this.getTypeInfo(B.vec2u),vec2i:this.getTypeInfo(B.vec2i),vec2h:this.getTypeInfo(B.vec2h),vec3f:this.getTypeInfo(B.vec3f),vec3u:this.getTypeInfo(B.vec3u),vec3i:this.getTypeInfo(B.vec3i),vec3h:this.getTypeInfo(B.vec3h),vec4f:this.getTypeInfo(B.vec4f),vec4u:this.getTypeInfo(B.vec4u),vec4i:this.getTypeInfo(B.vec4i),vec4h:this.getTypeInfo(B.vec4h),mat2x2f:this.getTypeInfo(B.mat2x2f),mat2x3f:this.getTypeInfo(B.mat2x3f),mat2x4f:this.getTypeInfo(B.mat2x4f),mat3x2f:this.getTypeInfo(B.mat3x2f),mat3x3f:this.getTypeInfo(B.mat3x3f),mat3x4f:this.getTypeInfo(B.mat3x4f),mat4x2f:this.getTypeInfo(B.mat4x2f),mat4x3f:this.getTypeInfo(B.mat4x3f),mat4x4f:this.getTypeInfo(B.mat4x4f)}}getVariableValue(e){var t,r;let n=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(n===null)return null;if(n instanceof w)return n.value;if(n instanceof p||n instanceof P)return Array.from(n.data);if(n instanceof ne&&n.typeInfo instanceof Xe){if(n.typeInfo.format.name==="u32")return Array.from(new Uint32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="i32")return Array.from(new Int32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="f32")return Array.from(new Float32Array(n.buffer,n.offset,n.typeInfo.count))}return console.error(`Unsupported return variable type ${n.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,n){let o=this.context.clone();(n=n??{}).constants&&this._setOverrides(n.constants,o),this._execStatements(this.ast,o);let i=o.getFunction(e);if(!i)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}let a=t[0],c=t[1],u=t[2],l=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new p(t,l));let f=this.reflection.getFunctionInfo(e);f===null&&console.error(`Function ${e} not found in reflection data`);for(let h in r)for(let y in r[h]){let g=r[h][y];o.variables.forEach(_=>{var T;let d=_.node;if(d?.attributes){let C=null,E=null;for(let I of d.attributes)I.name==="binding"?C=I.value:I.name==="group"&&(E=I.value);if(y==C&&h==E){let I=!1;for(let G of f.resources)if(G.name===_.name&&G.group===parseInt(h)&&G.binding===parseInt(y)){I=!0;break}if(I)if(g.texture!==void 0&&g.descriptor!==void 0){let G=new tt(g.texture,this.getTypeInfo(d.type),g.descriptor,(T=g.texture.view)!==null&&T!==void 0?T:null);_.value=G}else g.uniform!==void 0?_.value=new ne(g.uniform,this.getTypeInfo(d.type)):_.value=new ne(g,this.getTypeInfo(d.type))}}})}for(let h=0;h<u;++h)for(let y=0;y<c;++y)for(let g=0;g<a;++g)o.setVariable("@workgroup_id",new p([g,y,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(i,[g,y,h],o)}execStatement(e,t){if(e instanceof $n)return this.evalExpression(e.value,t);if(e instanceof Kn){if(e.condition){let r=this.evalExpression(e.condition,t);if(!(r instanceof w))throw new Error("Invalid break-if condition");if(!r.value)return null}return s._breakObj}if(e instanceof Xn)return s._continueObj;if(e instanceof It)this._let(e,t);else if(e instanceof Ue)this._var(e,t);else if(e instanceof ir)this._const(e,t);else if(e instanceof St)this._function(e,t);else{if(e instanceof jn)return this._if(e,t);if(e instanceof Hn)return this._switch(e,t);if(e instanceof Un)return this._for(e,t);if(e instanceof Pn)return this._while(e,t);if(e instanceof Jn)return this._loop(e,t);if(e instanceof Lr){let r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof Vn)this._assign(e,t);else if(e instanceof Nn)this._increment(e,t);else{if(e instanceof Pe)return null;if(e instanceof Or){let r=e.name;t.getVariable(r)===null&&t.setVariable(r,new w(0,this.getTypeInfo("u32")))}else if(e instanceof Pr)this._call(e,t);else{if(e instanceof Wn||e instanceof Ur)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Ie?this._evalBinaryOp(e,t):e instanceof re?this._evalLiteral(e,t):e instanceof xe?this._evalVariable(e,t):e instanceof Nr?this._evalCall(e,t):e instanceof Re?this._evalCreate(e,t):e instanceof qn?this._evalConst(e,t):e instanceof zn?this._evalBitcast(e,t):e instanceof te?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof k){let n=this.reflection.getTypeInfo(e);if(n!==null)return n}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(let r in e){let n=e[r],o=this.reflection.getOverrideInfo(r);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?t.setVariable(r,new w(n,o.type)):o.type.name==="bool"?t.setVariable(r,new w(n?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?t.setVariable(r,new p(n,o.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){let n=[1,1,1];for(let l of e.node.attributes)if(l.name==="workgroup_size"){if(l.value.length>0){let f=r.getVariableValue(l.value[0]);n[0]=f instanceof w?f.value:parseInt(l.value[0])}if(l.value.length>1){let f=r.getVariableValue(l.value[1]);n[1]=f instanceof w?f.value:parseInt(l.value[1])}if(l.value.length>2){let f=r.getVariableValue(l.value[2]);n[2]=f instanceof w?f.value:parseInt(l.value[2])}}let o=this.getTypeInfo("vec3u"),i=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new p(n,o));let a=n[0],c=n[1],u=n[2];for(let l=0,f=0;l<u;++l)for(let h=0;h<c;++h)for(let y=0;y<a;++y,++f){let g=[y,h,l],_=[y+t[0]*n[0],h+t[1]*n[1],l+t[2]*n[2]];r.setVariable("@local_invocation_id",new p(g,o)),r.setVariable("@global_invocation_id",new p(_,o)),r.setVariable("@local_invocation_index",new w(f,i)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(let r of e.node.args)for(let n of r.attributes)if(n.name==="builtin"){let o=`@${n.value}`,i=t.getVariable(o);i!==void 0&&t.variables.set(r.name,i)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof te;)e=e.right;return e instanceof xe?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(let r of e){if(r instanceof Array){let o=t.clone(),i=this._execStatements(r,o);if(i)return i;continue}let n=this.execStatement(r,t);if(n)return n}return null}_call(e,t){let r=t.clone();r.currentFunctionName=e.name;let n=t.getFunction(e.name);if(n){for(let o=0;o<n.node.args.length;++o){let i=n.node.args[o],a=this.evalExpression(e.args[o],r);r.setVariable(i.name,a,i)}this._execStatements(n.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){let r=this.getVariableName(e.variable,t),n=t.getVariable(r);n?e.operator==="++"?n.value instanceof w?n.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?n.value instanceof w?n.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof xe){let r=this.getVariableName(e,t),n=t.getVariable(r);return n===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):n.value.getSubData(this,e.postfix,t)}if(e instanceof te){if(e.operator==="*"){let r=this._getVariableData(e.right,t);return r instanceof ft?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){let r=this._getVariableData(e.right,t);return new ft(r)}}return null}_assign(e,t){let r=null,n="<var>",o=null;if(e.variable instanceof te){let c=this._getVariableData(e.variable,t),u=this.evalExpression(e.value,t),l=e.operator;if(l==="="){if(c instanceof w||c instanceof p||c instanceof P){if(u instanceof w||u instanceof p||u instanceof P&&c.data.length===u.data.length)return void c.data.set(u.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(c instanceof ne&&u instanceof ne&&c.buffer.byteLength-c.offset>=u.buffer.byteLength-u.offset)return void(c.buffer.byteLength%4==0?new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4).set(new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4)):new Uint8Array(c.buffer,c.offset,c.typeInfo.size).set(new Uint8Array(u.buffer,u.offset,u.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(l==="+=")return c instanceof w||c instanceof p||c instanceof P?u instanceof w||u instanceof p||u instanceof P?void c.data.set(u.data.map((f,h)=>c.data[h]+f)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(l==="-=")return(c instanceof w||c instanceof p||c instanceof P)&&(u instanceof w||u instanceof p||u instanceof P)?void c.data.set(u.data.map((f,h)=>c.data[h]-f)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof te){if(e.variable.operator==="*"){n=this.getVariableName(e.variable.right,t);let c=t.getVariable(n);if(!(c&&c.value instanceof ft))return void console.error(`Variable ${n} is not a pointer. Line ${e.line}`);r=c.value.reference;let u=e.variable.postfix;if(!u){let l=e.variable.right;for(;l instanceof te;){if(l.postfix){u=l.postfix;break}l=l.right}}u&&(r=r.getSubData(this,u,t))}}else{o=e.variable.postfix,n=this.getVariableName(e.variable,t);let c=t.getVariable(n);if(c===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);r=c.value}if(r instanceof ft&&(r=r.reference),r===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);let i=this.evalExpression(e.value,t),a=e.operator;if(a!=="="){let c=r.getSubData(this,o,t);if(c instanceof p&&i instanceof w){let u=c.data,l=i.value;if(a==="+=")for(let f=0;f<u.length;++f)u[f]+=l;else if(a==="-=")for(let f=0;f<u.length;++f)u[f]-=l;else if(a==="*=")for(let f=0;f<u.length;++f)u[f]*=l;else if(a==="/=")for(let f=0;f<u.length;++f)u[f]/=l;else if(a==="%=")for(let f=0;f<u.length;++f)u[f]%=l;else if(a==="&=")for(let f=0;f<u.length;++f)u[f]&=l;else if(a==="|=")for(let f=0;f<u.length;++f)u[f]|=l;else if(a==="^=")for(let f=0;f<u.length;++f)u[f]^=l;else if(a==="<<=")for(let f=0;f<u.length;++f)u[f]<<=l;else if(a===">>=")for(let f=0;f<u.length;++f)u[f]>>=l;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(c instanceof p&&i instanceof p){let u=c.data,l=i.data;if(u.length!==l.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let f=0;f<u.length;++f)u[f]+=l[f];else if(a==="-=")for(let f=0;f<u.length;++f)u[f]-=l[f];else if(a==="*=")for(let f=0;f<u.length;++f)u[f]*=l[f];else if(a==="/=")for(let f=0;f<u.length;++f)u[f]/=l[f];else if(a==="%=")for(let f=0;f<u.length;++f)u[f]%=l[f];else if(a==="&=")for(let f=0;f<u.length;++f)u[f]&=l[f];else if(a==="|=")for(let f=0;f<u.length;++f)u[f]|=l[f];else if(a==="^=")for(let f=0;f<u.length;++f)u[f]^=l[f];else if(a==="<<=")for(let f=0;f<u.length;++f)u[f]<<=l[f];else if(a===">>=")for(let f=0;f<u.length;++f)u[f]>>=l[f];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(c instanceof w&&i instanceof w))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?c.value+=i.value:a==="-="?c.value-=i.value:a==="*="?c.value*=i.value:a==="/="?c.value/=i.value:a==="%="?c.value%=i.value:a==="&="?c.value&=i.value:a==="|="?c.value|=i.value:a==="^="?c.value^=i.value:a==="<<="?c.value<<=i.value:a===">>="?c.value>>=i.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof ne&&r.setDataValue(this,c,o,t))}if(r instanceof ne)r.setDataValue(this,i,o,t);else if(o){if(!(r instanceof p||r instanceof P))return void console.error(`Variable ${n} is not a vector or matrix. Line ${e.line}`);if(o instanceof ht){let c=this.evalExpression(o.index,t).value;if(r instanceof p){if(!(i instanceof w))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[c]=i.value}else{if(!(r instanceof P))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let u=this.evalExpression(o.index,t).value;if(u<0)return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(i instanceof p))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let l=r.typeInfo.getTypeName();if(l==="mat2x2"||l==="mat2x2f"||l==="mat2x2h"){if(!(u<2&&i.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[2*u]=i.data[0],r.data[2*u+1]=i.data[1]}else if(l==="mat2x3"||l==="mat2x3f"||l==="mat2x3h"){if(!(u<2&&i.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[3*u]=i.data[0],r.data[3*u+1]=i.data[1],r.data[3*u+2]=i.data[2]}else if(l==="mat2x4"||l==="mat2x4f"||l==="mat2x4h"){if(!(u<2&&i.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[4*u]=i.data[0],r.data[4*u+1]=i.data[1],r.data[4*u+2]=i.data[2],r.data[4*u+3]=i.data[3]}else if(l==="mat3x2"||l==="mat3x2f"||l==="mat3x2h"){if(!(u<3&&i.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[2*u]=i.data[0],r.data[2*u+1]=i.data[1]}else if(l==="mat3x3"||l==="mat3x3f"||l==="mat3x3h"){if(!(u<3&&i.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[3*u]=i.data[0],r.data[3*u+1]=i.data[1],r.data[3*u+2]=i.data[2]}else if(l==="mat3x4"||l==="mat3x4f"||l==="mat3x4h"){if(!(u<3&&i.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[4*u]=i.data[0],r.data[4*u+1]=i.data[1],r.data[4*u+2]=i.data[2],r.data[4*u+3]=i.data[3]}else if(l==="mat4x2"||l==="mat4x2f"||l==="mat4x2h"){if(!(u<4&&i.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[2*u]=i.data[0],r.data[2*u+1]=i.data[1]}else if(l==="mat4x3"||l==="mat4x3f"||l==="mat4x3h"){if(!(u<4&&i.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[3*u]=i.data[0],r.data[3*u+1]=i.data[1],r.data[3*u+2]=i.data[2]}else{if(l!=="mat4x4"&&l!=="mat4x4f"&&l!=="mat4x4h")return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(u<4&&i.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);r.data[4*u]=i.data[0],r.data[4*u+1]=i.data[1],r.data[4*u+2]=i.data[2],r.data[4*u+3]=i.data[3]}}}}}else if(o instanceof nt){let c=o.value;if(!(r instanceof p))return void console.error(`Invalid assignment to ${c}. Variable ${n} is not a vector. Line ${e.line}`);if(i instanceof w){if(c.length>1)return void console.error(`Invalid assignment to ${c} for variable ${n}. Line ${e.line}`);if(c==="x")r.data[0]=i.value;else if(c==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${c} for variable ${n}. Line ${e.line}`);r.data[1]=i.value}else if(c==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${c} for variable ${n}. Line ${e.line}`);r.data[2]=i.value}else if(c==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${c} for variable ${n}. Line ${e.line}`);r.data[3]=i.value}}else{if(!(i instanceof p))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(c.length!==i.data.length)return void console.error(`Invalid assignment to ${c} for variable ${n}. Line ${e.line}`);for(let u=0;u<c.length;++u){let l=c[u];if(l==="x"||l==="r")r.data[0]=i.data[u];else if(l==="y"||l==="g"){if(i.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);r.data[1]=i.data[u]}else if(l==="z"||l==="b"){if(i.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);r.data[2]=i.data[u]}else{if(l!=="w"&&l!=="a")return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);if(i.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);r.data[3]=i.data[u]}}}}}else r instanceof w&&i instanceof w?r.value=i.value:r instanceof p&&i instanceof p||r instanceof P&&i instanceof P?r.data.set(i.data):console.error(`Invalid assignment to ${n}. Line ${e.line}`)}_function(e,t){let r=new gi(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof te||(r=r.clone())}else{let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||n==="array"){let o=new Re(e.type,[]);r=this._evalCreate(o,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof te||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||e.type instanceof Ct||e.type instanceof Pe||e.type instanceof B){let o=new Re(e.type,[]);r=this._evalCreate(o,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();let r=this.evalExpression(e.condition,t);if(!(r instanceof w))return console.error(`Invalid if condition. Line ${e.line}`),null;let n=null;for(let o of e.cases)if(o instanceof es)for(let i of o.selectors){if(i instanceof cr){n=o;continue}let a=this.evalExpression(i,t);if(!(a instanceof w))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(o.body,t)}else o instanceof ts&&(n=o);return n?this._execStatements(n.body,t):null}_if(e,t){t=t.clone();let r=this.evalExpression(e.condition,t);if(!(r instanceof w))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(let n of e.elseif){let o=this.evalExpression(n.condition,t);if(!(o instanceof w))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(n.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof w?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){let r=this._execStatements(e.body,t);if(r===s._breakObj)break;if(r!==null&&r!==s._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){let r=this._execStatements(e.body,t);if(r===s._breakObj)break;if(r===s._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===s._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){let r=this._execStatements(e.body,t);if(r===s._breakObj)break;if(r!==s._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){let r=this.evalExpression(e.value,t),n=e.type;if(r instanceof w){let o=Cu(r.value,r.typeInfo.name,n.name);return new w(o,this.getTypeInfo(n))}if(r instanceof p){let o=r.typeInfo.getTypeName(),i="";if(o.endsWith("f"))i="f32";else if(o.endsWith("i"))i="i32";else if(o.endsWith("u"))i="u32";else if(o.endsWith("b"))i="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;i="f16"}let a=n.getTypeName(),c="";if(a.endsWith("f"))c="f32";else if(a.endsWith("i"))c="i32";else if(a.endsWith("u"))c="u32";else if(a.endsWith("b"))c="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${c}. Line ${e.line}`),null;c="f16"}let u=(function(l,f,h){if(f===h)return l;let y=new Array(l.length);for(let g=0;g<l.length;g++)y[g]=Cu(l[g],f,h);return y})(Array.from(r.data),i,c);return new p(u,this.getTypeInfo(n))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Re){if(e.type===null)return Vr.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}let n=e instanceof Re?e.type.name:e.name,o=e instanceof Re?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${n}. Line ${e.line}`),null;if(o.size===0)return null;let i=new ne(new ArrayBuffer(o.size),o,0);if(o instanceof Ke){if(e.args)for(let a=0;a<e.args.length;++a){let c=o.members[a],u=e.args[a],l=this.evalExpression(u,t);i.setData(this,l,c.type,c.offset,t)}}else if(o instanceof Xe){let a=0;if(e.args)for(let c=0;c<e.args.length;++c){let u=e.args[c],l=this.evalExpression(u,t);o.format===null&&(((r=l.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=l.typeInfo),i.setData(this,l,o.format,a,t),a+=o.stride}}else console.error(`Unknown type "${n}". Line ${e.line}`);return e instanceof Re?i.getSubData(this,e.postfix,t):i}_evalLiteral(e,t){let r=this.getTypeInfo(e.type),n=r.name;return n==="x32"||n==="u32"||n==="f32"||n==="f16"||n==="i32"||n==="bool"?new w(e.scalarValue,r):n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"?this._callConstructorVec(e,t):n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){let r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){let n=s._priority.get(t.name);s._priority.get(e[r].name)<n&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){let r=this.evalExpression(e.right,t);if(e.operator==="&")return new ft(r);if(e.operator==="*")return r instanceof ft?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);let n=r instanceof w?r.value:r instanceof p?Array.from(r.data):null;switch(e.operator){case"+":{if(D(n)){let a=n.map((c,u)=>+c);return new p(a,r.typeInfo)}let o=n,i=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new w(+o,i)}case"-":{if(D(n)){let a=n.map((c,u)=>-c);return new p(a,r.typeInfo)}let o=n,i=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new w(-o,i)}case"!":{if(D(n)){let a=n.map((c,u)=>c?0:1);return new p(a,r.typeInfo)}let o=n,i=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new w(o?0:1,i)}case"~":{if(D(n)){let a=n.map((c,u)=>~c);return new p(a,r.typeInfo)}let o=n,i=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new w(~o,i)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){let r=this.evalExpression(e.left,t),n=this.evalExpression(e.right,t),o=r instanceof w?r.value:r instanceof p||r instanceof P?Array.from(r.data):null,i=n instanceof w?n.value:n instanceof p||n instanceof P?Array.from(n.data):null;switch(e.operator){case"+":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y+f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h+l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l+h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a+c,u)}case"-":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y-f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h-l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l-h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a-c,u)}case"*":{if(D(o)&&D(i)){let l=o,f=i;if(r instanceof P&&n instanceof P){let h=(function(T,d,C,E){if(ye[d.name]===void 0||ye[E.name]===void 0)return null;let I=ye[d.name][0],G=ye[d.name][1],U=ye[E.name][0];if(I!==ye[E.name][1])return null;let L=new Array(U*G);for(let O=0;O<G;O++)for(let N=0;N<U;N++){let x=0;for(let S=0;S<I;S++)x+=T[S*G+O]*C[N*I+S];L[O*U+N]=x}return L})(l,r.typeInfo,f,n.typeInfo);if(h===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let y=ye[n.typeInfo.name][0],g=ye[r.typeInfo.name][1],_=this.getTypeInfo(`mat${y}x${g}f`);return new P(h,_)}if(r instanceof P&&n instanceof p){let h=(function(y,g,_,T){if(ye[g.name]===void 0||ti[T.name]===void 0)return null;let d=ye[g.name][0],C=ye[g.name][1];if(d!==_.length)return null;let E=new Array(C);for(let I=0;I<C;I++){let G=0;for(let U=0;U<d;U++)G+=y[U*C+I]*_[U];E[I]=G}return E})(l,r.typeInfo,f,n.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new p(h,n.typeInfo)}if(r instanceof p&&n instanceof P){let h=(function(y,g,_,T){if(ti[g.name]===void 0||ye[T.name]===void 0)return null;let d=ye[T.name][0],C=ye[T.name][1];if(C!==y.length)return null;let E=[];for(let I=0;I<d;I++){let G=0;for(let U=0;U<C;U++)G+=y[U]*_[U*d+I];E[I]=G}return E})(l,r.typeInfo,f,n.typeInfo);return h===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new p(h,r.typeInfo)}{if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y*f[g]);return new p(h,r.typeInfo)}}if(D(o)){let l=i,f=o.map((h,y)=>h*l);return r instanceof P?new P(f,r.typeInfo):new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l*h);return n instanceof P?new P(f,n.typeInfo):new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a*c,u)}case"%":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y%f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h%l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l%h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a%c,u)}case"/":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y/f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h/l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l/h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a/c,u)}case"&":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y&f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h&l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l&h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a&c,u)}case"|":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y|f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h|l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l|h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a|c,u)}case"^":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y^f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h^l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l^h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a^c,u)}case"<<":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y<<f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h<<l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l<<h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a<<c,u)}case">>":{if(D(o)&&D(i)){let l=o,f=i;if(l.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let h=l.map((y,g)=>y>>f[g]);return new p(h,r.typeInfo)}if(D(o)){let l=i,f=o.map((h,y)=>h>>l);return new p(f,r.typeInfo)}if(D(i)){let l=o,f=i.map((h,y)=>l>>h);return new p(f,n.typeInfo)}let a=o,c=i,u=this._maxFormatTypeInfo([r.typeInfo,n.typeInfo]);return new w(a>>c,u)}case">":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l>c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u>a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a>u?1:0);return new p(c,n.typeInfo)}return new w(o>i?1:0,this.getTypeInfo("bool"));case"<":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l<c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u<a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a<u?1:0);return new p(c,n.typeInfo)}return new w(o<i?1:0,this.getTypeInfo("bool"));case"==":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l===c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u==a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a==u?1:0);return new p(c,n.typeInfo)}return new w(o===i?1:0,this.getTypeInfo("bool"));case"!=":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l!==c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u!==a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a!==u?1:0);return new p(c,n.typeInfo)}return new w(o!==i?1:0,this.getTypeInfo("bool"));case">=":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l>=c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u>=a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a>=u?1:0);return new p(c,n.typeInfo)}return new w(o>=i?1:0,this.getTypeInfo("bool"));case"<=":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l<=c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u<=a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a<=u?1:0);return new p(c,n.typeInfo)}return new w(o<=i?1:0,this.getTypeInfo("bool"));case"&&":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l&&c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u&&a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a&&u?1:0);return new p(c,n.typeInfo)}return new w(o&&i?1:0,this.getTypeInfo("bool"));case"||":if(D(o)&&D(i)){let a=o,c=i;if(a.length!==c.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let u=a.map((l,f)=>l||c[f]?1:0);return new p(u,r.typeInfo)}if(D(o)){let a=i,c=o.map((u,l)=>u||a?1:0);return new p(c,r.typeInfo)}if(D(i)){let a=o,c=i.map((u,l)=>a||u?1:0);return new p(c,n.typeInfo)}return new w(o||i?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;let r=t.clone();r.currentFunctionName=e.name;let n=t.getFunction(e.name);if(!n)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<n.node.args.length;++o){let i=n.node.args[o],a=this.evalExpression(e.args[o],r);r.createVariable(i.name,a,i)}return this._execStatements(n.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}let r=t.getFunction(e.name);if(r){let n=t.clone();for(let o=0;o<r.node.args.length;++o){let i=r.node.args[o],a=this.evalExpression(e.args[o],n);n.setVariable(i.name,a,i)}return this._execStatements(r.node.body,n)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new w(0,this.getTypeInfo(e.type));let r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){let r=this.getTypeInfo(e.type),n=e.type.getTypeName(),o=ti[n];if(o===void 0)return console.error(`Invalid vec constructor ${n}. Line ${e.line}`),null;let i=[];if(e instanceof re)if(e.isVector){let a=e.vectorValue;for(let c of a)i.push(c)}else i.push(e.scalarValue);else if(e.args)for(let a of e.args){let c=this.evalExpression(a,t);if(c instanceof p){let u=c.data;for(let l=0;l<u.length;++l){let f=u[l];i.push(f)}}else if(c instanceof w){let u=c.value;i.push(u)}}if(e.type instanceof B&&e.type.format===null&&(e.type.format=B.f32),i.length===0){let a=new Array(o).fill(0);return new p(a,r).getSubData(this,e.postfix,t)}if(i.length===1)for(;i.length<o;)i.push(i[0]);return i.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new p(i.length>o?i.slice(0,o):i,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){let r=this.getTypeInfo(e.type),n=e.type.getTypeName(),o=ye[n];if(o===void 0)return console.error(`Invalid matrix constructor ${n}. Line ${e.line}`),null;let i=[];if(e instanceof re)if(e.isVector){let a=e.vectorValue;for(let c of a)i.push(c)}else i.push(e.scalarValue);else if(e.args)for(let a of e.args){let c=this.evalExpression(a,t);c instanceof p?i.push(...c.data):c instanceof w?i.push(c.value):c instanceof P&&i.push(...c.data)}if(r instanceof rt&&r.format===null&&(r.format=this.getTypeInfo("f32")),i.length===0){let a=new Array(o[2]).fill(0);return new P(a,r).getSubData(this,e.postfix,t)}return i.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new P(i,r).getSubData(this,e.postfix,t)}};ur._breakObj=new Le(new we("BREAK",null),null),ur._continueObj=new Le(new we("CONTINUE",null),null),ur._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var Ai=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},wi=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Ai,this._exec=new ur,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let t=[];for(;!this._isAtEnd();){let r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(let r of this._deferArrayCountEval){let n=r.arrayType,o=r.countNode;if(o instanceof xe){let i=o.name,a=this._context.constants.get(i);if(a)try{let c=a.constEvaluate(this._exec);n.count=c}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let r of t)r.search(n=>{n instanceof ns||n instanceof ar?n.type=this._forwardType(n.type):n instanceof Ct?n.format=this._forwardType(n.format):n instanceof Ue||n instanceof It||n instanceof ir?n.type=this._forwardType(n.type):n instanceof St?n.returnType=this._forwardType(n.returnType):n instanceof rs&&(n.type=this._forwardType(n.type))});return t}_forwardType(e){if(e instanceof Qn){let t=this._getType(e.name);if(t)return t}else e instanceof ar?e.type=this._forwardType(e.type):e instanceof Ct&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){let t=new mi(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==m.eof}_match(e){if(e instanceof b)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){let n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let t=this._peek();if(e instanceof Array){let r=t.type,n=!1;for(let o of e){if(r===o)return!0;o===m.tokens.name&&(n=!0)}if(n){let o=m.tokens.name.rule.exec(t.lexeme);if(o&&o.index==0&&o[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===m.tokens.name){let r=m.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(m.tokens.semicolon)&&!this._isAtEnd(););if(this._match(m.keywords.alias)){let t=this._type_alias();return this._consume(m.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(m.keywords.diagnostic)){let t=this._diagnostic();return this._consume(m.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(m.keywords.requires)){let t=this._requires_directive();return this._consume(m.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(m.keywords.enable)){let t=this._enable_directive();return this._consume(m.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}let e=this._attribute();if(this._check(m.keywords.var)){let t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(m.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(m.keywords.override)){let t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(m.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(m.keywords.let)){let t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(m.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(m.keywords.const)){let t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(m.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(m.keywords.struct)){let t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(m.keywords.fn)){let t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(m.keywords.fn))return null;let e=this._currentLine,t=this._consume(m.tokens.ident,"Expected function name.").toString();this._consume(m.tokens.paren_left,"Expected '(' for function arguments.");let r=[];if(!this._check(m.tokens.paren_right))do{if(this._check(m.tokens.paren_right))break;let a=this._attribute(),c=this._consume(m.tokens.name,"Expected argument name.").toString();this._consume(m.tokens.colon,"Expected ':' for argument type.");let u=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=u,r.push(this._updateNode(new rs(c,l,a))))}while(this._match(m.tokens.comma));this._consume(m.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(m.tokens.arrow)){let a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}let o=this._compound_statement(),i=this._currentLine;return this._updateNode(new St(t,r,n,o,e,i),e)}_compound_statement(){let e=[];for(this._consume(m.tokens.brace_left,"Expected '{' for block.");!this._check(m.tokens.brace_right);){let t=this._statement();t!==null&&e.push(t)}return this._consume(m.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(m.tokens.semicolon)&&!this._isAtEnd(););if(this._check(m.tokens.attr)&&this._attribute(),this._check(m.keywords.if))return this._if_statement();if(this._check(m.keywords.switch))return this._switch_statement();if(this._check(m.keywords.loop))return this._loop_statement();if(this._check(m.keywords.for))return this._for_statement();if(this._check(m.keywords.while))return this._while_statement();if(this._check(m.keywords.continuing))return this._continuing_statement();if(this._check(m.keywords.static_assert))return this._static_assert_statement();if(this._check(m.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(m.keywords.return))e=this._return_statement();else if(this._check([m.keywords.var,m.keywords.let,m.keywords.const]))e=this._variable_statement();else if(this._match(m.keywords.discard))e=this._updateNode(new fi);else if(this._match(m.keywords.break)){let t=this._updateNode(new Kn);if(this._currentLoop.length>0){let r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(m.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(m.keywords.continue)){let t=this._updateNode(new Xn);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{let r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(m.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(m.keywords.static_assert))return null;let e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new ci(t),e)}_while_statement(){if(!this._match(m.keywords.while))return null;let e=this._updateNode(new Pn(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(m.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(m.keywords.continuing))return null;let t=this._currentLine,r=this._compound_statement();return this._updateNode(new Lr(r,e),t)}_for_statement(){if(!this._match(m.keywords.for))return null;this._consume(m.tokens.paren_left,"Expected '('.");let e=this._updateNode(new Un(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(m.tokens.semicolon)?null:this._for_init(),this._consume(m.tokens.semicolon,"Expected ';'."),e.condition=this._check(m.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(m.tokens.semicolon,"Expected ';'."),e.increment=this._check(m.tokens.paren_right)?null:this._for_increment(),this._consume(m.tokens.paren_right,"Expected ')'."),this._check(m.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(m.keywords.var)){let e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(m.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Ue(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(m.keywords.let)){let e=this._currentLine,t=this._consume(m.tokens.name,"Expected name for let.").toString(),r=null;if(this._match(m.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}this._consume(m.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return this._updateNode(new It(t,r,null,null,n),e)}if(this._match(m.keywords.const)){let e=this._currentLine,t=this._consume(m.tokens.name,"Expected name for const.").toString(),r=null;if(this._match(m.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}this._consume(m.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return r===null&&n instanceof re&&(r=n.type),this._updateNode(new ir(t,r,null,null,n),e)}return null}_increment_decrement_statement(){let e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(m.increment_operators))return this._current=e,null;let r=this._consume(m.increment_operators,"Expected increment operator");return this._updateNode(new Nn(r.type===m.tokens.plus_plus?sr.increment:sr.decrement,t))}_assignment_statement(){let e=null,t=this._currentLine;if(this._check(m.tokens.brace_right))return null;let r=this._match(m.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;let n=this._consume(m.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new Vn(Rr.parse(n.lexeme),e,o),t)}_func_call_statement(){if(!this._check(m.tokens.ident))return null;let e=this._currentLine,t=this._current,r=this._consume(m.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):this._updateNode(new Pr(r.lexeme,n),e)}_loop_statement(){if(!this._match(m.keywords.loop))return null;this._check(m.tokens.attr)&&this._attribute(),this._consume(m.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new Jn([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof Lr){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(m.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(m.keywords.switch))return null;let e=this._updateNode(new Hn(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(m.tokens.attr)&&this._attribute(),this._consume(m.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(m.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],t=!1;for(;this._check([m.keywords.default,m.keywords.case]);){if(this._match(m.keywords.case)){let r=this._case_selectors();for(let o of r)if(o instanceof cr){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(m.tokens.colon),this._check(m.tokens.attr)&&this._attribute(),this._consume(m.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(m.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new es(r,n)))}if(this._match(m.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(m.tokens.colon),this._check(m.tokens.attr)&&this._attribute(),this._consume(m.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(m.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new ts(r)))}}return e}_case_selectors(){let e=[];for(this._match(m.keywords.default)?e.push(this._updateNode(new cr)):e.push(this._shift_expression());this._match(m.tokens.comma);)this._match(m.keywords.default)?e.push(this._updateNode(new cr)):e.push(this._shift_expression());return e}_case_body(){if(this._match(m.keywords.fallthrough))return this._consume(m.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);let t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(m.keywords.if))return null;let e=this._currentLine,t=this._optional_paren_expression();this._check(m.tokens.attr)&&this._attribute();let r=this._compound_statement(),n=[];this._match_elseif()&&(this._check(m.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let o=null;return this._match(m.keywords.else)&&(this._check(m.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new jn(t,r,n,o),e)}_match_elseif(){return this._tokens[this._current].type===m.keywords.else&&this._tokens[this._current+1].type===m.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new hi(t,r))),this._match_elseif()&&(this._check(m.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(m.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new $n(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(m.tokens.or_or);)e=this._updateNode(new Ie(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(m.tokens.and_and);)e=this._updateNode(new Ie(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(m.tokens.or);)e=this._updateNode(new Ie(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(m.tokens.xor);)e=this._updateNode(new Ie(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(m.tokens.and);)e=this._updateNode(new Ie(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([m.tokens.equal_equal,m.tokens.not_equal])?this._updateNode(new Ie(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([m.tokens.less_than,m.tokens.greater_than,m.tokens.less_than_equal,m.tokens.greater_than_equal]);)e=this._updateNode(new Ie(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([m.tokens.shift_left,m.tokens.shift_right]);)e=this._updateNode(new Ie(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([m.tokens.plus,m.tokens.minus]);)e=this._updateNode(new Ie(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([m.tokens.star,m.tokens.forward_slash,m.tokens.modulo]);)e=this._updateNode(new Ie(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([m.tokens.minus,m.tokens.bang,m.tokens.tilde,m.tokens.star,m.tokens.and])?this._updateNode(new te(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(m.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(m.tokens.bracket_right,"Expected ']'.");let t=this._updateNode(new ht(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(m.tokens.period)){let e=this._consume(m.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new nt(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return k.void;case"bool":return k.bool;case"i32":return k.i32;case"u32":return k.u32;case"f32":return k.f32;case"f16":return k.f16;case"vec2f":return B.vec2f;case"vec3f":return B.vec3f;case"vec4f":return B.vec4f;case"vec2i":return B.vec2i;case"vec3i":return B.vec3i;case"vec4i":return B.vec4i;case"vec2u":return B.vec2u;case"vec3u":return B.vec3u;case"vec4u":return B.vec4u;case"vec2h":return B.vec2h;case"vec3h":return B.vec3h;case"vec4h":return B.vec4h;case"mat2x2f":return B.mat2x2f;case"mat2x3f":return B.mat2x3f;case"mat2x4f":return B.mat2x4f;case"mat3x2f":return B.mat3x2f;case"mat3x3f":return B.mat3x3f;case"mat3x4f":return B.mat3x4f;case"mat4x2f":return B.mat4x2f;case"mat4x3f":return B.mat4x3f;case"mat4x4f":return B.mat4x4f;case"mat2x2h":return B.mat2x2h;case"mat2x3h":return B.mat2x3h;case"mat2x4h":return B.mat2x4h;case"mat3x2h":return B.mat3x2h;case"mat3x3h":return B.mat3x3h;case"mat3x4h":return B.mat3x4h;case"mat4x2h":return B.mat4x2h;case"mat4x3h":return B.mat4x3h;case"mat4x4h":return B.mat4x4h;case"mat2x2i":return B.mat2x2i;case"mat2x3i":return B.mat2x3i;case"mat2x4i":return B.mat2x4i;case"mat3x2i":return B.mat3x2i;case"mat3x3i":return B.mat3x3i;case"mat3x4i":return B.mat3x4i;case"mat4x2i":return B.mat4x2i;case"mat4x3i":return B.mat4x3i;case"mat4x4i":return B.mat4x4i;case"mat2x2u":return B.mat2x2u;case"mat2x3u":return B.mat2x3u;case"mat2x4u":return B.mat2x4u;case"mat3x2u":return B.mat3x2u;case"mat3x3u":return B.mat3x3u;case"mat3x4u":return B.mat3x4u;case"mat4x2u":return B.mat4x2u;case"mat4x3u":return B.mat4x3u;case"mat4x4u":return B.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(m.tokens.ident)){let r=this._previous().toString();if(this._check(m.tokens.paren_left)){let n=this._argument_expression_list(),o=this._getType(r);return o!==null?this._updateNode(new Re(o,n)):this._updateNode(new Nr(r,n))}if(this._context.constants.has(r)){let n=this._context.constants.get(r);return this._updateNode(new qn(r,n.value))}return this._updateNode(new xe(r))}if(this._match(m.tokens.int_literal)){let r=this._previous().toString(),n=r.endsWith("i")||r.endsWith("i")?k.i32:r.endsWith("u")||r.endsWith("U")?k.u32:k.x32,o=parseInt(r);return this._validateTypeRange(o,n),this._updateNode(new re(new w(o,this._exec.getTypeInfo(n)),n))}if(this._match(m.tokens.uint_literal)){let r=parseInt(this._previous().toString());return this._validateTypeRange(r,k.u32),this._updateNode(new re(new w(r,this._exec.getTypeInfo(k.u32)),k.u32))}if(this._match([m.tokens.decimal_float_literal,m.tokens.hex_float_literal])){let r=this._previous().toString(),n=r.endsWith("h");n&&(r=r.substring(0,r.length-1));let o=parseFloat(r);this._validateTypeRange(o,n?k.f16:k.f32);let i=n?k.f16:k.f32;return this._updateNode(new re(new w(o,this._exec.getTypeInfo(i)),i))}if(this._match([m.keywords.true,m.keywords.false])){let r=this._previous().toString()===m.keywords.true.rule;return this._updateNode(new re(new w(r?1:0,this._exec.getTypeInfo(k.bool)),k.bool))}if(this._check(m.tokens.paren_left))return this._paren_expression();if(this._match(m.keywords.bitcast)){this._consume(m.tokens.less_than,"Expected '<'.");let r=this._type_decl();this._consume(m.tokens.greater_than,"Expected '>'.");let n=this._paren_expression();return this._updateNode(new zn(r,n))}let e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Re(e,t))}_argument_expression_list(){if(!this._match(m.tokens.paren_left))return null;let e=[];do{if(this._check(m.tokens.paren_right))break;let t=this._short_circuit_or_expression();e.push(t)}while(this._match(m.tokens.comma));return this._consume(m.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(m.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(m.tokens.paren_right),e}_paren_expression(){this._consume(m.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(m.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(m.keywords.struct))return null;let e=this._currentLine,t=this._consume(m.tokens.ident,"Expected name for struct.").toString();this._consume(m.tokens.brace_left,"Expected '{' for struct body.");let r=[];for(;!this._check(m.tokens.brace_right);){let i=this._attribute(),a=this._consume(m.tokens.name,"Expected variable name.").toString();this._consume(m.tokens.colon,"Expected ':' for struct member type.");let c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c),this._check(m.tokens.brace_right)?this._match(m.tokens.comma):this._consume(m.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new ns(a,u,i)))}this._consume(m.tokens.brace_right,"Expected '}' after struct body.");let n=this._currentLine,o=this._updateNode(new Pe(t,r,e,n),e);return this._context.structs.set(t,o),o}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(m.tokens.equal)){let t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof re){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof re&&(e.type=e.value.type.name==="x32"?k.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(m.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(m.keywords.const))return null;let t=this._consume(m.tokens.name,"Expected variable name"),r=this._currentLine,n=null;if(this._match(m.tokens.colon)){let c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}let o=null;this._consume(m.tokens.equal,"const declarations require an assignment");let i=this._short_circuit_or_expression();try{let c=[k.f32],u=i.constEvaluate(this._exec,c);u instanceof w&&this._validateTypeRange(u.value,c[0]),c[0]instanceof B&&c[0].format===null&&u.typeInfo instanceof rt&&u.typeInfo.format!==null&&(u.typeInfo.format.name==="f16"?c[0].format=k.f16:u.typeInfo.format.name==="f32"?c[0].format=k.f32:u.typeInfo.format.name==="i32"?c[0].format=k.i32:u.typeInfo.format.name==="u32"?c[0].format=k.u32:u.typeInfo.format.name==="bool"?c[0].format=k.bool:console.error(`TODO: impelement template format type ${u.typeInfo.format.name}`)),o=this._updateNode(new re(u,c[0])),this._exec.context.setVariable(t.toString(),u)}catch{o=i}if(n!==null&&o instanceof re){if(o.type.name!=="x32"&&n.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${n.name}. Line:${this._currentLine}`);o.type=n,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else n===null&&o instanceof re&&(n=(e=o?.type)!==null&&e!==void 0?e:k.f32,n===k.x32&&(n=k.i32));let a=this._updateNode(new ir(t.toString(),n,"","",o),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(m.keywords.let))return null;let e=this._currentLine,t=this._consume(m.tokens.name,"Expected variable name"),r=null;if(this._match(m.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}let n=null;if(this._match(m.tokens.equal)&&(n=this._const_expression()),r!==null&&n instanceof re){if(n.type.name!=="x32"&&r.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${r.name}. Line:${this._currentLine}`);n.type=r}else r===null&&n instanceof re&&(r=n.type.name==="x32"?k.i32:n.type);return n instanceof re&&n.isScalar&&this._validateTypeRange(n.scalarValue,r),this._updateNode(new It(t.toString(),r,"","",n),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(m.keywords.var))return null;let e=this._currentLine,t="",r="";this._match(m.tokens.less_than)&&(t=this._consume(m.storage_class,"Expected storage_class.").toString(),this._match(m.tokens.comma)&&(r=this._consume(m.access_mode,"Expected access_mode.").toString()),this._consume(m.tokens.greater_than,"Expected '>'."));let n=this._consume(m.tokens.name,"Expected variable name"),o=null;if(this._match(m.tokens.colon)){let i=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=i)}return this._updateNode(new Ue(n.toString(),o,t,r,null),e)}_override_decl(){if(!this._match(m.keywords.override))return null;let e=this._consume(m.tokens.name,"Expected variable name"),t=null;if(this._match(m.tokens.colon)){let r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new Or(e.toString(),t,null))}_diagnostic(){this._consume(m.tokens.paren_left,"Expected '('");let e=this._consume(m.tokens.ident,"Expected severity control name.");this._consume(m.tokens.comma,"Expected ','");let t=this._consume(m.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(m.tokens.period)&&(t+=`.${this._consume(m.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(m.tokens.paren_right,"Expected ')'"),this._updateNode(new Wn(e.toString(),t))}_enable_directive(){let e=this._consume(m.tokens.ident,"identity expected.");return this._updateNode(new ui(e.toString()))}_requires_directive(){let e=[this._consume(m.tokens.ident,"identity expected.").toString()];for(;this._match(m.tokens.comma);){let t=this._consume(m.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new li(e))}_type_alias(){let e=this._consume(m.tokens.ident,"identity expected.");this._consume(m.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let r=this._updateNode(new Ur(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([m.tokens.ident,...m.texel_format,m.keywords.bool,m.keywords.f32,m.keywords.i32,m.keywords.u32])){let r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){let n=this._updateNode(new Qn(r));return this._forwardTypeCount++,n}return this._updateNode(new k(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(m.template_types)){let r=this._advance().toString(),n=null,o=null;return this._match(m.tokens.less_than)&&(n=this._type_decl(),o=null,this._match(m.tokens.comma)&&(o=this._consume(m.access_mode,"Expected access_mode for pointer").toString()),this._consume(m.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new B(r,n,o))}if(this._match(m.keywords.ptr)){let r=this._previous().toString();this._consume(m.tokens.less_than,"Expected '<' for pointer.");let n=this._consume(m.storage_class,"Expected storage_class for pointer");this._consume(m.tokens.comma,"Expected ',' for pointer.");let o=this._type_decl(),i=null;return this._match(m.tokens.comma)&&(i=this._consume(m.access_mode,"Expected access_mode for pointer").toString()),this._consume(m.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new ar(r,n.toString(),o,i))}let t=this._attribute();if(this._match(m.keywords.array)){let r=null,n=-1,o=this._previous(),i=null;if(this._match(m.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let c="";if(this._match(m.tokens.comma)){i=this._shift_expression();try{c=i.constEvaluate(this._exec).toString(),i=null}catch{c="1"}}this._consume(m.tokens.greater_than,"Expected '>' for array."),n=c?parseInt(c):0}let a=this._updateNode(new Ct(o.toString(),t,r,n));return i&&this._deferArrayCountEval.push({arrayType:a,countNode:i}),a}return null}_texture_sampler_types(){if(this._match(m.sampler_type))return this._updateNode(new Tt(this._previous().toString(),null,null));if(this._match(m.depth_texture_type))return this._updateNode(new Tt(this._previous().toString(),null,null));if(this._match(m.sampled_texture_type)||this._match(m.multisampled_texture_type)){let e=this._previous();this._consume(m.tokens.less_than,"Expected '<' for sampler type.");let t=this._type_decl();return this._consume(m.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Tt(e.toString(),t,null))}if(this._match(m.storage_texture_type)){let e=this._previous();this._consume(m.tokens.less_than,"Expected '<' for sampler type.");let t=this._consume(m.texel_format,"Invalid texel format.").toString();this._consume(m.tokens.comma,"Expected ',' after texel format.");let r=this._consume(m.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(m.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Tt(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(m.tokens.attr);){let t=this._consume(m.attribute_name,"Expected attribute name"),r=this._updateNode(new ss(t.toString(),null));if(this._match(m.tokens.paren_left)){if(r.value=this._consume(m.literal_or_ident,"Expected attribute value").toString(),this._check(m.tokens.comma)){this._advance();do{let n=this._consume(m.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(n)}while(this._match(m.tokens.comma))}this._consume(m.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}},us=class extends kt{constructor(e){super(),e&&this.update(e)}update(e){let t=new wi().parse(e);this.updateAST(t)}};var Fu=`/*TEXTURES*/\r
\r
/*TEXTURES*/\r
\r
\r
/*GLOBALS*/\r
\r
/*GLOBALS*/\r
\r
struct FragInput {\r
  @builtin(position) position : vec4f,\r
  @location(0) uv : vec2f,\r
}\r
\r
@vertex\r
fn VSMain(@builtin(vertex_index) vertexIndex: u32) -> FragInput {\r
  var output: FragInput;\r
\r
  output.position = vec4(array(\r
    vec2( 1.0,  1.0),\r
    vec2( 1.0, -1.0),\r
    vec2(-1.0, -1.0),\r
    vec2( 1.0,  1.0),\r
    vec2(-1.0, -1.0),\r
    vec2(-1.0,  1.0),\r
  )[vertexIndex], 0.5, 1.0);\r
\r
  output.uv = array(\r
    vec2(1.0, 0.0),\r
    vec2(1.0, 1.0),\r
    vec2(0.0, 1.0),\r
    vec2(1.0, 0.0),\r
    vec2(0.0, 1.0),\r
    vec2(0.0, 0.0),\r
  )[vertexIndex];\r
\r
  return output;\r
}\r
\r
struct Output {\r
/*OUTPUT_STRUCT*/\r
\r
/*OUTPUT_STRUCT*/\r
}\r
\r
@fragment\r
fn FSMain(@location(0) uv : vec2f) -> Output  {\r
  /*FRAGMENT_BODY*/\r
\r
  /*FRAGMENT_BODY*/\r
}`;function Kd(s){return Tu(Fu,[{delimiter:"/*TEXTURES*/",replaceWith:s.textures},{delimiter:"/*GLOBALS*/",replaceWith:s.globals},{delimiter:"/*OUTPUT_STRUCT*/",replaceWith:s.outputStruct},{delimiter:"/*FRAGMENT_BODY*/",replaceWith:s.fragmentBody}])}var Du={r8unorm:"f32",r8snorm:"f32",r8uint:"u32",r8sint:"i32",r16unorm:"u32",r16snorm:"i32",r16uint:"u32",r16sint:"i32",r16float:"f32",rg8unorm:"vec2f",rg8snorm:"vec2f",rg8uint:"vec2u",rg8sint:"vec2i",r32uint:"u32",r32sint:"i32",r32float:"f32",rg16unorm:"vec2f",rg16snorm:"vec2f",rg16uint:"vec2u",rg16sint:"vec2i",rg16float:"vec2f",rgba8unorm:"vec4f","rgba8unorm-srgb":"vec4f",rgba8snorm:"vec4f",rgba8uint:"vec4u",rgba8sint:"vec4i",bgra8unorm:"vec4f","bgra8unorm-srgb":"vec4f",rgb9e5ufloat:"vec4f",rgb10a2uint:"vec4u",rgb10a2unorm:"vec4f",rg11b10ufloat:"vec4f",rg32uint:"vec2u",rg32sint:"vec2i",rg32float:"vec2f",rgba16unorm:"vec4u",rgba16snorm:"vec4i",rgba16uint:"vec4u",rgba16sint:"vec4i",rgba16float:"vec4f",rgba32uint:"vec4u",rgba32sint:"vec4i",rgba32float:"vec4f"};function Ru(s,e){let t="",r="",n=0,o=[];for(let E of e.samplers??[{}])r+=`@group(0) @binding(${n})
var sampler${n}: sampler;
`,o.push(s.createSampler(E)),n++;n=0;let i=new Map,a=new Map,c=Object.entries(e.inputs);for(let[E,I]of c)r+=`@group(1) @binding(${n}) 
var tex_${E}: texture_${I.dimensionality??"2d"}<${I.type??"f32"}>;`,i.set(E,n),t+=`  var ${E} = textureSample(tex_${E}, sampler${I.sampleWith??0}, uv);
`,n++;let u="",l=0;for(let[E,I]of Object.entries(e.outputs))u+=`  @location(${l}) ${E}: ${Du[I]},
`,a.set(E,l),t+=`  var ${E}: ${Du[I]};
`,l++;t+=e.source,t+=`
  var OUTPUT: Output;
`;let f=Object.entries(e.outputs);for(let[E,I]of f)t+=`  OUTPUT.${E} = ${E};
`;t+="return OUTPUT;";let h="";if(h+=e.globals??"",e.uniforms){h+=`@group(2) @binding(0) var<uniform> params : Params;
struct Params {
`;for(let[E,I]of Object.entries(e.uniforms??{}))h+=`  ${E}: ${I},
`;h+="}"}let y=Kd({textures:r,globals:h,outputStruct:u,fragmentBody:t}),_=new us(y).getBindGroups(),T=s.createShaderModule({code:y}),d=s.createRenderPipeline({layout:"auto",vertex:{module:T},fragment:{module:T,targets:f.map(([E,I])=>({format:I}))}}),C=s.createBindGroup({layout:d.getBindGroupLayout(0),entries:o.map((E,I)=>({resource:E,binding:I}))});return{pipeline:d,makeUniformBuffer(){let E=s.createBuffer({size:1024,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM}),I=s.createBindGroup({layout:d.getBindGroupLayout(2),entries:[{resource:E,binding:0}]}),G={buffer:E,bindGroup:I,setBuffer(U){let L=st({bindGroups:_},2,0,U);return s.queue.writeBuffer(E,0,L),G}};return G},withInputs(E){let I=s.createBindGroup({layout:d.getBindGroupLayout(1),entries:c.map(([G,U],L)=>({resource:E[G],binding:L}))});return G=>(U,L,O)=>{let N=U.beginRenderPass({colorAttachments:f.map(([x,S])=>L[x]instanceof GPUTextureView?{view:L[x],clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}:L[x])});N.setPipeline(d),N.setBindGroup(0,C),N.setBindGroup(1,I),G&&N.setBindGroup(2,G.bindGroup),N.draw(6),N.end()}}}}var vi={create(){return{rotation:he([0,0,0]),angles:[0,0],distance:15}},init(){},dependencies:[Ee],globalDependencies:[q,Ft],onDestroy(){},renderUpdate(s){for(let e of s.instances){let t=e.entity.transform.matrix;s.subsystem(q).state.viewMatrix=fe(fe(he([0,0,-e.data.distance]),e.data.rotation),he([-t[12],-t[13],-t[14]]))}},fixedUpdate({state:s,instances:e,subsystem:t}){let r=t(Ft).state,n=r.pollMovement(),o=r.pollScroll();for(let i of e)if(i.data.distance*=Math.pow(1.1,o),r.isRightPressed()){i.data.angles=Ti(i.data.angles,Ii(n,.008));let a=[1,0,0],c=[0,1,0];i.data.rotation=fe(mr(a,i.data.angles[1]),mr(c,i.data.angles[0]))}},brand:"trackCamera"},Gu={create(s,e){let t=[];for(let r of qe(20))t.push({});return{segments:t}},init(s){},dependencies:[vi],globalDependencies:[Ft,Mt,vt],brand:"physicalPlayerController",onDestroy(){},fixedUpdate({subsystem:s,instances:e}){let t=s(Mt).state;for(let r of e){let n=r.entity.trackCamera,o=[0,0,0];t.isKeyHeld("w")&&(o=pt(o,[0,0,-1])),t.isKeyHeld("s")&&(o=pt(o,[0,0,1])),t.isKeyHeld("a")&&(o=pt(o,[-1,0,0])),t.isKeyHeld("d")&&(o=pt(o,[1,0,0])),o=Ci(o,[0,-1,0],n.angles[0]),t.isKeyHeld(" ")&&(o=pt(o,[0,1,0])),t.isKeyHeld("shift")&&(o=pt(o,[0,-1,0]));let i=.26;r.entity.rigidBody.body.applyImpulse({x:o[0]*i,y:o[1]*i,z:o[2]*i},!0)}}};function ls(s,e){let t=[];for(let r of e.primitives){let n={attributes:{},count:0};for(let[o,i]of Object.entries(r.attributes)){let a=ze(s,i.value.buffer,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);n.attributes[o]=a,n.count=i.count}if(r.indices){let o=ze(s,r.indices.value.buffer,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST);n.indices={buffer:o,format:r.indices.bytesPerElement===2?"uint16":"uint32"},n.count=r.indices.count}t.push(n)}return t}function Xd(s,e){let t=e.primitives[0],r=Object.entries(t.attributes).find(o=>o[0]==="POSITION")?.[1];if(!r)throw new Error("No position!");let n=t.indices;if(!n)throw new Error("Mesh should be indexed!");return n.bytesPerElement===2?s.ColliderDesc.trimesh(new Float32Array(r.value.buffer),new Uint32Array([...new Uint16Array(n.value.buffer)])):s.ColliderDesc.trimesh(new Float32Array(r.value.buffer),new Uint32Array(n.value.buffer))}async function Qd(){let s=await(await fetch("assets/models.glb")).blob();console.log("sdsdsdfds",await Ut(await(await fetch("assets/models.glb")).blob(),zt));let e=await Ut(s,zt),t=Uo(e);console.log(t);let r=await Si([Ee,q,bu,vn,vt,Qc,Jr,yu,Bu,_u,Mt,Ft,vu(({device:J,canvas:$})=>({blitToCanvas:Ru(J,{inputs:{x:{}},outputs:{y:navigator.gpu.getPreferredCanvasFormat()},source:"y = mix(vec4f(1.0,0.0,0.0,1.0), vec4f(x.rgb, 1.0), x.a);"})}),()=>{},({device:J,canvas:$,ctx:Q,lighting:z},ie,_e)=>{let ee=J.createCommandEncoder();_e.blitToCanvas.withInputs({x:z.createView()})(void 0)(ee,{y:Q.getCurrentTexture().createView()}),J.queue.submit([ee.finish()])}),Gu,vi]),n=r.subsystem(q).global.device,o=ls(n,t.meshes[0]),i=ls(n,t.meshes[2]),a=ls(n,t.meshes[4]),c=ls(n,t.meshes[5]),u=[],{world:l,RAPIER:f}=r.subsystem(vt).global,h=4*16**3,y=ze(n,new Float32Array(qe(h).flatMap(J=>[mt(-10,10),mt(-10,10),mt(-40,0),0])),GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE),g=ze(n,new Float32Array(qe(h).flatMap(J=>[0,0,0,0])),GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE),_=n.createTexture({dimension:"3d",size:[32,32,32],usage:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST,format:"rgba8snorm"}),T=new Int8Array(Ei(qe(32),qe(32),qe(32)).flatMap(([J,$,Q])=>[mt(-4,4),mt(-4,4),mt(-4,4),0]));for(let J=0;J<1024*32*4;J+=4)T[J]==0&&T[J+1]===0&&T[J+2];n.queue.writeTexture({texture:_},T,{bytesPerRow:128,rowsPerImage:32},[32,32,32]),r.entity({transform:he([0,0,-15]),particleForcefield:{positionBuffer:y,velocityBuffer:g,forceFieldTexture:_,count:h}});let d=r.entity({transform:he([0,0,-15]),particleSystem:{drawColor:[1,1,1,1],count:h,positionBuffer:y}}),C=r.entity({transform:he([0,0,-90]),sampleWebgpuRendererGeometry:{vertexBuffer:i[0].attributes.POSITION,normalBuffer:i[0].attributes.NORMAL,size:i[0].count,indexBuffer:i[0].indices.buffer,indexFormat:"uint16",drawColor:[.2,.4,1,1]}});r.entity({transform:he([0,0,0]),sampleWebgpuRendererGeometry:{vertexBuffer:a[0].attributes.POSITION,normalBuffer:a[0].attributes.NORMAL,size:a[0].count,indexBuffer:a[0].indices.buffer,indexFormat:"uint16",drawColor:[.27,.29,.31,1]},rigidBody:f.RigidBodyDesc.fixed().setTranslation(0,-10,-10),rigidBodyCollider:Xd(f,t.meshes[4]).setFriction(.6)});let E={vertexBuffer:c[0].attributes.POSITION,normalBuffer:c[0].attributes.NORMAL,size:c[0].count,indexBuffer:c[0].indices.buffer,indexFormat:"uint16",drawColor:[1,.5,1,1]},I=1,G=r,U=r.entity({transform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],physicalPlayerController:{geometry:E,sys:r},trackCamera:{}});r.entity({transform:he([0,30,-20]),pointLightSource:{color:[1,1,1],quadratic:.02,linear:.01,constant:1}}),r.entity({transform:he([0,30,0]),pointLightSource:{color:[1,1,1],quadratic:.02,linear:.01,constant:1}});let L=0,O=r.subsystem(q),N=r.subsystem(Mt).global,x=[0,0,0],S=[0,0,0],R=[0,0];async function M(){O.global.aspect=window.innerWidth/window.innerHeight,O.global.fov=1,O.global.near=.1,O.global.far=200,await r.renderUpdate(),await r.fixedUpdate(),L++,requestAnimationFrame(M)}M()}Qd();
//# sourceMappingURL=index.demo.js.map
